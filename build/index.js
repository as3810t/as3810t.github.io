
	var featureDetect = 'atob(btoa(1)); let A = class {constructor(){} F(){}}; let B = class extends A {constructor(){super();} F(){super.F();} *G() {yield 0;}}; let C = function*() {yield;};';

	try {
		eval(featureDetect);
		window.eval(decodeURIComponent(Array.prototype.map.call(atob('LyouL2RyYXcuanMqLwoKdmFyIE93bERyYXcgPSAoZnVuY3Rpb24oKSB7CgkndXNlIHN0cmljdCc7Cgljb25zdCBEVVJBVElPTiA9IDAuNTsKCWNvbnN0IFhNTE5TID0gImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIjsKCgkvKioKCSAqIENsYXNzIHJlcHJlc2VudGluZyB0aGUgbG9naWMgb2YgY2FudmFzCgkgKgoJICogQHByb3BlcnR5IHtPYmplY3R9IG9wdGlvbnMgLSBTZXR0aW5ncyBmb3IgdGhlIGNhbnZhcwoJICogQHByb3BlcnR5IHtudW1iZXJ9IG9wdGlvbnMud2lkdGggLSBUaGUgd2lkdGggb2YgdGhlIGNhbnZhcyBpbiBTVkcgcGl4ZWxzCgkgKiBAcHJvcGVydHkge251bWJlcn0gb3B0aW9ucy5oZWlnaHQgLSBUaGUgaGVpZ2h0IG9mIHRoZSBjYW52YXMgaW4gU1ZHIHBpeGVscwoJICogQHByb3BlcnR5IHtib29sZWFufSBvcHRpb25zLmNhc3QgLSBUcnVlIGlmIHRoZSBwcmVzZW50IERPTSBlbGVtZW50cyBzaG91bGQgYmUgcGFyc2VkIHRvIGNhbnZhcwoJICogQHByb3BlcnR5IHtFbGVtZW50fSBjb250YWluZXIgLSBET00gZWxlbWVudCBvZiB0aGUgY2FudmFzIChTVkdFbGVtZW50KQoJICogQHByb3BlcnR5IHtPd2xEcmF3LmVsZW1lbnRbXX0gZWxlbWVudHMgLSBMaXN0IG9mIGVsZW1lbnRzIHRoYXQgYXJlIGRyYXduIHRvIHRoZSBjYW52YXMKCSAqLwoJY2xhc3MgT3dsRHJhdyB7CgkJLyoqCgkJICogSW5pdGlhbGl6ZXMgdGhlIGNhbnZhcwoJCSAqIEBwYXJhbSB7c3RyaW5nfSBpZCAtIGlkIG9mIFNWRyBET00gZWxlbWVudCwgdGhhdCBpcyB0aGUgY2FudmFzCgkJICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBPcHRpb25zCgkJICogQHBhcmFtIHtudW1iZXJ9IG9wdGlvbnMud2lkdGggLSBUaGUgd2lkdGggb2YgdGhlIGNhbnZhcyBpbiBTVkcgcGl4ZWxzCgkJICogQHBhcmFtIHtudW1iZXJ9IG9wdGlvbnMuaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiB0aGUgY2FudmFzIGluIFNWRyBwaXhlbHMKCQkgKiBAcGFyYW0ge2Jvb2xlYW59IG9wdGlvbnMuY2FzdCAtIFRydWUgaWYgdGhlIHByZXNlbnQgRE9NIGVsZW1lbnRzIHNob3VsZCBiZSBwYXJzZWQgdG8gY2FudmFzIGVsZW1lbnRzCgkJICovCgkJY29uc3RydWN0b3IoaWQsIG9wdGlvbnMpIHsKCQkJaWYob3B0aW9ucyA9PSB1bmRlZmluZWQpIG9wdGlvbnMgPSB7fTsKCQkJdGhpcy5vcHRpb25zID0gb3B0aW9uczsKCgkJCXRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwoJCQl0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdkcmF3Jyk7CgkJCXRoaXMuY29udGFpbmVyLnNldEF0dHJpYnV0ZSgndmlld0JveCcsICcwIDAgJyArIChvcHRpb25zLndpZHRoIHx8IDY0MCkgKyAnICcgKyAob3B0aW9ucy5oZWlnaHQgfHwgNDgwKSk7CgoJCQlsZXQgZGVmcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnZGVmcycpCgkJCWRlZnMuaW5uZXJIVE1MID0gJ1wKCQkJCTxtYXJrZXIgaWQ9ImFycm93IiBtYXJrZXJXaWR0aD0iMTAiIG1hcmtlckhlaWdodD0iMTAiIHJlZlg9IjgiIHJlZlk9IjMiIG9yaWVudD0iYXV0byI+IFwKCQkJCQk8cGF0aCBkPSJNMCwwIEwwLDYgTDksMyB6IiBzdHJva2U9ImNvbnRleHQtc3Ryb2tlIi8+XAoJCQkJPC9tYXJrZXI+JzsKCQkJdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQoZGVmcyk7CgoJCQl0aGlzLmVsZW1lbnRzID0gW107CgoJCQlpZihvcHRpb25zLmNhc3QgPT0gdHJ1ZSkgewoJCQkJZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuY29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CgkJCQkJdGhpcy5lbGVtZW50cy5wdXNoKG5ldyBPd2xEcmF3LmVsZW1lbnQodGhpcy5jb250YWluZXIuY2hpbGRyZW5bMF0pKTsKCQkJCX0KCQkJfQoJCX0KCgkJLyoqCgkJICogQWRkcyBhbiBlbGVtZW50cyBvciBlbGVtZW50cyB0byB0aGUgY2FudmFzCgkJICogQHBhcmFtIHsoT3dsRHJhdy5lbGVtZW50KX0gZWxlbWVudCAtIEFuIGVsZW1lbnQsIHRoYXQgd2lsbCBiZSBhZGRlZCB0byB0aGUgY2FudmFzCgkJICovCgkJYWRkKGVsZW1lbnQpIHsKCQkJdGhpcy5lbGVtZW50cy5wdXNoKGVsZW1lbnQpOwoJCQlmb3IobGV0IGkgPSAwOyBpIDwgZWxlbWVudC5jb250YWluZXIubGVuZ3RoOyBpKyspIHsKCQkJCXRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKGVsZW1lbnQuY29udGFpbmVyW2ldKTsKCQkJfQoJCX0KCgkJLyoqCgkJICogUmVtb3ZlcyBhbGwgdGhlIGVsZW1lbnRzIGZyb20gY2FudmFzCgkJICovCgkJY2xlYXIoKSB7CgkJCWxldCBlID0gdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnZycpOwoJCQlmb3IobGV0IGkgPSAwOyBpIDwgZS5sZW5ndGg7IGkrKykgewoJCQkJdGhpcy5jb250YWluZXIucmVtb3ZlQ2hpbGQoZVtpXSk7CgkJCX0KCQl9Cgl9CgoJLyoqCgkgKiBCYXNlIGNsYXNzIHJlcHJlc2VudGluZyBhbiBlbGVtZW50IG9uIGNhbnZhcwoJICogQG1lbWJlcm9mIE93bERyYXcKCSAqCgkgKiBAcHJvcGVydHkge0VsZW1lbnRbXX0gY29udGFpbmVyIC0gQXJyYXkgb2YgRE9NIGVsZW1lbnRzIChTVkdFbGVtZW50KSB0aGF0IGFyZSBhZGRlZCB0byB0aGUgc3ZnIERPTQogY29ubmVjdGVkLCBpZiAyLCB0aGVuIHRoZSBlbmRpbmcgcGFydCAodGhlIG9uZSB3aXRoIHRoZSBhcnJvd2hlYWQpCgkgKiBAcHJvcGVydHkge251bWJlcn0geCAtIFRoZSB4LWNvb3JkaW5hdGUgb2YgZWxlbWVudAoJICogQHByb3BlcnR5IHtudW1iZXJ9IHkgLSBUaGUgeS1jb29yZGluYXRlIG9mIGVsZW1lbnQKCSAqLwoJT3dsRHJhdy5lbGVtZW50ID0gY2xhc3MgewoJCS8qKgoJCSAqIENyZWF0ZXMgYW4gZWxlbWVudCBvbiBjYW52YXMKCQkgKiBAcGFyYW0geyhzdHJpbmd8RWxlbWVudCl9IG1vZGUgLSBUaGUgYmFzZSBvZiBlbGVtZW50LiBJZCBzdHJpbmcsIHRoYXQgdGhlIERPTSBlbGVtZW50IHdpdGggdGhlIHNhbWUgaWQgd2lsbCBiZSBwYXJzZWQsIGlmIGluc3RhbmNlb2YgRWxlbWVudCwgdGhhbiB0aGF0IGVsZW1lbnQgd2lsbCBiZSBwYXJzZWQKCQkgKi8KCQljb25zdHJ1Y3Rvcihtb2RlKSB7CgkJCXRoaXMuY29udGFpbmVyID0gW107CgkJCXRoaXMuY29ubmVjdGlvbnMgPSBbXTsKCgkJCXRoaXMueCA9IDA7IHRoaXMueSA9IDA7CgoJCQlpZih0eXBlb2YgbW9kZSA9PSAnc3RyaW5nJykgdGhpcy5jb250YWluZXJbMF0gPSB0aGlzLmNvbnRhaW5lci5nZXRFbGVtZW50QnlJZChtb2RlKTsKCQkJZWxzZSBpZihtb2RlIGluc3RhbmNlb2YgRWxlbWVudCkgdGhpcy5jb250YWluZXJbMF0gPSBtb2RlOwoJCX0KCgkJLyoqCgkJICogSGlnaGxpZ2h0ZXMgYW4gZWxlbWVudCwgYnkgYWRkaW4gYSBjbGFzcyB3aXRoIHRoZSBuYW1lICdoaWdobGlnaHQte2lkfSB0byB0aGUgY2xhc3MgbGlzdC4gUmVtb3ZlcyBhbGwgb3RoZXIgaGlnaGxpZ2h0ZXMgb24gdGhlIGVsZW1lbnQuCgkJICogQHBhcmFtIHtzdHJpbmd9IGlkIC0gVGhlIG5hbWUgb2YgaGlnaGxpZ2h0IChwYXJ0IG9mIGNsYXNzIG5hbWUpCgkJICovCgkJaGlnaGxpZ2h0KGlkKSB7CgkJCXRoaXMudW5oaWdobGlnaHQoKTsKCQkJZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuY29udGFpbmVyLmxlbmd0aDsgaSsrKSB7CgkJCQl0aGlzLmNvbnRhaW5lcltpXS5jbGFzc0xpc3QuYWRkKCdoaWdobGlnaHQtJyArIGlkKTsKCQkJfQoJCX0KCQkvKioKCQkgKiBSZW1vdmVzIGFsbCBoaWdobGlnaHRlcyBmcm9tIGVsZW1lbnQKCQkgKi8KCQl1bmhpZ2hsaWdodCgpIHsKCQkJZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuY29udGFpbmVyLmxlbmd0aDsgaSsrKSB7CgkJCQlsZXQgbGlzdCA9IHRoaXMuY29udGFpbmVyW2ldLmNsYXNzTGlzdDsKCQkJCWZvcihsZXQgaiA9IDA7IGogPCBsaXN0Lmxlbmd0aDsgaisrKSB7CgkJCQkJaWYobGlzdFtqXS5zZWFyY2goJ2hpZ2hsaWdodCcpICE9IC0xKSB0aGlzLmNvbnRhaW5lcltpXS5jbGFzc0xpc3QucmVtb3ZlKGxpc3Rbal0pOwoJCQkJfQoJCQl9CgkJfQoKCQkvKioKCQkgKiBIaWRlcyBhbiBlbGVtZW50LiAob3BhY2l0eSA9IDAsIG5vdCByZW1vdmVkIGZyb20gRE9NKQoJCSAqLwoJCWhpZGUoKSB7CgkJCWZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmNvbnRhaW5lci5sZW5ndGg7IGkrKykgewoJCQkJdGhpcy5jb250YWluZXJbaV0uc3R5bGUub3BhY2l0eSA9IDA7CgkJCX0KCQl9CgkJLyoqCgkJICogU2hvd3MgYW4gZWxlbWVudC4gKG9wYWNpdHkgPSAxLCBub3QgYWRkZWQgdG8gRE9NKQoJCSAqLwoJCXNob3coKSB7CgkJCWZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmNvbnRhaW5lci5sZW5ndGg7IGkrKykgewoJCQkJdGhpcy5jb250YWluZXJbaV0uc3R5bGUub3BhY2l0eSA9IDE7CgkJCX0KCQl9CgoJCS8qKgoJCSAqIE1vdmVzIHRoZSBlbGVtZW50LCBhbmQgdXBkYXRlcyB0aGUgcG9zaXRpb24gZGF0YS4gQWxzbyBtb3ZlcyB0aGUgY29ubmVjdGVkIGxpbmVzLCBhcnJvd3MuCgkJICogQHBhcmFtIHtPYmplY3R9IG9wdCAtIERhdGEgZGVzY3JpYmluZyB0aGUgdHJhbnNpdGlvbgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0LnhdIC0gSWYgZGVmaW5lZCwgdGhlIHgtY29vcmRpbmF0ZSBvZiBwb3NpdGlvbiB3aWxsIGJlIHRoaXMgdmFsdWUKCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdC55XSAtIElmIGRlZmluZWQsIHRoZSB5LWNvb3JkaW5hdGUgb2YgcG9zaXRpb24gd2lsbCBiZSB0aGlzIHZhbHVlCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHQuZHhdIC0gSWYgZGVmaW5lZCwgdGhlIHgtY29vcmRpbmF0ZSBvZiBwb3NpdGlvbiB3aWxsIGJlIGluY3JlYXNlZCBieSB0aGlzIHZhbHVlCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHQuZHldIC0gSWYgZGVmaW5lZCwgdGhlIHktY29vcmRpbmF0ZSBvZiBwb3NpdGlvbiB3aWxsIGJlIGluY3JlYXNlZCBieSB0aGlzIHZhbHVlCgkJICovCgkJbW92ZShvcHQpIHsKCQkJaWYob3B0LnggIT0gdW5kZWZpbmVkKSB7CgkJCQl0aGlzLnggPSBvcHQueDsgdGhpcy55ID0gb3B0Lnk7CgkJCX0KCQkJZWxzZSBpZihvcHQuZHggIT0gdW5kZWZpbmVkKSB7CgkJCQl0aGlzLnggKz0gb3B0LmR4OyB0aGlzLnkgKz0gb3B0LmR5OwoJCQl9CgkJCWZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmNvbnRhaW5lci5sZW5ndGg7IGkrKykgewoJCQkJdGhpcy5jb250YWluZXJbaV0uc2V0QXR0cmlidXRlTlMobnVsbCwgJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIHRoaXMueCArICcsICcgKyB0aGlzLnkgKyAnKScpOwoJCQl9CgkJfQoJfQoKCS8qKgoJICogQmFzZSBjbGFzcyByZXByZXNlbnRpbmcgYW4gZWxlbWVudCBvbiBjYW52YXMKCSAqIEBtZW1iZXJvZiBPd2xEcmF3CgkgKiBAZXh0ZW5kcyBPd2xEcmF3LmVsZW1lbnQKCSAqIEBwcm9wZXJ0eSB7RWxlbWVudFtdfSBjb250YWluZXIgLSBBcnJheSBvZiBET00gZWxlbWVudHMgKFNWR0VsZW1lbnQpIHRoYXQgYXJlIGFkZGVkIHRvIHRoZSBzdmcgRE9NCgkgKiBAcHJvcGVydHkge09iamVjdFtdfSBjb25uZWN0aW9ucyAtIExpc3Qgb2YgbGluZXMsIGFycm93cywgdGhhdCBhcmUgY29ubmVjdGVkIHRvIHRoZSBlbGVtZW50IGFuZCBtb3ZlIHdpdGggaXQuCgkgKiBAcHJvcGVydHkge093bERyYXcubGluZX0gY29ubmVjdGlvbnMub2JqZWN0IC0gVGhlIGxpbmUgb3IgYXJyb3csIHRoYXQgd2lsbCBiZSBjb25uZWN0ZWQKCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBjb25uZWN0aW9ucy50eXBlIC0gSWYgMSwgdGhhbiB0aGUgYmVnaW5uaW5nIHBhcnQgb2YgbGluZSBvciBhcnJvdyB3aWxsIGJlIGNvbm5lY3RlZCwgaWYgMiwgdGhlbiB0aGUgZW5kaW5nIHBhcnQgKHRoZSBvbmUgd2l0aCB0aGUgYXJyb3doZWFkKQoJICogQHByb3BlcnR5IHtudW1iZXJ9IHggLSBUaGUgeC1jb29yZGluYXRlIG9mIGVsZW1lbnQKCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB5IC0gVGhlIHktY29vcmRpbmF0ZSBvZiBlbGVtZW50CgkgKi8KCU93bERyYXcuY29ubmVjdGFibGUgPSBjbGFzcyBleHRlbmRzIE93bERyYXcuZWxlbWVudCB7CgkJLyoqCgkJICogQ3JlYXRlcyBhIGNvbm5lY3RhYmxlIGVsZW1lbnQgb24gY2FudmFzLiBBbiBlbGVtZW50IGlzIGNvbm5lY3RhYmxlLCBpZiBpdCBjYW4gYmUgdGhlIGVuZCBvciBiZWdpbm5pbmcgb2YgYW4gYXJyb3cuCgkJICogQHBhcmFtIHsoc3RyaW5nfEVsZW1lbnQpfSBtb2RlIC0gVGhlIGJhc2Ugb2YgZWxlbWVudC4gSWQgc3RyaW5nLCB0aGF0IHRoZSBET00gZWxlbWVudCB3aXRoIHRoZSBzYW1lIGlkIHdpbGwgYmUgcGFyc2VkLCBpZiBpbnN0YW5jZW9mIEVsZW1lbnQsIHRoYW4gdGhhdCBlbGVtZW50IHdpbGwgYmUgcGFyc2VkCgkJICovCgkJY29uc3RydWN0b3IobW9kZSkgewoJCQlzdXBlcihtb2RlKTsKCQkJdGhpcy5jb25uZWN0aW9ucyA9IFtdOwoJCX0KCgkJLyoqCgkJICogQ29ubmVjdHMgYSBsaW5lLCBvciBhcnJvdyB0byB0aGUgZWxlbWVudC4gVG8gYXBwbHksIHRoZSBlbGVtZW50IG11c3QgYmUgb2YgdHlwZSB7T3dsRHJhdy5jaXJjbGV9LCB7T3dsRHJhdy5yZWN0fSwge093bERyYXcucG9pbnRlcn0uCgkJICogQHBhcmFtIHtPd2xEcmF3LmxpbmV9IG9iamVjdCAtIFRoZSBsaW5lIG9yIGFycm93LCB0aGF0IHdpbGwgYmUgY29ubmVjdGVkCgkJICogQHBhcmFtIHtudW1iZXJ9IHR5cGUgLSBJZiAxLCB0aGFuIHRoZSBiZWdpbm5pbmcgcGFydCBvZiBsaW5lIG9yIGFycm93IHdpbGwgYmUgY29ubmVjdGVkLCBpZiAyLCB0aGVuIHRoZSBlbmRpbmcgcGFydCAodGhlIG9uZSB3aXRoIHRoZSBhcnJvd2hlYWQpCgkJICovCgkJY29ubmVjdChvYmplY3QsIHR5cGUpIHsKCQkJdGhpcy5jb25uZWN0aW9ucy5wdXNoKHtvYmplY3Q6IG9iamVjdCwgdHlwZTogdHlwZX0pOwoJCX0KCgkJLyoqCgkJICogVW5jb25uZWN0cyBhIGxpbmUsIG9yIGFycm93IGZyb20gdGhlIGVsZW1lbnQsIHRoYXQgZXF1YWxzIHRoZSBwYXJhbWV0ZXJzCgkJICogQHBhcmFtIHtPd2xEcmF3LmxpbmV9IG9iamVjdCAtIFRoZSBsaW5lIG9yIGFycm93LCB0aGF0IHdpbGwgYmUgdW5jb25uZWN0ZWQKCQkgKiBAcGFyYW0ge251bWJlcn0gdHlwZSAtIElmIDEsIHRoYW4gdGhlIGJlZ2lubmluZyBwYXJ0IG9mIGxpbmUgb3IgYXJyb3cgd2lsbCBiZSB1bmNvbm5lY3RlZCwgaWYgMiwgdGhlbiB0aGUgZW5kaW5nIHBhcnQgKHRoZSBvbmUgd2l0aCB0aGUgYXJyb3doZWFkKQoJCSAqLwoJCXVuY29ubmVjdChvYmplY3QsIHR5cGUpIHsKCQkJZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuY29ubmVjdGlvbnMubGVuZ3RoOyBpKyspIHsKCQkJCWlmKHRoaXMuY29ubmVjdGlvbnNbaV0ub2JqZWN0ID09IG9iamVjdCAmJiB0aGlzLmNvbm5lY3Rpb25zW2ldLnR5cGUgPT0gdHlwZSkgewoJCQkJCXRoaXMuY29ubmVjdGlvbnMuc3BsaWNlKGksIDEpOwoJCQkJfQoJCQl9CgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBjb29yZGluYXRlcyBvZiBjb25uZWN0aW9uIHBvaW50CgkJICogQHBhcmFtIHtzdHJpbmd9IGZyb21wIC0gVGhlIHBvc2l0aW9ub2YgY29ubmVjdGlvbiAoJ2wnIC0gbGVmdCBzaWRlLCAncicgLSByaWdodCBzaWRlLCAndScgLSB1cCBzaWRlLCAnZCcgLSBkb3duIHNpZGUpCgkJICovCgkJZ2V0Q29ubmVjdGlvbihmcm9tcCkgewoJCQl0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsbWVudGVkJyk7CgkJfQoKCQkvKioKCQkgKiBNb3ZlcyB0aGUgZWxlbWVudCwgYW5kIHVwZGF0ZXMgdGhlIHBvc2l0aW9uIGRhdGEuIEFsc28gbW92ZXMgdGhlIGNvbm5lY3RlZCBsaW5lcywgYXJyb3dzLgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBvcHQgLSBEYXRhIGRlc2NyaWJpbmcgdGhlIHRyYW5zaXRpb24KCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdC54XSAtIElmIGRlZmluZWQsIHRoZSB4LWNvb3JkaW5hdGUgb2YgcG9zaXRpb24gd2lsbCBiZSB0aGlzIHZhbHVlCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHQueV0gLSBJZiBkZWZpbmVkLCB0aGUgeS1jb29yZGluYXRlIG9mIHBvc2l0aW9uIHdpbGwgYmUgdGhpcyB2YWx1ZQoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0LmR4XSAtIElmIGRlZmluZWQsIHRoZSB4LWNvb3JkaW5hdGUgb2YgcG9zaXRpb24gd2lsbCBiZSBpbmNyZWFzZWQgYnkgdGhpcyB2YWx1ZQoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0LmR5XSAtIElmIGRlZmluZWQsIHRoZSB5LWNvb3JkaW5hdGUgb2YgcG9zaXRpb24gd2lsbCBiZSBpbmNyZWFzZWQgYnkgdGhpcyB2YWx1ZQoJCSAqLwoJCW1vdmUob3B0KSB7CgkJCXN1cGVyLm1vdmUob3B0KTsKCgkJCWZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmNvbm5lY3Rpb25zLmxlbmd0aDsgaSsrKSB7CgkJCQlpZih0aGlzLmNvbm5lY3Rpb25zW2ldLnR5cGUgPT0gMSkgewoJCQkJCXRoaXMuY29ubmVjdGlvbnNbaV0ub2JqZWN0Lm1vdmUoe2R4MTogb3B0LmR4LCBkeTE6IG9wdC5keSwgeDE6IG9wdC54LCB5MTogb3B0Lnl9KTsKCQkJCX0KCQkJCWVsc2UgaWYodGhpcy5jb25uZWN0aW9uc1tpXS50eXBlID09IDIpIHsKCQkJCQl0aGlzLmNvbm5lY3Rpb25zW2ldLm9iamVjdC5tb3ZlKHtkeDI6IG9wdC5keCwgZHkyOiBvcHQuZHksIHgyOiBvcHQueCwgeTI6IG9wdC55fSk7CgkJCQl9CgkJCX0KCQl9Cgl9CgoJLyoqCgkgKiBDbGFzcyByZXByZXNlbnRpbmcgYSBncm91cCBvZiBlbGVtZW50cwoJICogQG1lbWJlcm9mIE93bERyYXcKCSAqCgkgKiBAcHJvcGVydHkge0VsZW1lbnRbXX0gY29udGFpbmVyIC0gQXJyYXkgb2YgRE9NIGVsZW1lbnRzIChTVkdFbGVtZW50KSB0aGF0IGFyZSBhZGRlZCB0byB0aGUgc3ZnIERPTQoJICogQHByb3BlcnR5IHtPd2xEcmF3LmVsZW1lbnRbXX0gZWxlbXMgLSBMaXN0IG9mIGVsZW1lbnRzIGluIHRoZSBncm91cAoJICovCglPd2xEcmF3Lmdyb3VwID0gY2xhc3MgZXh0ZW5kcyBPd2xEcmF3LmVsZW1lbnQgewoJCS8qKgoJCSAqIENyZWF0aW5nIHRoZSBncm91cAoJCSAqIEBwYXJhbSB7T3dsRHJhdy5lbGVtZW50W119IGVsZW1zIC0gTGlzdCBvZiBlbGVtZW50cyBpbiB0aGUgZ3JvdXAKCQkgKi8KCQljb25zdHJ1Y3RvcihlbGVtcykgewoJCQlzdXBlcigpOwoJCQl0aGlzLmVsZW1zID0gZWxlbXMgfHwgW107CgkJCWZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1zLmxlbmd0aDsgaSsrKSB7CgkJCQlmb3IobGV0IGogPSAwOyBqIDwgdGhpcy5lbGVtc1tpXS5jb250YWluZXIubGVuZ3RoOyBqKyspIHsKCQkJCQl0aGlzLmNvbnRhaW5lci5wdXNoKHRoaXMuZWxlbXNbaV0uY29udGFpbmVyW2pdKTsKCQkJCX0KCQkJfQoJCX0KCgkJLyoqCgkJICogQWRkaW5nIGVsZW1lbnQocykgdG8gdGhlIGdyb3VwCgkJICogQHBhcmFtIHtPd2xEcmF3LmVsZW1lbnR8T3dsRHJhdy5lbGVtZW50c1tdfSBlbGVtZW50cyAtIEFuIGVsZW1lbnQgb3IgYXJyYXkgb2YgZWxlbWVudHMgdGhhdCB3aWxsIGJlIGFkZGVkIHRvIHRoZSBncm91cAoJCSAqLwoJCWFkZChlbGVtZW50cykgewoJCQlpZihlbGVtZW50cyBpbnN0YW5jZW9mIE93bERyYXcuZWxlbWVudCkgewoJCQkJdGhpcy5lbGVtcy5wdXNoKGVsZW1lbnRzKTsKCQkJCWZvcihsZXQgaSA9IDA7IGkgPCBlbGVtZW50cy5jb250YWluZXIubGVuZ3RoOyBpKyspIHsKCQkJCQl0aGlzLmNvbnRhaW5lci5wdXNoKGVsZW1lbnRzLmNvbnRhaW5lcltpXSk7CgkJCQl9CgkJCX0KCQkJZWxzZSBpZihlbGVtZW50cyBpbnN0YW5jZW9mIEFycmF5KSB7CgkJCQl0aGlzLmVsZW1zID0gdGhpcy5lbGVtcy5jb25jYXQoZWxlbWVudHMpOwoJCQkJZm9yKGxldCBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCQkJZm9yKGxldCBqID0gMDsgaiA8IGVsZW1lbnRzW2ldLmNvbnRhaW5lci5sZW5ndGg7IGorKykgewoJCQkJCQl0aGlzLmNvbnRhaW5lci5wdXNoKGVsZW1lbnRzW2ldLmNvbnRhaW5lcltqXSk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQkvKioKCQkgKiBSZW1vdmVzIGFuIGVsZW1lbnQgZnJvbSB0aGUgZ3JvdXAKCQkgKiBAcGFyYW0ge093bERyYXcuZWxlbWVudHxudW1iZXJ9IGVsZW1lbnQgLSBJZiBpbnN0YW5jZSBvZiBPd2xEcmF3LmVsZW1lbnQsIHRoYW4gdGhlIGVsZW1lbnQgZXF1YWxzIHRvIHRoZSBwYXJhbWV0ZXIgd2lsbCBiZSByZW1vdmVkLCBpZiBhIG51bWJlciwgdGhlIGVsZW1lbnQgd2l0aCBjb3JyZXNwb25kaW5nIGluZGV4IHdpbGwgYmUgcmVtb3ZlZC4KCQkgKi8KCQlyZW1vdmUoZWxlbWVudCkgewoJCQlpZihlbGVtZW50IGluc3RhbmNlb2YgT3dsRHJhdy5lbGVtZW50ICYmIHRoaXMuZWxlbWVudHMuaW5kZXhPZihlbGVtZW50KSAhPSAtMSkgewoJCQkJdGhpcy5lbGVtcy5zcGxpY2UodGhpcy5lbGVtcy5pbmRleE9mKGVsZW1lbnQpLCAxKTsKCQkJCWVsZW1lbnQuaGlkZSgpOwoJCQl9CgkJCWVsc2UgaWYodHlwZW9mIGVsZW1lbnQgPT0gJ251bWJlcicpIHsKCQkJCXRoaXMuZWxlbXNbZWxlbWVudF0uaGlkZSgpOwoJCQkJdGhpcy5lbGVtcy5zcGxpY2UoZWxlbWVudCwgMSk7CgkJCX0KCQl9CgoJCS8qKgoJCSAqIEhpZ2hsaWdodGVzIGFsbCB0aGUgZWxlbWVudHMgaW4gdGhlIGdyb3VwLgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBvcHQgLSBJdCB3aWxsIGJlIHBhc3NlZCB0byBhbGwgb2YgdGhlIGVsZW1lbnRzIChzZWUge0BsaW5rIE93bERyYXcuZWxlbWVudCNoaWdobGlnaHR9KQoJCSAqLwoJCWhpZ2hsaWdodChvcHQpIHsKCQkJZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuZWxlbXMubGVuZ3RoOyBpKyspIHsKCQkJCXRoaXMuZWxlbXNbaV0uaGlnaGxpZ2h0KG9wdCk7CgkJCX0KCQl9CgoJCS8qKgoJCSAqIFVuaGlnaGxpZ2h0ZXMgYWxsIHRoZSBlbGVtZW50cyBpbiB0aGUgZ3JvdXAuCgkJICogQHBhcmFtIHtPYmplY3R9IG9wdCAtIEl0IHdpbGwgYmUgcGFzc2VkIHRvIGFsbCBvZiB0aGUgZWxlbWVudHMgKHNlZSB7QGxpbmsgT3dsRHJhdy5lbGVtZW50I3VuaGlnaGxpZ2h0fSkKCQkgKi8KCQl1bmhpZ2hsaWdodChvcHQpIHsKCQkJZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuZWxlbXMubGVuZ3RoOyBpKyspIHsKCQkJCXRoaXMuZWxlbXNbaV0udW5oaWdobGlnaHQob3B0KTsKCQkJfQoJCX0KCgkJLyoqCgkJICogSGlkZXMgYWxsIGVsZW1lbnRzIGluIGdyb3VwIChzZWUge0BsaW5rIE93bERyYXcuZWxlbWVudCNoaWRlfSkKCQkgKi8KCQloaWRlKCkgewoJCQlmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5lbGVtcy5sZW5ndGg7IGkrKykgewoJCQkJdGhpcy5lbGVtc1tpXS5oaWRlKCk7CgkJCX0KCQl9CgoJCS8qKgoJCSAqIFNob3dzIGFsbCBlbGVtZW50cyBpbiBncm91cCAoc2VlIHtAbGluayBPd2xEcmF3LmVsZW1lbnQjc2hvd30pCgkJICovCgkJc2hvdygpIHsKCQkJZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuZWxlbXMubGVuZ3RoOyBpKyspIHsKCQkJCXRoaXMuZWxlbXNbaV0uc2hvdygpOwoJCQl9CgkJfQoKCQkvKioKCQkgKiBNb3ZlcyBhbGwgdGhlIGVsZW1lbnRzIGluIHRoZSBncm91cC4KCQkgKiBAcGFyYW0ge09iamVjdH0gb3B0IC0gSXQgd2lsbCBiZSBwYXNzZWQgdG8gYWxsIG9mIHRoZSBlbGVtZW50cyAoc2VlIHtAbGluayBPd2xEcmF3LmVsZW1lbnQjbW92ZX0pCgkJICovCgkJbW92ZShvcHQpIHsKCQkJZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuZWxlbXMubGVuZ3RoOyBpKyspIHsKCQkJCXRoaXMuZWxlbXNbaV0ubW92ZShvcHQpOwoJCQl9CgkJfQoJfQoKCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoJKiBQcmltaXRpdmVzCgkqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKCS8qKgoJICogQ2xhc3MgcmVwcmVzZW50aW5nIGEgY2lyY2xlCgkgKiBAbWVtYmVyb2YgT3dsRHJhdwoJICogQGV4dGVuZHMgT3dsRHJhdy5jb25uZWN0YWJsZQoJICoKCSAqIEBwcm9wZXJ0eSB7RWxlbWVudFtdfSBjb250YWluZXIgLSBBcnJheSBvZiBET00gZWxlbWVudHMgKFNWR0VsZW1lbnQpIHRoYXQgYXJlIGFkZGVkIHRvIHRoZSBzdmcgRE9NCgkgKiBAcHJvcGVydHkge09iamVjdFtdfSBjb25uZWN0aW9ucyAtIExpc3Qgb2YgbGluZXMsIGFycm93cywgdGhhdCBhcmUgY29ubmVjdGVkIHRvIHRoZSBlbGVtZW50IGFuZCBtb3ZlIHdpdGggaXQuCgkgKiBAcHJvcGVydHkgeyhPd2xEcmF3LmxpbmV8T3dsRHJhdy5hcnJvd3xPd2xEcmF3Lm5pY2VBcnJvdyl9IGNvbm5lY3Rpb25zLm9iamVjdCAtIFRoZSBsaW5lIG9yIGFycm93LCB0aGF0IHdpbGwgYmUgY29ubmVjdGVkCgkgKiBAcHJvcGVydHkge251bWJlcn0gY29ubmVjdGlvbnMudHlwZSAtIElmIDEsIHRoYW4gdGhlIGJlZ2lubmluZyBwYXJ0IG9mIGxpbmUgb3IgYXJyb3cgd2lsbCBiZSBjb25uZWN0ZWQsIGlmIDIsIHRoZW4gdGhlIGVuZGluZyBwYXJ0ICh0aGUgb25lIHdpdGggdGhlIGFycm93aGVhZCkKCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB4IC0gVGhlIHgtY29vcmRpbmF0ZSBvZiBlbGVtZW50CgkgKiBAcHJvcGVydHkge251bWJlcn0geSAtIFRoZSB5LWNvb3JkaW5hdGUgb2YgZWxlbWVudAoJICogQHByb3BlcnR5IHtudW1iZXJ9IHJhZGl1cyAtIFRoZSByYWRpdXMgb2YgdGhlIGNpcmNsZQoJICovCglPd2xEcmF3LmNpcmNsZSA9IGNsYXNzIGV4dGVuZHMgT3dsRHJhdy5jb25uZWN0YWJsZSB7CgkJLyoqCgkJICogQ3JlYXRlcyBhIGNpcmNsZQoJCSAqIEBwYXJhbSB7KHN0cmluZ3xFbGVtZW50fE9iamVjdCl9IG1vZGUgLSBEYXRhIGRlc2NyaWJpbmcgdGhlIGNpcmNsZSAoc2VlIHtAbGluayBPd2xEcmF3LmVsZW1lbnR9KQoJCSAqIEBwYXJhbSB7bnVtYmVyfSBtb2RlLnggLSB4LWNvb3JkaW5hdGUgb2YgdGhlIGNlbnRlciBvZiBjaXJjbGUKCQkgKiBAcGFyYW0ge251bWJlcn0gbW9kZS55IC0geS1jb29yZGluYXRlIG9mIHRoZSBjZW50ZXIgb2YgY2lyY2xlCgkJICogQHBhcmFtIHtudW1iZXJ9IG1vZGUucmFkaXVzIC0gcmFkaXVzIG9mIGNpcmNsZQoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbbW9kZS5jbGFzc10gLSBsaXN0IG9mIGNsYXNzIHRoYXQgd2lsbCBiZSBhZGRlZCB0byB0aGUgRE9NIGVsZW1lbnQKCQkgKiBAcGFyYW0ge3N0cmluZ30gW21vZGUuc3Ryb2tlXSAtIGNvbG9yIG9mIHN0cm9rZSwgdGhhdCBhcHBsaWVzIHRvIHRoZSBjaXJjbGUKCQkgKiBAcGFyYW0ge251bWJlcn0gW21vZGUuc3Ryb2tlV2lkdGhdIC0gd2lkdGggb2Ygc3Ryb2tlLCB0aGF0IGFwcGxpZXMgdG8gdGhlIGNpcmNsZQoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbbW9kZS5maWxsXSAtIGNvbG9yIG9mIGZpbGwsIHRoYXQgYXBwbGllcyB0byB0aGUgY2lyY2xlCgkJICogQHBhcmFtIHtzdHJpbmd9IFttb2RlLnR4dF0gLSB0ZXh0IHRvIGJlIGRpc3BsYXllZCBpbiB0aGUgY2VudGVyIG9mIGNpcmNsZQoJCSAqLwoJCWNvbnN0cnVjdG9yKG1vZGUpIHsKCQkJc3VwZXIobW9kZSk7CgoJCQlpZih0eXBlb2YgbW9kZSA9PSAnb2JqZWN0JykgewoJCQkJbGV0IGcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoWE1MTlMsICdnJyk7CgoJCQkJdGhpcy54ID0gbW9kZS54OyB0aGlzLnkgPSBtb2RlLnk7IHRoaXMucmFkaXVzID0gbW9kZS5yYWRpdXM7CgkJCQlnLnNldEF0dHJpYnV0ZU5TKG51bGwsICd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyBtb2RlLnggKyAnLCAnICsgbW9kZS55ICsgJyknKTsKCQkJCWlmKG1vZGUuY2xhc3MpIGcuc2V0QXR0cmlidXRlTlMobnVsbCwgJ2NsYXNzJywgbW9kZS5jbGFzcyk7CgkJCQlnLmNsYXNzTGlzdC5hZGQoJ2NpcmNsZScpOwoKCQkJCWxldCBjaXJjbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoWE1MTlMsICdjaXJjbGUnKTsKCQkJCWNpcmNsZS5zZXRBdHRyaWJ1dGVOUyhudWxsLCAncicsIG1vZGUucmFkaXVzKTsKCQkJCWNpcmNsZS5zdHlsZS5zdHJva2UgPSBtb2RlLnN0cm9rZSB8fCAnJzsKCQkJCWNpcmNsZS5zdHlsZS5zdHJva2VXaWR0aCA9IG1vZGUuc3Ryb2tlV2lkdGggfHwgJyc7CgkJCQljaXJjbGUuc3R5bGUuZmlsbCA9IG1vZGUuZmlsbCB8fCAnJzsKCQkJCWcuYXBwZW5kQ2hpbGQoY2lyY2xlKTsKCgkJCQlsZXQgdGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhYTUxOUywgJ3RleHQnKTsKCQkJCWlmKG1vZGUudHh0ICE9IHVuZGVmaW5lZCkgdGV4dC5pbm5lckhUTUwgPSBtb2RlLnR4dDsKCQkJCWcuYXBwZW5kQ2hpbGQodGV4dCk7CgoJCQkJdGhpcy5jb250YWluZXIucHVzaChnKTsKCQkJfQoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgY29vcmRpbmF0ZXMgb2YgY29ubmVjdGlvbiBwb2ludAoJCSAqIEBwYXJhbSB7c3RyaW5nfSBmcm9tcCAtIFRoZSBwb3NpdGlvbiBvZiBjb25uZWN0aW9uICgnbCcgLSBsZWZ0IHNpZGUsICdyJyAtIHJpZ2h0IHNpZGUsICd1JyAtIHVwIHNpZGUsICdkJyAtIGRvd24gc2lkZSkKCQkgKiBAcmV0dXJucyB7T2JqZWN0fSBkYXRhIC0gVGhlIHBvc2l0aW9uIG9mIGNvbm5lY3Rpb24KCQkgKiBAcmV0dXJucyB7bnVtYmVyfSBkYXRhLnggLSBUaGUgeC1jb29yZGluYXRlIG9mIGNvbm5lY3Rpb24KCQkgKiBAcmV0dXJucyB7bnVtYmVyfSBkYXRhLnkgLSBUaGUgeS1jb29yZGluYXRlIG9mIGNvbm5lY3Rpb24KCQkgKi8KCQlnZXRDb25uZWN0aW9uKGZyb21wKSB7CgkJCWxldCB4ID0gKGZyb21wID09ICdsJyA/IHRoaXMueC10aGlzLnJhZGl1cy0yIDogKGZyb21wID09ICdyJyA/IHRoaXMueCt0aGlzLnJhZGl1cysyIDogdGhpcy54KSk7CgkJCWxldCB5ID0gKGZyb21wID09ICd1JyA/IHRoaXMueS10aGlzLnJhZGl1cy0yIDogKGZyb21wID09ICdkJyA/IHRoaXMueSt0aGlzLnJhZGl1cysyIDogdGhpcy55KSk7CgkJCXJldHVybiB7eDp4LCB5Onl9OwoJCX0KCX0KCgkvKioKCSAqIENsYXNzIHJlcHJlc2VudGluZyBhIHJlY3RhbmdsZQoJICogQG1lbWJlcm9mIE93bERyYXcKCSAqIEBleHRlbmRzIE93bERyYXcuY29ubmVjdGFibGUKCSAqCgkgKiBAcHJvcGVydHkge0VsZW1lbnRbXX0gY29udGFpbmVyIC0gQXJyYXkgb2YgRE9NIGVsZW1lbnRzIChTVkdFbGVtZW50KSB0aGF0IGFyZSBhZGRlZCB0byB0aGUgc3ZnIERPTQoJICogQHByb3BlcnR5IHtPYmplY3RbXX0gY29ubmVjdGlvbnMgLSBMaXN0IG9mIGxpbmVzLCBhcnJvd3MsIHRoYXQgYXJlIGNvbm5lY3RlZCB0byB0aGUgZWxlbWVudCBhbmQgbW92ZSB3aXRoIGl0LgoJICogQHByb3BlcnR5IHsoT3dsRHJhdy5saW5lfE93bERyYXcuYXJyb3d8T3dsRHJhdy5uaWNlQXJyb3cpfSBjb25uZWN0aW9ucy5vYmplY3QgLSBUaGUgbGluZSBvciBhcnJvdywgdGhhdCB3aWxsIGJlIGNvbm5lY3RlZAoJICogQHByb3BlcnR5IHtudW1iZXJ9IGNvbm5lY3Rpb25zLnR5cGUgLSBJZiAxLCB0aGFuIHRoZSBiZWdpbm5pbmcgcGFydCBvZiBsaW5lIG9yIGFycm93IHdpbGwgYmUgY29ubmVjdGVkLCBpZiAyLCB0aGVuIHRoZSBlbmRpbmcgcGFydCAodGhlIG9uZSB3aXRoIHRoZSBhcnJvd2hlYWQpCgkgKiBAcHJvcGVydHkge251bWJlcn0geCAtIFRoZSB0b3AtbGVmdCB4LWNvb3JkaW5hdGUgb2YgZWxlbWVudAoJICogQHByb3BlcnR5IHtudW1iZXJ9IHkgLSBUaGUgdG9wLWxlZnQgeS1jb29yZGluYXRlIG9mIGVsZW1lbnQKCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB4MiAtIFRoZSBib3R0b20tcmlnaHQgeC1jb29yZGluYXRlIG9mIGVsZW1lbnQKCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB5MiAtIFRoZSBib3R0b20tcmlnaHQgeS1jb29yZGluYXRlIG9mIGVsZW1lbnQKCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgZWxlbWVudAoJICogQHByb3BlcnR5IHtudW1iZXJ9IGhlaWdodCAtIFRoZSBoZWlnaHQgb2YgdGhlIGVsZW1lbnQKCSAqLwoJT3dsRHJhdy5yZWN0ID0gY2xhc3MgZXh0ZW5kcyBPd2xEcmF3LmNvbm5lY3RhYmxlIHsKCQkvKioKCQkgKiBDcmVhdGVzIGEgcmVjdGFuZ2xlCgkJICogQHBhcmFtIHsoc3RyaW5nfEVsZW1lbnR8T2JqZWN0KX0gbW9kZSAtIERhdGEgZGVzY3JpYmluZyB0aGUgcmVjdGFuZ2xlIChzZWUge0BsaW5rIE93bERyYXcuZWxlbWVudH0pCgkJICogQHBhcmFtIHtudW1iZXJ9IG1vZGUueCAtIHRvcC1sZWZ0IHgtY29vcmRpbmF0ZSBvZiB0aGUgcmVjdGFuZ2xlCgkJICogQHBhcmFtIHtudW1iZXJ9IG1vZGUueSAtIHRvcC1sZWZ0IHktY29vcmRpbmF0ZSBvZiB0aGUgcmVjdGFuZ2xlCgkJICogQHBhcmFtIHtudW1iZXJ9IFttb2RlLndpZHRoXSAtIHdpZHRoIG9mIHRoZSByZWN0YW5nbGUKCQkgKiBAcGFyYW0ge251bWJlcn0gW21vZGUuaGVpZ2h0XSAtIGhlaWdodCBvZiB0aGUgcmVjdGFuZ2xlCgkJICogQHBhcmFtIHtudW1iZXJ9IFttb2RlLngyXSAtIGJvdHRvbS1yaWdodCB4LWNvb3JkaW5hdGUgb2YgdGhlIHJlY3RhbmdsZQoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbW9kZS55Ml0gLSBib3R0b20tcmlnaHQgeS1jb29yZGluYXRlIG9mIHRoZSByZWN0YW5nbGUKCQkgKiBAcGFyYW0ge3N0cmluZ30gW21vZGUuY2xhc3NdIC0gbGlzdCBvZiBjbGFzcyB0aGF0IHdpbGwgYmUgYWRkZWQgdG8gdGhlIERPTSBlbGVtZW50CgkJICogQHBhcmFtIHtzdHJpbmd9IFttb2RlLnN0cm9rZV0gLSBjb2xvciBvZiBzdHJva2UsIHRoYXQgYXBwbGllcyB0byB0aGUgcmVjdGFuZ2xlCgkJICogQHBhcmFtIHtudW1iZXJ9IFttb2RlLnN0cm9rZVdpZHRoXSAtIHdpZHRoIG9mIHN0cm9rZSwgdGhhdCBhcHBsaWVzIHRvIHRoZSByZWN0YW5nbGUKCQkgKiBAcGFyYW0ge3N0cmluZ30gW21vZGUuZmlsbF0gLSBjb2xvciBvZiBmaWxsLCB0aGF0IGFwcGxpZXMgdG8gdGhlIHJlY3RhbmdsZQoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbbW9kZS50eHRdIC0gdGV4dCB0byBiZSBkaXNwbGF5ZWQgaW4gdGhlIGNlbnRlciBvZiByZWN0YW5nbGUKCQkgKiBAcGFyYW0ge3N0cmluZ30gW21vZGUuYm9yZGVyUmFkaXVzXSAtIHRoaXMgYm9yZGVyUmFkaXVzIG9mIHRoZSByZWN0YW5nbGUKCQkgKi8KCQljb25zdHJ1Y3Rvcihtb2RlKSB7CgkJCXN1cGVyKG1vZGUpOwoKCQkJaWYodHlwZW9mIG1vZGUgPT0gJ29iamVjdCcpIHsKCQkJCWxldCBnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFhNTE5TLCAnZycpOwoKCQkJCXRoaXMueCA9IG1vZGUueDsgdGhpcy55ID0gbW9kZS55OwoJCQkJdGhpcy53aWR0aCA9IG1vZGUud2lkdGggfHwgKG1vZGUueDIgLSB0aGlzLngpOyB0aGlzLmhlaWdodCA9IG1vZGUuaGVpZ2h0IHx8IChtb2RlLnkyIC0gdGhpcy55KTsKCQkJCXRoaXMueDIgPSB0aGlzLnggKyB0aGlzLndpZHRoOyB0aGlzLnkyID0gdGhpcy55ICsgdGhpcy5oZWlnaHQ7CgkJCQlnLnNldEF0dHJpYnV0ZU5TKG51bGwsICd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyBtb2RlLnggKyAnLCAnICsgbW9kZS55ICsgJyknKTsKCQkJCWlmKG1vZGUuY2xhc3MpIGcuc2V0QXR0cmlidXRlTlMobnVsbCwgJ2NsYXNzJywgbW9kZS5jbGFzcyk7CgkJCQlnLmNsYXNzTGlzdC5hZGQoJ3JlY3QnKTsKCgkJCQlsZXQgcmVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhYTUxOUywgJ3JlY3QnKTsKCQkJCXJlY3Quc2V0QXR0cmlidXRlTlMobnVsbCwgJ3dpZHRoJywgdGhpcy53aWR0aCk7CgkJCQlyZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsICdoZWlnaHQnLCB0aGlzLmhlaWdodCk7CgkJCQlyZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsICdyeCcsIG1vZGUuYm9yZGVyUmFkaXVzIHx8IDApOwoJCQkJcmVjdC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAncnknLCBtb2RlLmJvcmRlclJhZGl1cyB8fCAwKTsKCQkJCXJlY3Quc3R5bGUuc3Ryb2tlID0gbW9kZS5zdHJva2UgfHwgJyc7CgkJCQlyZWN0LnN0eWxlLnN0cm9rZVdpZHRoID0gbW9kZS5zdHJva2VXaWR0aCB8fCAnJzsKCQkJCXJlY3Quc3R5bGUuZmlsbCA9IG1vZGUuZmlsbCB8fCAnJzsKCQkJCWcuYXBwZW5kQ2hpbGQocmVjdCk7CgoJCQkJbGV0IHRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoWE1MTlMsICd0ZXh0Jyk7CgkJCQl0ZXh0LmlubmVySFRNTCA9IG1vZGUudHh0IHx8ICcnOwoJCQkJdGV4dC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAneCcsICh0aGlzLndpZHRoLzIpICsgJ3B4Jyk7CgkJCQl0ZXh0LnNldEF0dHJpYnV0ZU5TKG51bGwsICd5JywgKHRoaXMuaGVpZ2h0LzIpICsgJ3B4Jyk7CgkJCQlnLmFwcGVuZENoaWxkKHRleHQpOwoKCQkJCXRoaXMuY29udGFpbmVyLnB1c2goZyk7CgkJCX0KCQl9CgoJCS8qKgoJCSAqIE1vdmVzIHRoZSBlbGVtZW50LCBhbmQgdXBkYXRlcyB0aGUgcG9zaXRpb24gZGF0YS4gQWxzbyBtb3ZlcyB0aGUgY29ubmVjdGVkIGxpbmVzLCBhcnJvd3MuIChzZWUge0BsaW5rIE93bERyYXcuZWxlbWVudCNtb3ZlfSkKCQkgKiBAcGFyYW0ge09iamVjdH0gb3B0IC0gRGF0YSBkZXNjcmliaW5nIHRoZSB0cmFuc2l0aW9uCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHQueF0gLSBJZiBkZWZpbmVkLCB0aGUgeC1jb29yZGluYXRlIG9mIHBvc2l0aW9uIHdpbGwgYmUgdGhpcyB2YWx1ZQoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0LnldIC0gSWYgZGVmaW5lZCwgdGhlIHktY29vcmRpbmF0ZSBvZiBwb3NpdGlvbiB3aWxsIGJlIHRoaXMgdmFsdWUKCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdC5keF0gLSBJZiBkZWZpbmVkLCB0aGUgeC1jb29yZGluYXRlIG9mIHBvc2l0aW9uIHdpbGwgYmUgaW5jcmVhc2VkIGJ5IHRoaXMgdmFsdWUKCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdC5keV0gLSBJZiBkZWZpbmVkLCB0aGUgeS1jb29yZGluYXRlIG9mIHBvc2l0aW9uIHdpbGwgYmUgaW5jcmVhc2VkIGJ5IHRoaXMKCQkgKi8KCQltb3ZlKG9wdCkgewoJCQlzdXBlci5tb3ZlKG9wdCk7CgoJCQlpZihvcHQueCAhPSB1bmRlZmluZWQpIHsKCQkJCXRoaXMueDIgPSBvcHQueCArIHRoaXMud2lkdGg7IHRoaXMueTIgPSBvcHQueSArIHRoaXMuaGVpZ2h0OwoJCQl9CgkJCWVsc2UgaWYob3B0LmR4ICE9IHVuZGVmaW5lZCkgewoJCQkJdGhpcy54MiArPSBvcHQuZHg7IHRoaXMueTIgKz0gb3B0LmR5OwoJCQl9CgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBjb29yZGluYXRlcyBvZiBjb25uZWN0aW9uIHBvaW50CgkJICogQHBhcmFtIHtzdHJpbmd9IGZyb21wIC0gVGhlIHBvc2l0aW9uIG9mIGNvbm5lY3Rpb24gKCdsJyAtIGxlZnQgc2lkZSwgJ3InIC0gcmlnaHQgc2lkZSwgJ3UnIC0gdXAgc2lkZSwgJ2QnIC0gZG93biBzaWRlKQoJCSAqIEByZXR1cm5zIHtPYmplY3R9IGRhdGEgLSBUaGUgcG9zaXRpb24gb2YgY29ubmVjdGlvbgoJCSAqIEByZXR1cm5zIHtudW1iZXJ9IGRhdGEueCAtIFRoZSB4LWNvb3JkaW5hdGUgb2YgY29ubmVjdGlvbgoJCSAqIEByZXR1cm5zIHtudW1iZXJ9IGRhdGEueSAtIFRoZSB5LWNvb3JkaW5hdGUgb2YgY29ubmVjdGlvbgoJCSAqLwoJCWdldENvbm5lY3Rpb24oZnJvbXApIHsKCQkJbGV0IHggPSAoZnJvbXAgPT0gJ2wnID8gdGhpcy54IDogKGZyb21wID09ICdyJyA/IHRoaXMueDIgOiAoKHRoaXMueCArIHRoaXMueDIpIC8gMikpKTsKCQkJbGV0IHkgPSAoZnJvbXAgPT0gJ3UnID8gdGhpcy55IDogKGZyb21wID09ICdkJyA/IHRoaXMueTIgOiAoKHRoaXMueSArIHRoaXMueTIpIC8gMikpKTsKCQkJcmV0dXJuIHt4OngsIHk6eX07CgkJfQoJfQoKCS8qKgoJICogQ2xhc3MgcmVwcmVzZW50aW5nIGEgbGluZQoJICogQG1lbWJlcm9mIE93bERyYXcKCSAqIEBleHRlbmRzIE93bERyYXcuZWxlbWVudAoJICoKCSAqIEBwcm9wZXJ0eSB7RWxlbWVudFtdfSBjb250YWluZXIgLSBBcnJheSBvZiBET00gZWxlbWVudHMgKFNWR0VsZW1lbnQpIHRoYXQgYXJlIGFkZGVkIHRvIHRoZSBzdmcgRE9NCgkgKiBAcHJvcGVydHkge251bWJlcn0gW3gxXSAtIFRoZSB4LWNvb3JkaW5hdGUgb2YgYmVnaW5uaW5nIG9mIGxpbmUKCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbeTFdIC0gVGhlIHktY29vcmRpbmF0ZSBvZiBiZWdpbm5pbmcgb2YgbGluZQoJICogQHByb3BlcnR5IHtudW1iZXJ9IFt4Ml0gLSBUaGUgeC1jb29yZGluYXRlIG9mIGVuZCBvZiBsaW5lCgkgKiBAcHJvcGVydHkge251bWJlcn0gW3kyXSAtIFRoZSB5LWNvb3JkaW5hdGUgb2YgZW5kIG9mIGxpbmUKCSAqIEBwcm9wZXJ0eSB7T3dsRHJhdy5jb25uZWN0YWJsZX0gW2Zyb21dIC0gVGhlIGVsZW1lbnQsIHRoZSBsaW5lIHdpbGwgYmUgZHJhd24gZnJvbS4KCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbZnJvbXBdIC0gVGhlIHBvc2l0aW9uLCB0aGUgYXJyb3cgd2lsbCBiZSBsaW5lIGZyb20gKCdsJyAtIGxlZnQgc2lkZSwgJ3InIC0gcmlnaHQgc2lkZSwgJ3UnIC0gdXAgc2lkZSwgJ2QnIC0gZG93biBzaWRlKQoJICogQHByb3BlcnR5IHtPd2xEcmF3LmNvbm5lY3RhYmxlfG51bGx9IFt0b10gLSBUaGUgZWxlbWVudCwgdGhlIGxpbmUgd2lsbCBiZSBkcmF3biB0by4KCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbdG9wXSAtIFRoZSBwb3NpdGlvbiwgdGhlIGxpbmUgd2lsbCBiZSBkcmF3biB0byAoJ2wnIC0gbGVmdCBzaWRlLCAncicgLSByaWdodCBzaWRlLCAndScgLSB1cCBzaWRlLCAnZCcgLSBkb3duIHNpZGUpCgkgKi8KCU93bERyYXcubGluZSA9IGNsYXNzIGV4dGVuZHMgT3dsRHJhdy5lbGVtZW50IHsKCQkvKioKCQkgKiBDcmVhdGluZyBhbiBhcnJvdwoJCSAqIEBwYXJhbSB7T2JqZWN0fSBtb2RlIC0gRGF0YSBkZXNjcmliaW5nIHRoZSBsaW5lCgkJICogQHBhcmFtIHtudW1iZXJ9IFttb2RlLngxXSAtIFRoZSB4LWNvb3JkaW5hdGUgb2YgYmVnaW5uaW5nIG9mIGxpbmUKCQkgKiBAcGFyYW0ge251bWJlcn0gW21vZGUueTFdIC0gVGhlIHktY29vcmRpbmF0ZSBvZiBiZWdpbm5pbmcgb2YgbGluZQoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbW9kZS54Ml0gLSBUaGUgeC1jb29yZGluYXRlIG9mIGVuZCBvZiBsaW5lCgkJICogQHBhcmFtIHtudW1iZXJ9IFttb2RlLnkyXSAtIFRoZSB5LWNvb3JkaW5hdGUgb2YgZW5kIG9mIGxpbmUKCQkgKiBAcGFyYW0ge093bERyYXcuY29ubmVjdGFibGV9IFttb2RlLmZyb21dIC0gVGhlIGVsZW1lbnQsIHRoZSBsaW5lIHdpbGwgYmUgZHJhd24gZnJvbQoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbbW9kZS5mcm9tcF0gLSBUaGUgcG9zaXRpb24sIHRoZSBsaW5lIHdpbGwgYmUgZHJhd24gZnJvbSAoJ2wnIC0gbGVmdCBzaWRlLCAncicgLSByaWdodCBzaWRlLCAndScgLSB1cCBzaWRlLCAnZCcgLSBkb3duIHNpZGUpCgkJICogQHBhcmFtIHtPd2xEcmF3LmNvbm5lY3RhYmxlfG51bGx9IFttb2RlLnRvXSAtIFRoZSBlbGVtZW50LCB0aGUgbGluZSB3aWxsIGJlIGRyYXduIHRvLiBJZiBudWxsLCB0aGFuIHRoZSBhcnJvdyBpcyBpbnZpc2libGUuCgkJICogQHBhcmFtIHtzdHJpbmd9IFttb2RlLnRvcF0gLSBUaGUgcG9zaXRpb24sIHRoZSBsaW5lIHdpbGwgYmUgZHJhd24gdG8gKCdsJyAtIGxlZnQgc2lkZSwgJ3InIC0gcmlnaHQgc2lkZSwgJ3UnIC0gdXAgc2lkZSwgJ2QnIC0gZG93biBzaWRlKQoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbbW9kZS5jbGFzc10gLSBsaXN0IG9mIGNsYXNzIHRoYXQgd2lsbCBiZSBhZGRlZCB0byB0aGUgRE9NIGVsZW1lbnQKCQkgKiBAcGFyYW0ge3N0cmluZ30gW21vZGUuc3Ryb2tlXSAtIGNvbG9yIG9mIHN0cm9rZSwgdGhhdCBhcHBsaWVzIHRvIHRoZSBsaW5lCgkJICogQHBhcmFtIHtudW1iZXJ9IFttb2RlLnN0cm9rZVdpZHRoXSAtIHdpZHRoIG9mIHN0cm9rZSwgdGhhdCBhcHBsaWVzIHRvIHRoZSBsaW5lCgkJICovCgkJY29uc3RydWN0b3IobW9kZSkgewoJCQlzdXBlcihtb2RlKTsKCgkJCWlmKHR5cGVvZiBtb2RlID09ICdvYmplY3QnICYmIG1vZGUueDEgIT0gdW5kZWZpbmVkKSB7CgkJCQlsZXQgZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhYTUxOUywgJ2cnKTsKCgkJCQl0aGlzLngxID0gbW9kZS54MTsgdGhpcy55MSA9IG1vZGUueTE7CgkJCQl0aGlzLngyID0gbW9kZS54MjsgdGhpcy55MiA9IG1vZGUueTI7CgkJCQlpZihtb2RlLmNsYXNzKSBnLnNldEF0dHJpYnV0ZU5TKG51bGwsICdjbGFzcycsIG1vZGUuY2xhc3MpOwoJCQkJZy5jbGFzc0xpc3QuYWRkKCdsaW5lJyk7CgoJCQkJbGV0IGxpbmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoWE1MTlMsICdsaW5lJyk7CgkJCQlsaW5lLnNldEF0dHJpYnV0ZU5TKG51bGwsICd4MScsIHRoaXMueDEpOwoJCQkJbGluZS5zZXRBdHRyaWJ1dGVOUyhudWxsLCAneTEnLCB0aGlzLnkxKTsKCQkJCWxpbmUuc2V0QXR0cmlidXRlTlMobnVsbCwgJ3gyJywgdGhpcy54Mik7CgkJCQlsaW5lLnNldEF0dHJpYnV0ZU5TKG51bGwsICd5MicsIHRoaXMueTIpOwoJCQkJbGluZS5zdHlsZS5zdHJva2UgPSBtb2RlLnN0cm9rZSB8fCAnJzsKCQkJCWxpbmUuc3R5bGUuc3Ryb2tlV2lkdGggPSBtb2RlLnN0cm9rZVdpZHRoIHx8ICcnOwoJCQkJZy5hcHBlbmRDaGlsZChsaW5lKTsKCgkJCQl0aGlzLmNvbnRhaW5lci5wdXNoKGcpOwoJCQl9CgoJCQlpZih0eXBlb2YgbW9kZSA9PSAnb2JqZWN0JyAmJiBtb2RlLmZyb20gIT0gdW5kZWZpbmVkKSB7CgkJCQlsZXQgZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhYTUxOUywgJ2cnKTsKCgkJCQl0aGlzLngxID0gbW9kZS5mcm9tLmdldENvbm5lY3Rpb24obW9kZS5mcm9tcCkueDsKCQkJCXRoaXMueTEgPSBtb2RlLmZyb20uZ2V0Q29ubmVjdGlvbihtb2RlLmZyb21wKS55OwoJCQkJaWYobW9kZS5iaW5kICE9IGZhbHNlKSBtb2RlLmZyb20uY29ubmVjdCh0aGlzLCAxKTsKCQkJCXRoaXMuZnJvbSA9IG1vZGUuZnJvbTsKCgkJCQlpZihtb2RlLnRvKSB0aGlzLngyID0gbW9kZS50by5nZXRDb25uZWN0aW9uKG1vZGUudG9wKS54OwoJCQkJaWYobW9kZS50bykgdGhpcy55MiA9IG1vZGUudG8uZ2V0Q29ubmVjdGlvbihtb2RlLnRvcCkueTsKCQkJCWlmKG1vZGUuYmluZCAhPSBmYWxzZSAmJiBtb2RlLnRvICE9IG51bGwpIHsKCQkJCQltb2RlLnRvLmNvbm5lY3QodGhpcywgMik7CgkJCQkJdGhpcy50byA9IG1vZGUudG87CgkJCQl9CgkJCQllbHNlIGlmKG1vZGUuYmluZCAhPSBmYWxzZSAmJiBtb2RlLnRvID09IG51bGwpIHsKCQkJCQltb2RlLmZyb20uY29ubmVjdCh0aGlzLCAyKTsKCQkJCQl0aGlzLnRvID0gbW9kZS5mcm9tOwoJCQkJfQoKCQkJCWlmKG1vZGUuY2xhc3MpIGcuc2V0QXR0cmlidXRlTlMobnVsbCwgJ2NsYXNzJywgbW9kZS5jbGFzcyk7CgkJCQlnLmNsYXNzTGlzdC5hZGQoJ2Fycm93Jyk7CgkJCQlpZihtb2RlLnRvID09IG51bGwpIGcuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCgkJCQlsZXQgbGluZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhYTUxOUywgJ2xpbmUnKTsKCQkJCWxpbmUuc2V0QXR0cmlidXRlTlMobnVsbCwgJ3gxJywgdGhpcy54MSk7CgkJCQlsaW5lLnNldEF0dHJpYnV0ZU5TKG51bGwsICd5MScsIHRoaXMueTEpOwoJCQkJbGluZS5zZXRBdHRyaWJ1dGVOUyhudWxsLCAneDInLCB0aGlzLngyIHx8ICh0aGlzLngyID0gdGhpcy54MSkpOwoJCQkJbGluZS5zZXRBdHRyaWJ1dGVOUyhudWxsLCAneTInLCB0aGlzLnkyIHx8ICh0aGlzLnkyID0gdGhpcy55MSkpOwoJCQkJbGluZS5zdHlsZS5zdHJva2UgPSBtb2RlLnN0cm9rZSB8fCAnJzsKCQkJCWxpbmUuc3R5bGUuc3Ryb2tlV2lkdGggPSBtb2RlLnN0cm9rZVdpZHRoIHx8ICcnOwoJCQkJZy5hcHBlbmRDaGlsZChsaW5lKTsKCgkJCQl0aGlzLmNvbnRhaW5lci5wdXNoKGcpOwoJCQl9CgkJfQoKCQkvKioKCQkgKiBNb3ZlcyB0aGUgbGluZS4gRWFjaCBvZiB0aGUgZW5kIHBvaW50cyBjYW4gYmUgbW92ZWQgc2VwYXJhdGVseSBhbmQgc2ltdWx0YW5lb3VzbHksIG9yIHRoZSB3aG9sZSBsaW5lIGNhbiBiZSBtb3ZlZC4gRWl0aGVyIHgxIGFuZCB5MSwgZHgxIGFuZCBkeTEsIHgyIGFuZCB5MiwgZHgyIGFuZCBkeTIgb3IgZHggYW5kIGR5IG11c3QgYmUgZGVmaW5lZC4KCQkgKiBAcGFyYW0ge0RyYXdMaW5lTW92ZU9wdH0gb3B0IC0gRGF0YSBkZXNjcmliaW5nIHRoZSB0cmFuc2l0aW9uCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHQueDFdIC0gTmV3IHgtY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnQgb2YgYmVnaW5uaW5nCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHQueTFdIC0gTmV3IHktY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnQgb2YgYmVnaW5uaW5nCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHQuZHgxXSAtIFRoZSB2YWx1ZSB3aWxsIGJlIGFkZGVkIHRvIHRoZSB4LWNvb3JkaW5hdGUgb2YgdGhlIHBvaW50IG9mIGJlZ2lubmluZwoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0LmR5MV0gLSBUaGUgdmFsdWUgd2lsbCBiZSBhZGRlZCB0byB0aGUgeS1jb29yZGluYXRlIG9mIHRoZSBwb2ludCBvZiBiZWdpbm5pbmcKCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdC54Ml0gLSBOZXcgeC1jb29yZGluYXRlIG9mIHRoZSBwb2ludCBvZiBlbmRpbmcKCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdC55Ml0gLSBOZXcgeS1jb29yZGluYXRlIG9mIHRoZSBwb2ludCBvZiBlbmRpbmcKCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdC5keDJdIC0gVGhlIHZhbHVlIHdpbGwgYmUgYWRkZWQgdG8gdGhlIHgtY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnQgb2YgZW5kaW5nCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHQuZHkyXSAtIFRoZSB2YWx1ZSB3aWxsIGJlIGFkZGVkIHRvIHRoZSB5LWNvb3JkaW5hdGUgb2YgdGhlIHBvaW50IG9mIGVuZGluZwoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0LmR4XSAtIFRoZSB2YWx1ZSB3aWxsIGJlIGFkZGVkIHRvIHRoZSB4LWNvb3JkaW5hdGUgb2YgYm90aCB0aGUgcG9pbnQgb2YgZW5kaW5nIGFuZCBiZWdpbm5pbmcKCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdC5keV0gLSBUaGUgdmFsdWUgd2lsbCBiZSBhZGRlZCB0byB0aGUgeS1jb29yZGluYXRlIG9mIGJvdGggdGhlIHBvaW50IG9mIGVuZGluZyBhbmQgYmVnaW5uaW5nCgkJICovCgkJbW92ZShvcHQpIHsKCQkJbGV0IG94MSA9IHRoaXMueDEsIG95MSA9IHRoaXMueTEsIG94MiA9IHRoaXMueDIsIG95MiA9IHRoaXMueTI7CgoJCQlpZihvcHQueDEgIT0gdW5kZWZpbmVkKSB7CgkJCQl0aGlzLngxID0gb3B0LngxOwoJCQkJdGhpcy55MSA9IG9wdC55MTsKCQkJfQoJCQllbHNlIGlmKG9wdC5keDEgIT0gdW5kZWZpbmVkKSB7CgkJCQl0aGlzLngxICs9IG9wdC5keDE7CgkJCQl0aGlzLnkxICs9IG9wdC5keTE7CgkJCX0KCQkJZWxzZSBpZihvcHQuZHggIT0gdW5kZWZpbmVkKSB7CgkJCQl0aGlzLngxICs9IG9wdC5keDsKCQkJCXRoaXMueTEgKz0gb3B0LmR5OwoJCQl9CgoJCQlpZihvcHQueDIgIT0gdW5kZWZpbmVkKSB7CgkJCQl0aGlzLngyID0gb3B0LngyOwoJCQkJdGhpcy55MiA9IG9wdC55MjsKCQkJfQoJCQllbHNlIGlmKG9wdC5keDIgIT0gdW5kZWZpbmVkKSB7CgkJCQl0aGlzLngyICs9IG9wdC5keDI7CgkJCQl0aGlzLnkyICs9IG9wdC5keTI7CgkJCX0KCQkJZWxzZSBpZihvcHQuZHggIT0gdW5kZWZpbmVkKSB7CgkJCQl0aGlzLngyICs9IG9wdC5keDsKCQkJCXRoaXMueTIgKz0gb3B0LmR5OwoJCQl9CgoJCQlsZXQgYW5pbWF0ZTAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoWE1MTlMsICdhbmltYXRlJyk7CgkJCWFuaW1hdGUwLnNldEF0dHJpYnV0ZU5TKG51bGwsICdhdHRyaWJ1dGVOYW1lJywgJ3gxJyk7CgkJCWFuaW1hdGUwLnNldEF0dHJpYnV0ZU5TKG51bGwsICdmcm9tJywgb3gxKTsKCQkJYW5pbWF0ZTAuc2V0QXR0cmlidXRlTlMobnVsbCwgJ3RvJywgdGhpcy54MSk7CgkJCWFuaW1hdGUwLnNldEF0dHJpYnV0ZU5TKG51bGwsICdkdXInLCBEVVJBVElPTiArICdzJyk7CgkJCWFuaW1hdGUwLnNldEF0dHJpYnV0ZU5TKG51bGwsICdiZWdpbicsICdpbmRlZmluaXRlJyk7CgkJCWFuaW1hdGUwLnNldEF0dHJpYnV0ZU5TKG51bGwsICdmaWxsJywgJ2ZyZWV6ZScpOwoKCQkJbGV0IGFuaW1hdGUxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFhNTE5TLCAnYW5pbWF0ZScpOwoJCQlhbmltYXRlMS5zZXRBdHRyaWJ1dGVOUyhudWxsLCAnYXR0cmlidXRlTmFtZScsICd5MScpOwoJCQlhbmltYXRlMS5zZXRBdHRyaWJ1dGVOUyhudWxsLCAnZnJvbScsIG95MSk7CgkJCWFuaW1hdGUxLnNldEF0dHJpYnV0ZU5TKG51bGwsICd0bycsIHRoaXMueTEpOwoJCQlhbmltYXRlMS5zZXRBdHRyaWJ1dGVOUyhudWxsLCAnZHVyJywgRFVSQVRJT04gKyAncycpOwoJCQlhbmltYXRlMS5zZXRBdHRyaWJ1dGVOUyhudWxsLCAnYmVnaW4nLCAnaW5kZWZpbml0ZScpOwoJCQlhbmltYXRlMS5zZXRBdHRyaWJ1dGVOUyhudWxsLCAnZmlsbCcsICdmcmVlemUnKTsKCgkJCWxldCBhbmltYXRlMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhYTUxOUywgJ2FuaW1hdGUnKTsKCQkJYW5pbWF0ZTIuc2V0QXR0cmlidXRlTlMobnVsbCwgJ2F0dHJpYnV0ZU5hbWUnLCAneDInKTsKCQkJYW5pbWF0ZTIuc2V0QXR0cmlidXRlTlMobnVsbCwgJ2Zyb20nLCBveDIpOwoJCQlhbmltYXRlMi5zZXRBdHRyaWJ1dGVOUyhudWxsLCAndG8nLCB0aGlzLngyKTsKCQkJYW5pbWF0ZTIuc2V0QXR0cmlidXRlTlMobnVsbCwgJ2R1cicsIERVUkFUSU9OICsgJ3MnKTsKCQkJYW5pbWF0ZTIuc2V0QXR0cmlidXRlTlMobnVsbCwgJ2JlZ2luJywgJ2luZGVmaW5pdGUnKTsKCQkJYW5pbWF0ZTIuc2V0QXR0cmlidXRlTlMobnVsbCwgJ2ZpbGwnLCAnZnJlZXplJyk7CgoJCQlsZXQgYW5pbWF0ZTMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoWE1MTlMsICdhbmltYXRlJyk7CgkJCWFuaW1hdGUzLnNldEF0dHJpYnV0ZU5TKG51bGwsICdhdHRyaWJ1dGVOYW1lJywgJ3kyJyk7CgkJCWFuaW1hdGUzLnNldEF0dHJpYnV0ZU5TKG51bGwsICdmcm9tJywgb3kyKTsKCQkJYW5pbWF0ZTMuc2V0QXR0cmlidXRlTlMobnVsbCwgJ3RvJywgdGhpcy55Mik7CgkJCWFuaW1hdGUzLnNldEF0dHJpYnV0ZU5TKG51bGwsICdkdXInLCBEVVJBVElPTiArICdzJyk7CgkJCWFuaW1hdGUzLnNldEF0dHJpYnV0ZU5TKG51bGwsICdiZWdpbicsICdpbmRlZmluaXRlJyk7CgkJCWFuaW1hdGUzLnNldEF0dHJpYnV0ZU5TKG51bGwsICdmaWxsJywgJ2ZyZWV6ZScpOwoKCQkJaWYob3B0LngxICE9IHVuZGVmaW5lZCB8fCBvcHQuZHgxICE9IHVuZGVmaW5lZCB8fCBvcHQuZHkgIT0gdW5kZWZpbmVkKSB7CgkJCQl0aGlzLmNvbnRhaW5lclswXS5jaGlsZHJlblswXS5hcHBlbmRDaGlsZChhbmltYXRlMCk7CgkJCQl0aGlzLmNvbnRhaW5lclswXS5jaGlsZHJlblswXS5hcHBlbmRDaGlsZChhbmltYXRlMSk7CgkJCQlhbmltYXRlMC5iZWdpbkVsZW1lbnQoKTsKCQkJCWFuaW1hdGUxLmJlZ2luRWxlbWVudCgpOwoJCQl9CgkJCWlmKG9wdC54MiAhPSB1bmRlZmluZWQgfHwgb3B0LmR4MiAhPSB1bmRlZmluZWQgfHwgb3B0LmR5ICE9IHVuZGVmaW5lZCkgewoJCQkJdGhpcy5jb250YWluZXJbMF0uY2hpbGRyZW5bMF0uYXBwZW5kQ2hpbGQoYW5pbWF0ZTIpOwoJCQkJdGhpcy5jb250YWluZXJbMF0uY2hpbGRyZW5bMF0uYXBwZW5kQ2hpbGQoYW5pbWF0ZTMpOwoJCQkJYW5pbWF0ZTIuYmVnaW5FbGVtZW50KCk7CgkJCQlhbmltYXRlMy5iZWdpbkVsZW1lbnQoKTsKCQkJfQoKCQkJc2V0VGltZW91dCgoKSA9PiB7CgkJCQlpZihvcHQueDEgIT0gdW5kZWZpbmVkIHx8IG9wdC5keDEgIT0gdW5kZWZpbmVkIHx8IG9wdC5keSAhPSB1bmRlZmluZWQpIHsKCQkJCQl0aGlzLmNvbnRhaW5lclswXS5jaGlsZHJlblswXS5yZW1vdmVDaGlsZChhbmltYXRlMCk7CgkJCQkJdGhpcy5jb250YWluZXJbMF0uY2hpbGRyZW5bMF0ucmVtb3ZlQ2hpbGQoYW5pbWF0ZTEpOwoJCQkJCXRoaXMuY29udGFpbmVyWzBdLmNoaWxkcmVuWzBdLnNldEF0dHJpYnV0ZU5TKG51bGwsICd4MScsIHRoaXMueDEpOwoJCQkJCXRoaXMuY29udGFpbmVyWzBdLmNoaWxkcmVuWzBdLnNldEF0dHJpYnV0ZU5TKG51bGwsICd5MScsIHRoaXMueTEpOwoJCQkJfQoJCQkJaWYob3B0LngyICE9IHVuZGVmaW5lZCB8fCBvcHQuZHgyICE9IHVuZGVmaW5lZCB8fCBvcHQuZHkgIT0gdW5kZWZpbmVkKSB7CgkJCQkJdGhpcy5jb250YWluZXJbMF0uY2hpbGRyZW5bMF0ucmVtb3ZlQ2hpbGQoYW5pbWF0ZTIpOwoJCQkJCXRoaXMuY29udGFpbmVyWzBdLmNoaWxkcmVuWzBdLnJlbW92ZUNoaWxkKGFuaW1hdGUzKTsKCQkJCQl0aGlzLmNvbnRhaW5lclswXS5jaGlsZHJlblswXS5zZXRBdHRyaWJ1dGVOUyhudWxsLCAneDInLCB0aGlzLngyKTsKCQkJCQl0aGlzLmNvbnRhaW5lclswXS5jaGlsZHJlblswXS5zZXRBdHRyaWJ1dGVOUyhudWxsLCAneTInLCB0aGlzLnkyKTsKCQkJCX0KCQkJfSwgRFVSQVRJT04gKiAxMDAwKTsKCQl9CgoJCS8qKgoJCSAqIEJpbmRzIHRoZSBhcnJvdyB0byBhIGJlZ2dpbm5pbmcgZWxlbWVudCBhbmQgZW5kaW5nIGVsZW1lbnQKCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBtb2RlIC0gVGhlIG9iamVjdCBkZXNjcmliaW5nIHRoZSBiaW5kaW5nCgkJICogQHBhcmFtIHtPd2xEcmF3LmNvbm5lY3RhYmxlfSBbbW9kZS5mcm9tXSAtIFRoZSBlbGVtZW50LCB0aGUgYXJyb3cgd2lsbCBiZSBkcmF3biBmcm9tCgkJICogQHBhcmFtIHtzdHJpbmd9IFttb2RlLmZyb21wXSAtIFRoZSBwb3NpdGlvbiwgdGhlIGFycm93IHdpbGwgYmUgZHJhd24gZnJvbSAoJ2wnIC0gbGVmdCBzaWRlLCAncicgLSByaWdodCBzaWRlLCAndScgLSB1cCBzaWRlLCAnZCcgLSBkb3duIHNpZGUpCgkJICogQHBhcmFtIHtPd2xEcmF3LmNvbm5lY3RhYmxlfG51bGx9IFttb2RlLnRvXSAtIFRoZSBlbGVtZW50LCB0aGUgYXJyb3cgd2lsbCBiZSBkcmF3biB0by4gSWYgbnVsbCwgdGhhbiB0aGUgYXJyb3cgaXMgaW52aXNpYmxlLgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbbW9kZS50b3BdIC0gVGhlIHBvc2l0aW9uLCB0aGUgYXJyb3cgd2lsbCBiZSBkcmF3biB0byAoJ2wnIC0gbGVmdCBzaWRlLCAncicgLSByaWdodCBzaWRlLCAndScgLSB1cCBzaWRlLCAnZCcgLSBkb3duIHNpZGUpCgkJICovCgkJYmluZChtb2RlKSB7CgkJCXRoaXMuY29udGFpbmVyWzBdLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lJzsKCQkJaWYodGhpcy5mcm9tIGluc3RhbmNlb2YgT3dsRHJhdy5lbGVtZW50KSB7CgkJCQl0aGlzLmZyb20udW5jb25uZWN0KHRoaXMsIDEpOwoJCQl9CgkJCWlmKG1vZGUgIT0gdW5kZWZpbmVkICYmIG1vZGUuZnJvbSAhPSB1bmRlZmluZWQpIHsKCQkJCWxldCBveDEgPSB0aGlzLngxLCBveTEgPSB0aGlzLnkxLCBueDEsIG55MTsKCQkJCXRoaXMuZnJvbXAgPSBtb2RlLmZyb21wIHx8IHRoaXMuZnJvbXA7CgkJCQlueDEgPSBtb2RlLmZyb20uZ2V0Q29ubmVjdGlvbihtb2RlLmZyb21wKS54OwoJCQkJbnkxID0gbW9kZS5mcm9tLmdldENvbm5lY3Rpb24obW9kZS5mcm9tcCkueTsKCQkJCXRoaXMubW92ZSh7ZHgxOiBueDEgLSBveDEsIGR5MTogbnkxIC0gb3kxLCBmcm9tcDogdGhpcy5mcm9tcH0pOwoJCQkJdGhpcy5mcm9tID0gbW9kZS5mcm9tOwoJCQl9CgkJCWVsc2UgaWYobW9kZSAhPSB1bmRlZmluZWQgJiYgbW9kZS5mcm9tcCAhPSB1bmRlZmluZWQpIHsKCQkJCWxldCBveDEgPSB0aGlzLngxLCBveTEgPSB0aGlzLnkxLCBueDEsIG55MTsKCQkJCXRoaXMuZnJvbXAgPSBtb2RlLmZyb21wIHx8IHRoaXMuZnJvbXA7CgkJCQlueDEgPSB0aGlzLmZyb20uZ2V0Q29ubmVjdGlvbihtb2RlLmZyb21wKS54OwoJCQkJbnkxID0gdGhpcy5mcm9tLmdldENvbm5lY3Rpb24obW9kZS5mcm9tcCkueTsKCQkJCXRoaXMubW92ZSh7ZHgxOiBueDEgLSBveDEsIGR5MTogbnkxIC0gb3kxLCBmcm9tcDogdGhpcy5mcm9tcH0pOwoJCQl9CgkJCWlmKHRoaXMuZnJvbSBpbnN0YW5jZW9mIE93bERyYXcuZWxlbWVudCkgewoJCQkJdGhpcy5mcm9tLmNvbm5lY3QodGhpcywgMSk7CgkJCX0KCgkJCWlmKHRoaXMudG8gaW5zdGFuY2VvZiBPd2xEcmF3LmVsZW1lbnQpIHsKCQkJCXRoaXMudG8udW5jb25uZWN0KHRoaXMsIDIpOwoJCQl9CgkJCWlmKG1vZGUgIT0gdW5kZWZpbmVkICYmIG1vZGUudG8gIT0gdW5kZWZpbmVkICYmIG1vZGUudG8gIT0gbnVsbCkgewoJCQkJbGV0IG94MiA9IHRoaXMueDIsIG95MiA9IHRoaXMueTIsIG54MiwgbnkyOwoJCQkJdGhpcy50b3AgPSBtb2RlLnRvcCB8fCB0aGlzLnRvcDsKCQkJCW54MiA9IG1vZGUudG8uZ2V0Q29ubmVjdGlvbihtb2RlLnRvcCkueDsKCQkJCW55MiA9IG1vZGUudG8uZ2V0Q29ubmVjdGlvbihtb2RlLnRvcCkueTsKCQkJCXRoaXMubW92ZSh7ZHgyOiBueDIgLSBveDIsIGR5MjogbnkyIC0gb3kyLCB0b3A6IHRoaXMudG9wfSk7CgkJCQl0aGlzLnRvID0gbW9kZS50bzsKCQkJfQoJCQllbHNlIGlmKG1vZGUgIT0gdW5kZWZpbmVkICYmIG1vZGUudG8gPT0gbnVsbCkgewoJCQkJdGhpcy5tb3ZlKHt4MjogdGhpcy54MSwgeTI6IHRoaXMueTJ9KTsKCQkJCXRoaXMuY29udGFpbmVyWzBdLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgkJCX0KCQkJaWYodGhpcy50byBpbnN0YW5jZW9mIE93bERyYXcuZWxlbWVudCkgewoJCQkJdGhpcy50by5jb25uZWN0KHRoaXMsIDIpOwoJCQl9CgkJfQoKCQkvKioKCQkgKiBSZW1vdmVzIHRoZSBiaW5kIGZyb20gdGhlIGFycm93LiBJdCBmb2xsb3dzLCB0aGF0IHRoZSBhcnJvdyB3aWxsIG5vdCBtb3ZlLCB3aGVuIHRoZSBlbGVtZW50IGl0IGlzIHBvaW50ZWQgdG8gb3IgcG9pbnRlZCBmcm9tIGlzIG1vdmVkCgkJICovCgkJdW5iaW5kKCkgewoJCQlpZih0aGlzLmZyb20gaW5zdGFuY2VvZiBPd2xEcmF3LmVsZW1lbnQpIHsKCQkJCXRoaXMuZnJvbS51bmNvbm5lY3QodGhpcywgMSk7CgkJCX0KCQkJaWYodGhpcy50byBpbnN0YW5jZW9mIE93bERyYXcuZWxlbWVudCkgewoJCQkJdGhpcy50by51bmNvbm5lY3QodGhpcywgMik7CgkJCX0KCQl9Cgl9CgoJLyoqCgkgKiBDbGFzcyByZXByZXNlbnRpbmcgYW4gYXJyb3cKCSAqIEBtZW1iZXJvZiBPd2xEcmF3CgkgKiBAZXh0ZW5kcyBPd2xEcmF3LmxpbmUKCSAqCgkgKiBAcHJvcGVydHkge0VsZW1lbnRbXX0gY29udGFpbmVyIC0gQXJyYXkgb2YgRE9NIGVsZW1lbnRzIChTVkdFbGVtZW50KSB0aGF0IGFyZSBhZGRlZCB0byB0aGUgc3ZnIERPTQoJICogQHByb3BlcnR5IHtudW1iZXJ9IFt4MV0gLSBUaGUgeC1jb29yZGluYXRlIG9mIGJlZ2lubmluZyBvZiBhcnJvdwoJICogQHByb3BlcnR5IHtudW1iZXJ9IFt5MV0gLSBUaGUgeS1jb29yZGluYXRlIG9mIGJlZ2lubmluZyBvZiBhcnJvdwoJICogQHByb3BlcnR5IHtudW1iZXJ9IFt4Ml0gLSBUaGUgeC1jb29yZGluYXRlIG9mIGVuZCBvZiBhcnJvdwoJICogQHByb3BlcnR5IHtudW1iZXJ9IFt5Ml0gLSBUaGUgeS1jb29yZGluYXRlIG9mIGVuZCBvZiBhcnJvdwoJICogQHByb3BlcnR5IHtPd2xEcmF3LmNvbm5lY3RhYmxlfSBbZnJvbV0gLSBUaGUgZWxlbWVudCwgdGhlIGFycm93IHdpbGwgYmUgZHJhd24gZnJvbS4KCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbZnJvbXBdIC0gVGhlIHBvc2l0aW9uLCB0aGUgYXJyb3cgd2lsbCBiZSBkcmF3biBmcm9tICgnbCcgLSBsZWZ0IHNpZGUsICdyJyAtIHJpZ2h0IHNpZGUsICd1JyAtIHVwIHNpZGUsICdkJyAtIGRvd24gc2lkZSkKCSAqIEBwcm9wZXJ0eSB7T3dsRHJhdy5jb25uZWN0YWJsZXxudWxsfSBbdG9dIC0gVGhlIGVsZW1lbnQsIHRoZSBhcnJvdyB3aWxsIGJlIGRyYXduIHRvLgoJICogQHByb3BlcnR5IHtzdHJpbmd9IFt0b3BdIC0gVGhlIHBvc2l0aW9uLCB0aGUgYXJyb3cgd2lsbCBiZSBkcmF3biB0byAoJ2wnIC0gbGVmdCBzaWRlLCAncicgLSByaWdodCBzaWRlLCAndScgLSB1cCBzaWRlLCAnZCcgLSBkb3duIHNpZGUpCgkgKi8KCU93bERyYXcuYXJyb3cgPSBjbGFzcyBleHRlbmRzIE93bERyYXcubGluZSB7CgkJLyoqCgkJICogQ3JlYXRpbmcgYW4gYXJyb3cKCQkgKiBAcGFyYW0ge09iamVjdH0gbW9kZSAtIERhdGEgZGVzY3JpYmluZyB0aGUgYXJyb3cKCQkgKiBAcGFyYW0ge251bWJlcn0gW21vZGUueDFdIC0gVGhlIHgtY29vcmRpbmF0ZSBvZiBiZWdpbm5pbmcgb2YgYXJyb3cKCQkgKiBAcGFyYW0ge251bWJlcn0gW21vZGUueTFdIC0gVGhlIHktY29vcmRpbmF0ZSBvZiBiZWdpbm5pbmcgb2YgYXJyb3cKCQkgKiBAcGFyYW0ge251bWJlcn0gW21vZGUueDJdIC0gVGhlIHgtY29vcmRpbmF0ZSBvZiBlbmQgb2YgYXJyb3cKCQkgKiBAcGFyYW0ge251bWJlcn0gW21vZGUueTJdIC0gVGhlIHktY29vcmRpbmF0ZSBvZiBlbmQgb2YgYXJyb3cKCQkgKiBAcGFyYW0ge093bERyYXcuY29ubmVjdGFibGV9IFttb2RlLmZyb21dIC0gVGhlIGVsZW1lbnQsIHRoZSBhcnJvdyB3aWxsIGJlIGRyYXduIGZyb20KCQkgKiBAcGFyYW0ge3N0cmluZ30gW21vZGUuZnJvbXBdIC0gVGhlIHBvc2l0aW9uLCB0aGUgYXJyb3cgd2lsbCBiZSBkcmF3biBmcm9tICgnbCcgLSBsZWZ0IHNpZGUsICdyJyAtIHJpZ2h0IHNpZGUsICd1JyAtIHVwIHNpZGUsICdkJyAtIGRvd24gc2lkZSkKCQkgKiBAcGFyYW0ge093bERyYXcuY29ubmVjdGFibGV8bnVsbH0gW21vZGUudG9dIC0gVGhlIGVsZW1lbnQsIHRoZSBhcnJvdyB3aWxsIGJlIGRyYXduIHRvLiBJZiBudWxsLCB0aGFuIHRoZSBhcnJvdyBpcyBpbnZpc2libGUuCgkJICogQHBhcmFtIHtzdHJpbmd9IFttb2RlLnRvcF0gLSBUaGUgcG9zaXRpb24sIHRoZSBhcnJvdyB3aWxsIGJlIGRyYXduIHRvICgnbCcgLSBsZWZ0IHNpZGUsICdyJyAtIHJpZ2h0IHNpZGUsICd1JyAtIHVwIHNpZGUsICdkJyAtIGRvd24gc2lkZSkKCQkgKiBAcGFyYW0ge3N0cmluZ30gW21vZGUuY2xhc3NdIC0gbGlzdCBvZiBjbGFzcyB0aGF0IHdpbGwgYmUgYWRkZWQgdG8gdGhlIERPTSBlbGVtZW50CgkJICogQHBhcmFtIHtzdHJpbmd9IFttb2RlLnN0cm9rZV0gLSBjb2xvciBvZiBzdHJva2UsIHRoYXQgYXBwbGllcyB0byB0aGUgYXJyb3cKCQkgKiBAcGFyYW0ge251bWJlcn0gW21vZGUuc3Ryb2tlV2lkdGhdIC0gd2lkdGggb2Ygc3Ryb2tlLCB0aGF0IGFwcGxpZXMgdG8gdGhlIGFycm93CgkJICovCgkJY29uc3RydWN0b3IobW9kZSkgewoJCQlzdXBlcihtb2RlKTsKCgkJCXRoaXMuY29udGFpbmVyWzBdLnNldEF0dHJpYnV0ZU5TKG51bGwsICdtYXJrZXItZW5kJywgJ3VybCgjYXJyb3cpJyk7CgkJCXRoaXMuY29udGFpbmVyWzBdLmNsYXNzTGlzdC5yZW1vdmUoJ2xpbmUnKTsKCQkJdGhpcy5jb250YWluZXJbMF0uY2xhc3NMaXN0LmFkZCgnYXJyb3cnKTsKCQl9Cgl9CgoJLyoqCgkgKiBDbGFzcyByZXByZXNlbnRpbmcgYSBiZXppZXIgYXJyb3cKCSAqIEBtZW1iZXJvZiBPd2xEcmF3CgkgKiBAZXh0ZW5kcyBPd2xEcmF3LmFycm93CgkgKgoJICogQHByb3BlcnR5IHtFbGVtZW50W119IGNvbnRhaW5lciAtIEFycmF5IG9mIERPTSBlbGVtZW50cyAoU1ZHRWxlbWVudCkgdGhhdCBhcmUgYWRkZWQgdG8gdGhlIHN2ZyBET00KCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB4MSAtIFRoZSB4LWNvb3JkaW5hdGUgb2YgYmVnaW5uaW5nIG9mIGxpbmUKCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB5MSAtIFRoZSB5LWNvb3JkaW5hdGUgb2YgYmVnaW5uaW5nIG9mIGxpbmUKCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB4MiAtIFRoZSB4LWNvb3JkaW5hdGUgb2YgZW5kIG9mIGxpbmUKCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB5MiAtIFRoZSB5LWNvb3JkaW5hdGUgb2YgZW5kIG9mIGxpbmUKCSAqIEBwcm9wZXJ0eSB7T3dsRHJhdy5jb25uZWN0YWJsZX0gW2Zyb21dIC0gVGhlIGVsZW1lbnQsIHRoZSBhcnJvdyB3aWxsIGJlIGRyYXduIGZyb20uCgkgKiBAcHJvcGVydHkge3N0cmluZ30gW2Zyb21wXSAtIFRoZSBwb3NpdGlvbiwgdGhlIGFycm93IHdpbGwgYmUgZHJhd24gZnJvbSAoJ2wnIC0gbGVmdCBzaWRlLCAncicgLSByaWdodCBzaWRlLCAndScgLSB1cCBzaWRlLCAnZCcgLSBkb3duIHNpZGUpCgkgKiBAcHJvcGVydHkge093bERyYXcuY29ubmVjdGFibGV8bnVsbH0gW3RvXSAtIFRoZSBlbGVtZW50LCB0aGUgYXJyb3cgd2lsbCBiZSBkcmF3biB0by4KCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbdG9wXSAtIFRoZSBwb3NpdGlvbiwgdGhlIGFycm93IHdpbGwgYmUgZHJhd24gdG8gKCdsJyAtIGxlZnQgc2lkZSwgJ3InIC0gcmlnaHQgc2lkZSwgJ3UnIC0gdXAgc2lkZSwgJ2QnIC0gZG93biBzaWRlKQoJICovCglPd2xEcmF3Lm5pY2VBcnJvdyA9IGNsYXNzIGV4dGVuZHMgT3dsRHJhdy5hcnJvdyB7CgkJLyoqCgkJICogQ3JlYXRpbmcgYSBiZXppZXIgYXJyb3cKCQkgKiBAcGFyYW0ge09iamVjdH0gbW9kZSAtIERhdGEgZGVzY3JpYmluZyB0aGUgbGluZQoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbW9kZS54MV0gLSBUaGUgeC1jb29yZGluYXRlIG9mIGJlZ2lubmluZyBvZiBhcnJvdwoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbW9kZS55MV0gLSBUaGUgeS1jb29yZGluYXRlIG9mIGJlZ2lubmluZyBvZiBhcnJvdwoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbW9kZS54Ml0gLSBUaGUgeC1jb29yZGluYXRlIG9mIGVuZCBvZiBhcnJvdwoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbW9kZS55Ml0gLSBUaGUgeS1jb29yZGluYXRlIG9mIGVuZCBvZiBhcnJvdwoJCSAqIEBwYXJhbSB7T3dsRHJhdy5lbGVtZW50fSBbbW9kZS5mcm9tXSAtIFRoZSBlbGVtZW50LCB0aGUgYXJyb3cgd2lsbCBiZSBkcmF3biBmcm9tCgkJICogQHBhcmFtIHtzdHJpbmd9IFttb2RlLmZyb21wXSAtIFRoZSBwb3NpdGlvbiwgdGhlIGFycm93IHdpbGwgYmUgZHJhd24gZnJvbSAoJ2wnIC0gbGVmdCBzaWRlLCAncicgLSByaWdodCBzaWRlLCAndScgLSB1cCBzaWRlLCAnZCcgLSBkb3duIHNpZGUpCgkJICogQHBhcmFtIHtPd2xEcmF3LmVsZW1lbnR8bnVsbH0gW21vZGUudG9dIC0gVGhlIGVsZW1lbnQsIHRoZSBhcnJvdyB3aWxsIGJlIGRyYXduIHRvLiBJZiBudWxsLCB0aGFuIHRoZSBhcnJvdyBpcyBpbnZpc2libGUuCgkJICogQHBhcmFtIHtzdHJpbmd9IFttb2RlLnRvcF0gLSBUaGUgcG9zaXRpb24sIHRoZSBhcnJvdyB3aWxsIGJlIGRyYXduIHRvICgnbCcgLSBsZWZ0IHNpZGUsICdyJyAtIHJpZ2h0IHNpZGUsICd1JyAtIHVwIHNpZGUsICdkJyAtIGRvd24gc2lkZSkKCQkgKiBAcGFyYW0ge3N0cmluZ30gW21vZGUuY2xhc3NdIC0gbGlzdCBvZiBjbGFzcyB0aGF0IHdpbGwgYmUgYWRkZWQgdG8gdGhlIERPTSBlbGVtZW50CgkJICogQHBhcmFtIHtzdHJpbmd9IFttb2RlLnN0cm9rZV0gLSBjb2xvciBvZiBzdHJva2UsIHRoYXQgYXBwbGllcyB0byB0aGUgYXJyb3cKCQkgKiBAcGFyYW0ge251bWJlcn0gW21vZGUuc3Ryb2tlV2lkdGhdIC0gd2lkdGggb2Ygc3Ryb2tlLCB0aGF0IGFwcGxpZXMgdG8gdGhlIGFycm93CgkJICovCgkJY29uc3RydWN0b3IobW9kZSkgewoJCQlzdXBlcihtb2RlKTsKCgkJCWxldCBnID0gdGhpcy5jb250YWluZXJbMF07CgkJCWcuaW5uZXJIVE1MID0gJyc7CgoJCQlnLmNsYXNzTGlzdC5yZW1vdmUoJ2Fycm93Jyk7CgkJCWcuY2xhc3NMaXN0LmFkZCgnbmljZUFycm93Jyk7CgkJCWlmKG1vZGUudG8gPT0gbnVsbCkgZy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoKCQkJbGV0IHBhdGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoWE1MTlMsICdwYXRoJyk7CgoJCQlsZXQgZHggPSBNYXRoLmFicyh0aGlzLngyIC0gdGhpcy54MSk7CgkJCWxldCBkeSA9IE1hdGguYWJzKHRoaXMueTIgLSB0aGlzLnkxKTsKCQkJbGV0IGQgPSAnTScgKyB0aGlzLngxICsgJyAnICsgdGhpcy55MSArICcgQyAnOwoJCQl0aGlzLmZyb21wID0gbW9kZS5mcm9tcDsgdGhpcy50b3AgPSBtb2RlLnRvcDsKCgkJCWlmKG1vZGUuZnJvbXAgPT0gJ2wnKSBkICs9ICh0aGlzLngxIC0gZHgvMS41KSArICcgJyArIHRoaXMueTEgKyAnLCAnOwoJCQllbHNlIGlmKG1vZGUuZnJvbXAgPT0gJ3InKSBkICs9ICh0aGlzLngxICsgZHgvMS41KSArICcgJyArIHRoaXMueTEgKyAnLCAnOwoJCQllbHNlIGlmKG1vZGUuZnJvbXAgPT0gJ3UnKSBkICs9IHRoaXMueDEgKyAnICcgKyAodGhpcy55MSAtIGR5LzEuNSkgKyAnLCAnOwoJCQllbHNlIGQgKz0gdGhpcy54MSArICcgJyArICh0aGlzLnkxICsgZHkvMS41KSArICcsICc7CgoJCQlpZihtb2RlLnRvcCA9PSAnbCcpIGQgKz0gKHRoaXMueDIgLSBkeC8xLjUpICsgJyAnICsgdGhpcy55MiArICcsICc7CgkJCWVsc2UgaWYobW9kZS50b3AgPT0gJ3InKSBkICs9ICh0aGlzLngyICsgZHgvMS41KSArICcgJyArIHRoaXMueTIgKyAnLCAnOwoJCQllbHNlIGlmKG1vZGUudG9wID09ICd1JykgZCArPSB0aGlzLngyICsgJyAnICsgKHRoaXMueTIgLSBkeS8xLjUpICsgJywgJzsKCQkJZWxzZSBkICs9IHRoaXMueDIgKyAnICcgKyAodGhpcy55MiArIGR5LzEuNSkgKyAnLCAnOwoKCQkJZCArPSB0aGlzLngyICsgJyAnICsgdGhpcy55MjsKCQkJcGF0aC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAnZCcsIGQpOwoKCQkJcGF0aC5zdHlsZS5zdHJva2UgPSBtb2RlLnN0cm9rZSB8fCAnJzsKCQkJcGF0aC5zdHlsZS5zdHJva2VXaWR0aCA9IG1vZGUuc3Ryb2tlV2lkdGggfHwgJyc7CgkJCXBhdGguc3R5bGUuZmlsbCA9ICd0cmFuc3BhcmVudCc7CgoJCQlnLmFwcGVuZENoaWxkKHBhdGgpOwoJCX0KCgkJLyoqCgkJICogTW92ZXMgdGhlIGFycm93LiBFYWNoIG9mIHRoZSBlbmQgcG9pbnRzIGNhbiBiZSBtb3ZlZCBzZXBhcmF0ZWx5IGFuZCBzaW11bHRhbmVvdXNseSwgb3IgdGhlIHdob2xlIGxpbmUgY2FuIGJlIG1vdmVkLiBFaXRoZXIgeDEgYW5kIHkxLCBkeDEgYW5kIGR5MSwgeDIgYW5kIHkyLCBkeDIgYW5kIGR5MiBvciBkeCBhbmQgZHkgbXVzdCBiZSBkZWZpbmVkLgoJCSAqIEBwYXJhbSB7RHJhd0xpbmVNb3ZlT3B0fSBvcHQgLSBEYXRhIGRlc2NyaWJpbmcgdGhlIHRyYW5zaXRpb24KCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdC54MV0gLSBOZXcgeC1jb29yZGluYXRlIG9mIHRoZSBwb2ludCBvZiBiZWdpbm5pbmcKCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdC55MV0gLSBOZXcgeS1jb29yZGluYXRlIG9mIHRoZSBwb2ludCBvZiBiZWdpbm5pbmcKCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdC5keDFdIC0gVGhlIHZhbHVlIHdpbGwgYmUgYWRkZWQgdG8gdGhlIHgtY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnQgb2YgYmVnaW5uaW5nCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHQuZHkxXSAtIFRoZSB2YWx1ZSB3aWxsIGJlIGFkZGVkIHRvIHRoZSB5LWNvb3JkaW5hdGUgb2YgdGhlIHBvaW50IG9mIGJlZ2lubmluZwoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0LngyXSAtIE5ldyB4LWNvb3JkaW5hdGUgb2YgdGhlIHBvaW50IG9mIGVuZGluZwoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0LnkyXSAtIE5ldyB5LWNvb3JkaW5hdGUgb2YgdGhlIHBvaW50IG9mIGVuZGluZwoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0LmR4Ml0gLSBUaGUgdmFsdWUgd2lsbCBiZSBhZGRlZCB0byB0aGUgeC1jb29yZGluYXRlIG9mIHRoZSBwb2ludCBvZiBlbmRpbmcKCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdC5keTJdIC0gVGhlIHZhbHVlIHdpbGwgYmUgYWRkZWQgdG8gdGhlIHktY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnQgb2YgZW5kaW5nCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHQuZHhdIC0gVGhlIHZhbHVlIHdpbGwgYmUgYWRkZWQgdG8gdGhlIHgtY29vcmRpbmF0ZSBvZiBib3RoIHRoZSBwb2ludCBvZiBlbmRpbmcgYW5kIGJlZ2lubmluZwoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0LmR5XSAtIFRoZSB2YWx1ZSB3aWxsIGJlIGFkZGVkIHRvIHRoZSB5LWNvb3JkaW5hdGUgb2YgYm90aCB0aGUgcG9pbnQgb2YgZW5kaW5nIGFuZCBiZWdpbm5pbmcKCQkgKi8KCQltb3ZlKG9wdCkgewoJCQlsZXQgb3gxID0gdGhpcy54MSwgb3kxID0gdGhpcy55MSwgb3gyID0gdGhpcy54Miwgb3kyID0gdGhpcy55MjsKCgkJCWlmKG9wdC54MSAhPSB1bmRlZmluZWQpIHsKCQkJCXRoaXMueDEgPSBvcHQueDE7CgkJCQl0aGlzLnkxID0gb3B0LnkxOwoJCQl9CgkJCWVsc2UgaWYob3B0LmR4MSAhPSB1bmRlZmluZWQpIHsKCQkJCXRoaXMueDEgKz0gb3B0LmR4MTsKCQkJCXRoaXMueTEgKz0gb3B0LmR5MTsKCQkJfQoJCQllbHNlIGlmKG9wdC5keCAhPSB1bmRlZmluZWQpIHsKCQkJCXRoaXMueDEgKz0gb3B0LmR4OwoJCQkJdGhpcy55MSArPSBvcHQuZHk7CgkJCX0KCgkJCWlmKG9wdC54MiAhPSB1bmRlZmluZWQpIHsKCQkJCXRoaXMueDIgPSBvcHQueDI7CgkJCQl0aGlzLnkyID0gb3B0LnkyOwoJCQl9CgkJCWVsc2UgaWYob3B0LmR4MiAhPSB1bmRlZmluZWQpIHsKCQkJCXRoaXMueDIgKz0gb3B0LmR4MjsKCQkJCXRoaXMueTIgKz0gb3B0LmR5MjsKCQkJfQoJCQllbHNlIGlmKG9wdC5keCAhPSB1bmRlZmluZWQpIHsKCQkJCXRoaXMueDIgKz0gb3B0LmR4OwoJCQkJdGhpcy55MiArPSBvcHQuZHk7CgkJCX0KCgkJCWlmKG9wdC5mcm9tcCkgdGhpcy5mcm9tcCA9IG9wdC5mcm9tcDsKCQkJaWYob3B0LnRvcCkgdGhpcy50b3AgPSBvcHQudG9wOwoKCQkJbGV0IGR4ID0gTWF0aC5hYnModGhpcy54MiAtIHRoaXMueDEpOwoJCQlsZXQgZHkgPSBNYXRoLmFicyh0aGlzLnkyIC0gdGhpcy55MSk7CgkJCWxldCBkID0gJ00nICsgdGhpcy54MSArICcgJyArIHRoaXMueTEgKyAnIEMgJzsKCgkJCWlmKHRoaXMuZnJvbXAgPT0gJ2wnKSBkICs9ICh0aGlzLngxIC0gZHgvMS41KSArICcgJyArIHRoaXMueTEgKyAnLCAnOwoJCQllbHNlIGlmKHRoaXMuZnJvbXAgPT0gJ3InKSBkICs9ICh0aGlzLngxICsgZHgvMS41KSArICcgJyArIHRoaXMueTEgKyAnLCAnOwoJCQllbHNlIGlmKHRoaXMuZnJvbXAgPT0gJ3UnKSBkICs9IHRoaXMueDEgKyAnICcgKyAodGhpcy55MSAtIGR5LzEuNSkgKyAnLCAnOwoJCQllbHNlIGQgKz0gdGhpcy54MSArICcgJyArICh0aGlzLnkxICsgZHkvMS41KSArICcsICc7CgoJCQlpZih0aGlzLnRvcCA9PSAnbCcpIGQgKz0gKHRoaXMueDIgLSBkeC8xLjUpICsgJyAnICsgdGhpcy55MiArICcsICc7CgkJCWVsc2UgaWYodGhpcy50b3AgPT0gJ3InKSBkICs9ICh0aGlzLngyICsgZHgvMS41KSArICcgJyArIHRoaXMueTIgKyAnLCAnOwoJCQllbHNlIGlmKHRoaXMudG9wID09ICd1JykgZCArPSB0aGlzLngyICsgJyAnICsgKHRoaXMueTIgLSBkeS8xLjUpICsgJywgJzsKCQkJZWxzZSBkICs9IHRoaXMueDIgKyAnICcgKyAodGhpcy55MiArIGR5LzEuNSkgKyAnLCAnOwoKCQkJZCArPSB0aGlzLngyICsgJyAnICsgdGhpcy55MjsKCgkJCWxldCBhbmltYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFhNTE5TLCAnYW5pbWF0ZScpOwoJCQlhbmltYXRlLnNldEF0dHJpYnV0ZU5TKG51bGwsICdhdHRyaWJ1dGVOYW1lJywgJ2QnKTsKCQkJYW5pbWF0ZS5zZXRBdHRyaWJ1dGVOUyhudWxsLCAnZnJvbScsIHRoaXMuY29udGFpbmVyWzBdLmNoaWxkcmVuWzBdLmdldEF0dHJpYnV0ZSgnZCcpKTsKCQkJYW5pbWF0ZS5zZXRBdHRyaWJ1dGVOUyhudWxsLCAndG8nLCBkKTsKCQkJYW5pbWF0ZS5zZXRBdHRyaWJ1dGVOUyhudWxsLCAnZHVyJywgRFVSQVRJT04gKyAncycpOwoJCQlhbmltYXRlLnNldEF0dHJpYnV0ZU5TKG51bGwsICdiZWdpbicsICdpbmRlZmluaXRlJyk7CgkJCWFuaW1hdGUuc2V0QXR0cmlidXRlTlMobnVsbCwgJ2ZpbGwnLCAnZnJlZXplJyk7CgoJCQl0aGlzLmNvbnRhaW5lclswXS5jaGlsZHJlblswXS5hcHBlbmRDaGlsZChhbmltYXRlKTsKCQkJYW5pbWF0ZS5iZWdpbkVsZW1lbnQoKTsKCQkJc2V0VGltZW91dCgoKSA9PiB7CgkJCQl0aGlzLmNvbnRhaW5lclswXS5jaGlsZHJlblswXS5yZW1vdmVDaGlsZChhbmltYXRlKTsKCQkJCXRoaXMuY29udGFpbmVyWzBdLmNoaWxkcmVuWzBdLnNldEF0dHJpYnV0ZU5TKG51bGwsICdkJywgZCk7CgkJCX0sIDEwMDAgKiBEVVJBVElPTik7CgkJfQoJfQoKCS8qKgoJICogQ2xhc3MgcmVwcmVzZW50aW5nIGEgdGV4dAoJICogQG1lbWJlcm9mIE93bERyYXcKCSAqIEBleHRlbmRzIE93bERyYXcuZWxlbWVudAoJICoKCSAqIEBwcm9wZXJ0eSB7RWxlbWVudFtdfSBjb250YWluZXIgLSBBcnJheSBvZiBET00gZWxlbWVudHMgKFNWR0VsZW1lbnQpIHRoYXQgYXJlIGFkZGVkIHRvIHRoZSBzdmcgRE9NCgkgKiBAcHJvcGVydHkge251bWJlcn0geCAtIFRoZSB4LWNvb3JkaW5hdGUgb2YgdGV4dAoJICogQHByb3BlcnR5IHtudW1iZXJ9IHkgLSBUaGUgeS1jb29yZGluYXRlIG9mIHRleHQKCSAqLwoJT3dsRHJhdy50ZXh0ID0gY2xhc3MgZXh0ZW5kcyBPd2xEcmF3LmVsZW1lbnQgewoJCS8qKgoJCSAqIENyZWF0ZXMgYSB0ZXh0CgkJICogQHBhcmFtIHsoc3RyaW5nfEVsZW1lbnR8T2JqZWN0KX0gbW9kZSAtIERhdGEgZGVzY3JpYmluZyB0aGUgdGV4dCAoc2VlIHtAbGluayBPd2xEcmF3LmVsZW1lbnR9KQoJCSAqIEBwYXJhbSB7bnVtYmVyfSBtb2RlLnggLSB4LWNvb3JkaW5hdGUgb2YgdGhlIHRleHQKCQkgKiBAcGFyYW0ge251bWJlcn0gbW9kZS55IC0geS1jb29yZGluYXRlIG9mIHRoZSB0ZXh0CgkJICogQHBhcmFtIHtzdHJpbmd9IFttb2RlLmNsYXNzXSAtIExpc3Qgb2YgY2xhc3MgdGhhdCB3aWxsIGJlIGFkZGVkIHRvIHRoZSBET00gZWxlbWVudAoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbbW9kZS50eHRdIC0gVGV4dCB0byBiZSBkaXNwbGF5ZWQuIExpbmUgYnJlYWtzIChcbikgYXJlIHdvcmtpbmcuCgkJICovCgkJY29uc3RydWN0b3IobW9kZSkgewoJCQlzdXBlcihtb2RlKTsKCgkJCWlmKHR5cGVvZiBtb2RlID09ICdvYmplY3QnKSB7CgkJCQlsZXQgZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhYTUxOUywgJ2cnKTsKCgkJCQl0aGlzLnggPSBtb2RlLng7IHRoaXMueSA9IG1vZGUueTsKCQkJCWcuc2V0QXR0cmlidXRlTlMobnVsbCwgJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIG1vZGUueCArICcsICcgKyBtb2RlLnkgKyAnKScpOwoJCQkJaWYobW9kZS5jbGFzcykgZy5zZXRBdHRyaWJ1dGVOUyhudWxsLCAnY2xhc3MnLCBtb2RlLmNsYXNzKTsKCQkJCWcuY2xhc3NMaXN0LmFkZCgndGV4dCcpOwoKCQkJCWxldCB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFhNTE5TLCAndGV4dCcpOwoKCQkJCWxldCB0eHQgPSBtb2RlLnR4dC5zcGxpdCgnXG4nKTsKCQkJCWZvcihsZXQgaSA9IDA7IGkgPCB0eHQubGVuZ3RoOyBpKyspIHsKCQkJCQlsZXQgdHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoWE1MTlMsICd0c3BhbicpOwoJCQkJCXRzcGFuLnNldEF0dHJpYnV0ZU5TKG51bGwsICd4JywgJzAnKTsKCQkJCQl0c3Bhbi5zZXRBdHRyaWJ1dGVOUyhudWxsLCAnZHknLCAnMS4xZW0nKTsKCQkJCQl0c3Bhbi5pbm5lckhUTUwgPSB0eHRbaV07CgkJCQkJdGV4dC5hcHBlbmRDaGlsZCh0c3Bhbik7CgkJCQl9CgoJCQkJZy5hcHBlbmRDaGlsZCh0ZXh0KTsKCgkJCQl0aGlzLmNvbnRhaW5lci5wdXNoKGcpOwoJCQl9CgkJfQoKCQkvKioKCQkgKiBBbHRlcnMgdGhlIHRleHQuCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ30gdHh0IC0gVGV4dCB0byBiZSBkaXNwbGF5ZWQuIExpbmUgYnJlYWtzIChcbikgYXJlIHdvcmtpbmcuCgkJICovCgkJdGV4dCh0eHQpIHsKCQkJdHh0ID0gdHh0LnNwbGl0KCdcbicpOwoJCQl0aGlzLmNvbnRhaW5lclswXS5jaGlsZHJlblswXS5pbm5lckhUTUwgPSAnJzsKCQkJZm9yKGxldCBpID0gMDsgaSA8IHR4dC5sZW5ndGg7IGkrKykgewoJCQkJbGV0IHRzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFhNTE5TLCAndHNwYW4nKTsKCQkJCXRzcGFuLnNldEF0dHJpYnV0ZU5TKG51bGwsICd4JywgJzAnKTsKCQkJCXRzcGFuLnNldEF0dHJpYnV0ZU5TKG51bGwsICdkeScsICcxLjFlbScpOwoJCQkJdHNwYW4uaW5uZXJIVE1MID0gdHh0W2ldOwoJCQkJdGhpcy5jb250YWluZXJbMF0uY2hpbGRyZW5bMF0uYXBwZW5kQ2hpbGQodHNwYW4pOwoJCQl9CgkJfQoJfQoKCS8qKgoJICogQ2xhc3MgdGhhdCByZXByZXNlbnRzIGEgcG9pbnRlcgoJICogQG1lbWJlcm9mIE93bERyYXcKCSAqIEBleHRlbmRzIE93bERyYXcuZWxlbWVudAoJICoKCSAqIEBwcm9wZXJ0eSB7RWxlbWVudFtdfSBjb250YWluZXIgLSBBcnJheSBvZiBET00gZWxlbWVudHMgKFNWR0VsZW1lbnQpIHRoYXQgYXJlIGFkZGVkIHRvIHRoZSBzdmcgRE9NCgkgKiBAcHJvcGVydHkge251bWJlcn0geCAtIFRoZSB0b3AtbGVmdCB4LWNvb3JkaW5hdGUgb2YgdGhlIHBvaW50ZXIKCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB5IC0gVGhlIHRvcC1sZWZ0IHktY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnRlcgoJICogQHByb3BlcnR5IHtudW1iZXJ9IHgyIC0gVGhlIGJvdHRvbS1yaWdodCB4LWNvb3JkaW5hdGUgb2YgdGhlIHBvaW50ZXIKCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB5MiAtIFRoZSBib3R0b20tcmlnaHQgeS1jb29yZGluYXRlIG9mIHRoZSBwb2ludGVyCgkgKiBAcHJvcGVydHkge251bWJlcn0gd2lkdGggLSBUaGUgd2lkdGggb2YgdGhlIHBvaW50ZXIKCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0IG9mIHRoZSBwb2ludGVyCgkgKiBAcHJvcGVydHkge093bERyYXcucmVjdH0gcmVjdCAtIFRoZSByZWN0YW5nbGUsIHRoYXQgaXMgdGhlIGJhc2Ugb2YgdGhlIHBvaW50ZXIKCSAqIEBwcm9wZXJ0eSB7T3dsRHJhdy5saW5lfSBsaW5lMSAtIE9uZSBvZiB0aGUgbGluZXMsIHRoYXQgY3Jvc3NlcyB0aGUgcmVjdGFuZ2xlIGluIGNhc2Ugb2YgbnVsbCBwb2ludGVyCgkgKiBAcHJvcGVydHkge093bERyYXcubGluZX0gbGluZTIgLSBPbmUgb2YgdGhlIGxpbmVzLCB0aGF0IGNyb3NzZXMgdGhlIHJlY3RhbmdsZSBpbiBjYXNlIG9mIG51bGwgcG9pbnRlcgoJICogQHByb3BlcnR5IHtPd2xEcmF3LmFycm93fE93bERyYXcubmljZUFycm93fSBhcnJvdyAtIFRoZSBhcnJvdywgdGhhdCBwb2ludHMKCSAqLwoJT3dsRHJhdy5wb2ludGVyID0gY2xhc3MgZXh0ZW5kcyBPd2xEcmF3LmNvbm5lY3RhYmxlIHsKCQkvKioKCQkgKiBDcmVhdGVzIGEgcG9pbnRlcgoJCSAqCgkJICogQHBhcmFtIHtPYmplY3R9IG1vZGUgLSBPcHRpb25zCgkJICogQHBhcmFtIHtudW1iZXJ9IG1vZGUueCAtIFRoZSB0b3AtbGVmdCB4LWNvb3JkaW5hdGUgb2YgdGhlIHBvaW50ZXIKCQkgKiBAcGFyYW0ge251bWJlcn0gbW9kZS55IC0gVGhlIHRvcC1sZWZ0IHktY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnRlcgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbW9kZS54Ml0gLSBUaGUgYm90dG9tLXJpZ2h0IHgtY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnRlcgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbW9kZS55Ml0gLSBUaGUgYm90dG9tLXJpZ2h0IHktY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnRlcgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbW9kZS53aWR0aF0gLSBUaGUgd2lkdGggb2YgdGhlIHBvaW50ZXIKCQkgKiBAcGFyYW0ge251bWJlcn0gW21vZGUuaGVpZ2h0XSAtIFRoZSBoZWlnaHQgb2YgdGhlIHBvaW50ZXIKCQkgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMuY2xhc3NdIC0gbGlzdCBvZiBjbGFzcyB0aGF0IHdpbGwgYmUgYWRkZWQgdG8gdGhlIERPTSBlbGVtZW50CgkJICogQHBhcmFtIHtzdHJpbmd9IFttb2RlLmFycm93XSAtIFR5cGUgb2YgYXJyb3cuIElmICduaWNlJyBuaWNlQXJyb3cgKHNlZSB7QGxpbmsgT3dsRHJhdy5uaWNlQXJyb3d9KSwgZWxzZSBzaW1wbGUgYXJyb3cgKHNlZSB7QGxpbmsgT3dsRHJhdy5hcnJvd30pCgkJICogQHBhcmFtIHtzdHJpbmd9IG1vZGUuZnJvbXAgLSBUaGUgcG9zaXRpb24sIHRoZSBhcnJvdyB3aWxsIGJlIGRyYXduIGZyb20gKCdsJyAtIGxlZnQgc2lkZSwgJ3InIC0gcmlnaHQgc2lkZSwgJ3UnIC0gdXAgc2lkZSwgJ2QnIC0gZG93biBzaWRlKQoJCSAqIEBwYXJhbSB7T3dsRHJhdy5jb25uZWN0YWJsZXxudWxsfSBtb2RlLnRvIC0gVGhlIGVsZW1lbnQsIHRoZSBhcnJvdyB3aWxsIGJlIGRyYXduIHRvLgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBtb2RlLnRvcCAtIFRoZSBwb3NpdGlvbiwgdGhlIGFycm93IHdpbGwgYmUgZHJhd24gdG8gKCdsJyAtIGxlZnQgc2lkZSwgJ3InIC0gcmlnaHQgc2lkZSwgJ3UnIC0gdXAgc2lkZSwgJ2QnIC0gZG93biBzaWRlKQoJCSAqLwoJCWNvbnN0cnVjdG9yKG1vZGUpIHsKCQkJc3VwZXIobW9kZSk7CgoJCQlpZih0eXBlb2YgbW9kZSA9PSAnb2JqZWN0JykgewoJCQkJdGhpcy54ID0gbW9kZS54OyB0aGlzLnkgPSBtb2RlLnk7CgkJCQl0aGlzLndpZHRoID0gbW9kZS53aWR0aCB8fCAobW9kZS54MiAtIHRoaXMueCk7IHRoaXMuaGVpZ2h0ID0gbW9kZS5oZWlnaHQgfHwgKG1vZGUueTIgLSB0aGlzLnkpOwoJCQkJdGhpcy54MiA9IHRoaXMueCArIHRoaXMud2lkdGg7IHRoaXMueTIgPSB0aGlzLnkgKyB0aGlzLmhlaWdodDsKCgkJCQl0aGlzLnJlY3QgPSBuZXcgT3dsRHJhdy5yZWN0KHt4OiB0aGlzLngsIHk6IHRoaXMueSwgd2lkdGg6IHRoaXMud2lkdGgsIGhlaWdodDogdGhpcy5oZWlnaHQsIGNsYXNzOiAobW9kZS5jbGFzcyB8fCAnJykgKyAnIHBvaW50ZXInfSk7CgkJCQl0aGlzLnJlY3QuY29udGFpbmVyWzBdLmNsYXNzTGlzdC5yZW1vdmUoJ3JlY3QnKTsKCQkJCWZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLnJlY3QuY29udGFpbmVyLmxlbmd0aDsgaSsrKSB7CgkJCQkJdGhpcy5jb250YWluZXIucHVzaCh0aGlzLnJlY3QuY29udGFpbmVyW2ldKTsKCQkJCX0KCgkJCQl0aGlzLmxpbmUxID0gbmV3IE93bERyYXcubGluZSh7eDE6IHRoaXMueCwgeTE6IHRoaXMueSwgeDI6IHRoaXMueCt0aGlzLndpZHRoLCB5MjogdGhpcy55K3RoaXMuaGVpZ2h0fSk7CgkJCQlmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5saW5lMS5jb250YWluZXIubGVuZ3RoOyBpKyspIHsKCQkJCQl0aGlzLmNvbnRhaW5lci5wdXNoKHRoaXMubGluZTEuY29udGFpbmVyW2ldKTsKCQkJCQlpZihtb2RlLnRvICE9IG51bGwpIHRoaXMubGluZTEuY29udGFpbmVyW2ldLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgkJCQl9CgoJCQkJdGhpcy5saW5lMiA9IG5ldyBPd2xEcmF3LmxpbmUoe3gxOiB0aGlzLngrdGhpcy53aWR0aCwgeTE6IHRoaXMueSwgeDI6IHRoaXMueCwgeTI6IHRoaXMueSt0aGlzLmhlaWdodH0pOwoJCQkJZm9yKGxldCBpID0gMDsgaSA8IHRoaXMubGluZTIuY29udGFpbmVyLmxlbmd0aDsgaSsrKSB7CgkJCQkJdGhpcy5jb250YWluZXIucHVzaCh0aGlzLmxpbmUyLmNvbnRhaW5lcltpXSk7CgkJCQkJaWYobW9kZS50byAhPSBudWxsKSB0aGlzLmxpbmUyLmNvbnRhaW5lcltpXS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoJCQkJfQoKCQkJCWlmKG1vZGUuYXJyb3cgPT0gJ25pY2UnKSB7CgkJCQkJdGhpcy5hcnJvdyA9IG5ldyBPd2xEcmF3Lm5pY2VBcnJvdyh7ZnJvbTogdGhpcy5yZWN0LCBmcm9tcDogbW9kZS5mcm9tcCwgdG86IG1vZGUudG8sIHRvcDogbW9kZS50b3B9KTsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCXRoaXMuYXJyb3cgPSBuZXcgT3dsRHJhdy5hcnJvdyh7ZnJvbTogdGhpcy5yZWN0LCBmcm9tcDogbW9kZS5mcm9tcCwgdG86IG1vZGUudG8sIHRvcDogbW9kZS50b3B9KTsKCQkJCX0KCQkJCWZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmFycm93LmNvbnRhaW5lci5sZW5ndGg7IGkrKykgewoJCQkJCXRoaXMuY29udGFpbmVyLnB1c2godGhpcy5hcnJvdy5jb250YWluZXJbaV0pOwoJCQkJfQoJCQl9CgkJfQoKCQkvKioKCQkgKiBNb3ZlcyB0aGUgZWxlbWVudCwgYW5kIHVwZGF0ZXMgdGhlIHBvc2l0aW9uIGRhdGEuIEFsc28gbW92ZXMgdGhlIGNvbm5lY3RlZCBsaW5lcywgYXJyb3dzLiAoc2VlIHtAbGluayBPd2xEcmF3LmVsZW1lbnQjbW92ZX0pCgkJICogQHBhcmFtIHtPYmplY3R9IG9wdCAtIERhdGEgZGVzY3JpYmluZyB0aGUgdHJhbnNpdGlvbgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0LnhdIC0gSWYgZGVmaW5lZCwgdGhlIHgtY29vcmRpbmF0ZSBvZiBwb3NpdGlvbiB3aWxsIGJlIHRoaXMgdmFsdWUKCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdC55XSAtIElmIGRlZmluZWQsIHRoZSB5LWNvb3JkaW5hdGUgb2YgcG9zaXRpb24gd2lsbCBiZSB0aGlzIHZhbHVlCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHQuZHhdIC0gSWYgZGVmaW5lZCwgdGhlIHgtY29vcmRpbmF0ZSBvZiBwb3NpdGlvbiB3aWxsIGJlIGluY3JlYXNlZCBieSB0aGlzIHZhbHVlCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHQuZHldIC0gSWYgZGVmaW5lZCwgdGhlIHktY29vcmRpbmF0ZSBvZiBwb3NpdGlvbiB3aWxsIGJlIGluY3JlYXNlZCBieSB0aGlzCgkJICovCgkJbW92ZShvcHQpIHsKCQkJdGhpcy5yZWN0Lm1vdmUob3B0KTsKCQkJdGhpcy5saW5lMS5tb3ZlKG9wdCk7CgkJCXRoaXMubGluZTIubW92ZShvcHQpOwoJCX0KCgkJLyoqCgkJICogQmluZHMgdGhlIGFycm93IHRvIGEgYmVnZ2lubmluZyBlbGVtZW50IGFuZCBlbmRpbmcgZWxlbWVudAoJCSAqCgkJICogQHBhcmFtIHtPYmplY3R9IG1vZGUgLSBUaGUgb2JqZWN0IGRlc2NyaWJpbmcgdGhlIGJpbmRpbmcKCQkgKiBAcGFyYW0ge093bERyYXcuY29ubmVjdGFibGV9IFttb2RlLmZyb21dIC0gVGhlIGVsZW1lbnQsIHRoZSBhcnJvdyB3aWxsIGJlIGRyYXduIGZyb20KCQkgKiBAcGFyYW0ge3N0cmluZ30gW21vZGUuZnJvbXBdIC0gVGhlIHBvc2l0aW9uLCB0aGUgYXJyb3cgd2lsbCBiZSBkcmF3biBmcm9tICgnbCcgLSBsZWZ0IHNpZGUsICdyJyAtIHJpZ2h0IHNpZGUsICd1JyAtIHVwIHNpZGUsICdkJyAtIGRvd24gc2lkZSkKCQkgKiBAcGFyYW0ge093bERyYXcuY29ubmVjdGFibGV8bnVsbH0gW21vZGUudG9dIC0gVGhlIGVsZW1lbnQsIHRoZSBhcnJvdyB3aWxsIGJlIGRyYXduIHRvLiBJZiBudWxsLCB0aGFuIHRoZSBhcnJvdyBpcyBpbnZpc2libGUuCgkJICogQHBhcmFtIHtzdHJpbmd9IFttb2RlLnRvcF0gLSBUaGUgcG9zaXRpb24sIHRoZSBhcnJvdyB3aWxsIGJlIGRyYXduIHRvICgnbCcgLSBsZWZ0IHNpZGUsICdyJyAtIHJpZ2h0IHNpZGUsICd1JyAtIHVwIHNpZGUsICdkJyAtIGRvd24gc2lkZSkKCQkgKi8KCQliaW5kKG1vZGUpIHsKCQkJaWYobW9kZS50byA9PSBudWxsKSB7CgkJCQl0aGlzLmxpbmUxLmNvbnRhaW5lclswXS5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZSc7CgkJCQl0aGlzLmxpbmUyLmNvbnRhaW5lclswXS5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZSc7CgkJCX0KCQkJZWxzZSB7CgkJCQl0aGlzLmxpbmUxLmNvbnRhaW5lclswXS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoJCQkJdGhpcy5saW5lMi5jb250YWluZXJbMF0uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCQkJfQoJCQl0aGlzLmFycm93LmJpbmQobW9kZSk7CgkJfQoKCQkvKioKCQkgKiBSZW1vdmVzIHRoZSBiaW5kIGZyb20gdGhlIGFycm93LiBJdCBmb2xsb3dzLCB0aGF0IHRoZSBhcnJvdyB3aWxsIG5vdCBtb3ZlLCB3aGVuIHRoZSBlbGVtZW50IGl0IGlzIHBvaW50ZWQgdG8gb3IgcG9pbnRlZCBmcm9tIGlzIG1vdmVkCgkJICovCgkJdW5iaW5kKCkgewoJCQl0aGlzLmFycm93LnVuYmluZCgpOwoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgY29vcmRpbmF0ZXMgb2YgY29ubmVjdGlvbiBwb2ludAoJCSAqIEBwYXJhbSB7c3RyaW5nfSBmcm9tcCAtIFRoZSBwb3NpdGlvbiBvZiBjb25uZWN0aW9uICgnbCcgLSBsZWZ0IHNpZGUsICdyJyAtIHJpZ2h0IHNpZGUsICd1JyAtIHVwIHNpZGUsICdkJyAtIGRvd24gc2lkZSkKCQkgKiBAcmV0dXJucyB7T2JqZWN0fSBkYXRhIC0gVGhlIHBvc2l0aW9uIG9mIGNvbm5lY3Rpb24KCQkgKiBAcmV0dXJucyB7bnVtYmVyfSBkYXRhLnggLSBUaGUgeC1jb29yZGluYXRlIG9mIGNvbm5lY3Rpb24KCQkgKiBAcmV0dXJucyB7bnVtYmVyfSBkYXRhLnkgLSBUaGUgeS1jb29yZGluYXRlIG9mIGNvbm5lY3Rpb24KCQkgKi8KCQlnZXRDb25uZWN0aW9uKGZyb21wKSB7CgkJCWxldCB4ID0gKGZyb21wID09ICdsJyA/IHRoaXMueCA6IChmcm9tcCA9PSAncicgPyB0aGlzLngyIDogKCh0aGlzLnggKyB0aGlzLngyKSAvIDIpKSk7CgkJCWxldCB5ID0gKGZyb21wID09ICd1JyA/IHRoaXMueSA6IChmcm9tcCA9PSAnZCcgPyB0aGlzLnkyIDogKCh0aGlzLnkgKyB0aGlzLnkyKSAvIDIpKSk7CgkJCXJldHVybiB7eDp4LCB5Onl9OwoJCX0KCX0KCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCSogQ29tYmluZWQgZWxlbWVudHMKCSoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgoJLyoqCgkgKiBTaHVmZmxlcyBhbiBhcnJheSBvZiBudW1iZXJzCgkgKiBAbWVtYmVyb2YgT3dsRHJhdwoJICogQHByaXZhdGUKCSAqCgkgKiBAcGFyYW0ge251bWJlcltdfSBhcnIgLSBUaGUgYXJyYXkgb2YgbnVtYmVycwoJICogQHJldHVybnMge251bWJlcltdfSBUaGUgYXJyYXkgb2YgbnVtYmVycyBzaHVmZmxlZAoJICovCglmdW5jdGlvbiBzaHVmZmxlKGFycikgewoJCWZvciAobGV0IGkgPSBhcnIubGVuZ3RoIC0gMTsgaSA+IDA7IGktLSkgewoJCQlsZXQgaiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChpICsgMSkpOwoJCQlsZXQgdG1wID0gYXJyW2ldOwoJCQlhcnJbaV0gPSBhcnJbal07CgkJCWFycltqXSA9IHRtcDsKCQl9CgkJcmV0dXJuIGFycjsKCX0KCgkvKioKCSAqIEdlbmVyYXRlcyBhbiBhcnJheSBvZiBudW1iZXJzIHdpdGggdGhlIGdpdmVuIHByb3BlcnRpZXMKCSAqIEBtZW1iZXJvZiBPd2xEcmF3CgkgKiBAcHJpdmF0ZQoJICoKCSAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gT3B0aW9ucwogCSAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnR5cGUgLSBJZiAncGFyYW0nLCB0aGUgZWxlbWVudHMgd2lsbCBiZSB0YWtlbiBmcm9tIHRoZSBzZWNvbmQgcGFyYW1ldGVyLiBJZiAnc3VjY2VlZGluZycsIHRoZSBlbGVtZW50cyB3aWxsIGJlIHN1Y2NlZWRpbmcgZWxlbWVudHMgKGUuZy4gMSwgMiwgMywgNCwgLi4uKS4gSWYgJ3JhbmRvbScsIHRoZSBlbGVtZW50cyB3aWxsIGJlIHJhbmRvbWx5IGdlbmVyYXRlZC4gSWYgJ2VtcHR5JywgdGhlIGVsZW1lbnRzIHdpbGwgYmUgYWxsIGVtcHR5LgoJICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLm51bV0gLSBOdW1iZXIgb2YgZWxlbWVudHMgdG8gY3JlYXRlCgkgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMubWluXSAtIE1pbmltdW0gb2YgbnVtYmVycwoJICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLm1heF0gLSBNYXhpbXVtIG9mIG51bWJlcnMKCSAqIEBwYXJhbSB7c3RyaW5nfEZ1bmN0aW9ufSBbb3B0aW9ucy5zb3J0XSAtIElmICdzaHVmZmxlJywgdGhlIGVsZW1lbnRzIHdpbGwgYmUgcmFuZG9tbHkgc2h1ZmZsZWQgKHNlZSB7QGxpbmsgc2h1ZmZsZX0pLiBJZiAnc29ydGVkJywgdGhlIGVsZW1lbnRzIHdpbGwgYmUgc29ydGVkIGFzY2VuZGluZ2x5LiBJZiBhIGZ1bmN0aW9uICgoYSxiKT0+dHJ1ZXxmYWxzZSksIHRoZSBlbGVtZW50cyB3aWxsIGJlIHNvcnRlZCBhY2NvcmRpbmcgdG8gdGhlIGZ1bmN0aW9uLgoJICogQHBhcmFtIHtudW1iZXJbXX0gZWxlbWVudHMgLSBFbGVtZW50cyB0byBiZSBhIGJhc2UKCSAqCgkgKiBAcmV0dXJucyB7bnVtYmVyW119IEFuIGFycmF5IG9mIG51bWJlcnMKCSAqLwoJZnVuY3Rpb24gZ2VuZXJhdGVOdW1zKG9wdGlvbnMsIGVsZW1lbnRzKSB7CgkJbGV0IG51bSA9IFtdOyBsZXQgbGVuOwoJCWlmKG9wdGlvbnMudHlwZSA9PSAncGFyYW0nIHx8IGVsZW1lbnRzIGluc3RhbmNlb2YgQXJyYXkpIHsKCQkJbGVuID0gZWxlbWVudHMubGVuZ3RoOwoJCQludW0gPSBlbGVtZW50czsKCQl9CgkJZWxzZSBpZihvcHRpb25zLnR5cGUgPT0gJ3N1Y2NlZWRpbmcnKSB7CgkJCWxlbiA9IG9wdGlvbnMubnVtIHx8IChvcHRpb25zLm1heCAtIG9wdGlvbnMubWluKSB8fCA5OwoJCQlsZXQgbWluID0gb3B0aW9ucy5taW4gfHwgMDsKCQkJbGV0IG1heCA9IG9wdGlvbnMubWF4IHx8IGxlbjsKCQkJZm9yKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CgkJCQludW0ucHVzaChtaW4gKyBpKTsKCQkJfQoJCX0KCQllbHNlIGlmKG9wdGlvbnMudHlwZSA9PSAncmFuZG9tJykgewoJCQlsZW4gPSBvcHRpb25zLm51bSB8fCA5OwoJCQlsZXQgbWF4ID0gb3B0aW9ucy5tYXggfHwgbGVuCgkJCWxldCBtaW4gPSBvcHRpb25zLm1pbiB8fCAwOwoJCQlmb3IobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKCQkJCW51bS5wdXNoKG1pbiArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4pKSk7CgkJCX0KCQl9CgkJZWxzZSBpZihvcHRpb25zLnR5cGUgPT0gJ2VtcHR5JykgewoJCQlsZW4gPSBvcHRpb25zLm51bSB8fCA5OwoJCQlmb3IobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKCQkJCW51bS5wdXNoKCcnKTsKCQkJfQoJCX0KCgkJaWYob3B0aW9ucy5zb3J0ID09ICdzaHVmZmxlJykgbnVtID0gc2h1ZmZsZShudW0pOwoJCWVsc2UgaWYob3B0aW9ucy5zb3J0ID09ICdzb3J0ZWQnKSBudW0uc29ydCgoYSwgYikgPT4ge3JldHVybiBwYXJzZUludChhKSA+IHBhcnNlSW50KGIpfSk7CgkJZWxzZSBpZihvcHRpb25zLnNvcnQgaW5zdGFuY2VvZiBGdW5jdGlvbikgbnVtLnNvcnQob3B0aW9ucy5zb3J0KTsKCgkJcmV0dXJuIG51bTsKCX0KCgkvKioKCSAqIENyZWF0ZXMgYSBiaW5hcnkgdHJlZSBmcm9tIGFuIGFycmF5LiBUaGUgYmluYXJ5IHRyZWUgaXMgc2VhcmNoYWJsZSBpZiBhbmQgb25seSBpZiB0aGUgYXJyYXkgaXMgc29ydGVkLgoJICogQG1lbWJlcm9mIE93bERyYXcKCSAqIEBwcml2YXRlCgkgKgoJICogQHBhcmFtIHtudW1iZXJbXX0gYXJyYXkgLSBUaGUgYXJyYXksIHRoZSBiaW5hcnkgdHJlZSB3aWxsIGJlIGNyZWF0ZWQgZnJvbQoJICogQHBhcmFtIHtudW1iZXJ9IGZyb20gLSBUaGUgaW5kZXgsIHRoZSB2YWx1ZXMgd2lsbCBiZSB0YWtlbiBmcm9tIHRoZSBhcnJheSBiZWdpbm5pbmcgd2l0aCAoaW5jbHVzaXZlKQoJICogQHBhcmFtIHtudW1iZXJ9IGZyb20gLSBUaGUgaW5kZXgsIHRoZSB2YWx1ZXMgd2lsbCBiZSB0YWtlbiBmcm9tIHRoZSBhcnJheSBlbmRpbmcgd2l0aCAoZXhjbHVzaXZlKQoJICoKCSAqIEByZXR1cm5zIHtPYmplY3R9IGVsZW1lbnQgLSBUaGUgYmluYXJ5IHRyZWUKCSAqIEByZXR1cm5zIHtudW1iZXJ9IGVsZW1lbnQudmFsIC0gVGhlIHZhbHVlIG9mIGxlYWYKCSAqIEByZXR1cm5zIHtPYmplY3R9IGVsZW1lbnQubGVmdCAtIFRoZSBsZWZ0IGNoaWxkcmVuCgkgKiBAcmV0dXJucyB7T2JqZWN0fSBlbGVtZW50LnJpZ2h0IC0gVGhlIHJpZ2h0IGNoaWxkcmVuCgkgKi8KCWZ1bmN0aW9uIGFycmF5VG9UcmVlKGFycmF5LCBmcm9tLCB0bykgewoJCWlmKGZyb20gPT0gdG8pIHJldHVybiBudWxsOwoJCWxldCBtaWQgPSBwYXJzZUludCgoZnJvbSArIHRvKSAvIDIpOwoJCXJldHVybiB7CgkJCXZhbDogYXJyYXlbbWlkXSwKCQkJbGVmdDogYXJyYXlUb1RyZWUoYXJyYXksIGZyb20sIG1pZCksCgkJCXJpZ2h0OiBhcnJheVRvVHJlZShhcnJheSwgbWlkKzEsIHRvKQoJCX0KCX0KCgkvKioKCSAqIENsYXNzIHRoYXQgcmVwcmVzZW50cyBhbiBhcnJheQoJICogQG1lbWJlcm9mIE93bERyYXcKCSAqIEBleHRlbmRzIE93bERyYXcuZWxlbWVudAoJICoKCSAqIEBwcm9wZXJ0eSB7RWxlbWVudFtdfSBjb250YWluZXIgLSBBcnJheSBvZiBET00gZWxlbWVudHMgKFNWR0VsZW1lbnQpIHRoYXQgYXJlIGFkZGVkIHRvIHRoZSBzdmcgRE9NCgkgKiBAcHJvcGVydHkge093bERyYXcuY2lyY2xlW119IGVsZW1zIC0gVGhlIGVsZW1lbnRzIG9mIGFycmF5CgkgKiBAcHJvcGVydHkge093bERyYXcuY2lyY2xlW119IGVsZW1lbnRzIC0gVGhlIGVsZW1lbnRzIG9mIGFycmF5CgkgKiBAcHJvcGVydHkge251bWJlcn0gZWxlbWVudHMudmFsIC0gVGhlIHZhbHVlIG9mIHRoZSBnaXZlbiBlbGVtZW50CgkgKi8KCU93bERyYXcuYXJyYXkgPSBjbGFzcyBleHRlbmRzIE93bERyYXcuZ3JvdXAgewoJCS8qKgoJCSAqIENyZWF0ZXMgYW4gYXJyYXksIHdpdGggdmFsdWVzCgkJICoKCQkgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIE9wdGlvbnMKCQkgKiBAcGFyYW0ge251bWJlcn0gb3B0aW9ucy54IC0geC1jb29yZGluYXRlIG9mIHRoZSBmaXJzdCBvZiBjaXJjbGUgKG90aGVyIGNpcmNsZXMgd2lsbCBoYXZlIDIqcmFkaXVzIGRpc3RhbmNlIGJldHdlZW4gZWFjaCBvdGhlcikKCQkgKiBAcGFyYW0ge251bWJlcn0gb3B0aW9ucy55IC0geS1jb29yZGluYXRlIG9mIHRoZSBmaXJzdCBvZiBjaXJjbGUgKG90aGVyIGNpcmNsZXMgd2lsbCBoYXZlIHRoZSBzYW1lIHktY29vcmRpbmF0ZSkKCQkgKiBAcGFyYW0ge251bWJlcn0gb3B0aW9ucy5yYWRpdXMgLSByYWRpdXMgb2YgY2lyY2xlcwoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5jbGFzc10gLSBsaXN0IG9mIGNsYXNzIHRoYXQgd2lsbCBiZSBhZGRlZCB0byB0aGUgRE9NIGVsZW1lbnQKCQkgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMuc3Ryb2tlXSAtIGNvbG9yIG9mIHN0cm9rZSwgdGhhdCBhcHBsaWVzIHRvIHRoZSBjaXJjbGUKCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMuc3Ryb2tlV2lkdGhdIC0gd2lkdGggb2Ygc3Ryb2tlLCB0aGF0IGFwcGxpZXMgdG8gdGhlIGNpcmNsZQoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5maWxsXSAtIGNvbG9yIG9mIGZpbGwsIHRoYXQgYXBwbGllcyB0byB0aGUgY2lyY2xlCgkgCSAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnR5cGUgLSBJZiAncGFyYW0nLCB0aGUgZWxlbWVudHMgd2lsbCBiZSB0YWtlbiBmcm9tIHRoZSBzZWNvbmQgcGFyYW1ldGVyLiBJZiAnc3VjY2VlZGluZycsIHRoZSBlbGVtZW50cyB3aWxsIGJlIHN1Y2NlZWRpbmcgZWxlbWVudHMgKGUuZy4gMSwgMiwgMywgNCwgLi4uKS4gSWYgJ3JhbmRvbScsIHRoZSBlbGVtZW50cyB3aWxsIGJlIHJhbmRvbWx5IGdlbmVyYXRlZC4gSWYgJ2VtcHR5JywgdGhlIGVsZW1lbnRzIHdpbGwgYmUgYWxsIGVtcHR5LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5udW1dIC0gTnVtYmVyIG9mIGVsZW1lbnRzIHRvIGNyZWF0ZQoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5taW5dIC0gTWluaW11bSBvZiBudW1iZXJzCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLm1heF0gLSBNYXhpbXVtIG9mIG51bWJlcnMKCQkgKiBAcGFyYW0ge3N0cmluZ3xGdW5jdGlvbn0gW29wdGlvbnMuc29ydF0gLSBJZiAnc2h1ZmZsZScsIHRoZSBlbGVtZW50cyB3aWxsIGJlIHJhbmRvbWx5IHNodWZmbGVkIChzZWUge0BsaW5rIHNodWZmbGV9KS4gSWYgJ3NvcnRlZCcsIHRoZSBlbGVtZW50cyB3aWxsIGJlIHNvcnRlZCBhc2NlbmRpbmdseS4gSWYgYSBmdW5jdGlvbiAoKGEsYik9PnRydWV8ZmFsc2UpLCB0aGUgZWxlbWVudHMgd2lsbCBiZSBzb3J0ZWQgYWNjb3JkaW5nIHRvIHRoZSBmdW5jdGlvbi4KCQkgKiBAcGFyYW0ge251bWJlcltdfSBbZWxlbWVudHNdIC0gRWxlbWVudHMgdG8gYmUgYSBiYXNlCgkJICoKCQkgKi8KCQljb25zdHJ1Y3RvcihvcHRpb25zLCBlbGVtZW50cykgewoJCQlzdXBlcigpOwoJCQlsZXQgbnVtID0gZ2VuZXJhdGVOdW1zKG9wdGlvbnMsIGVsZW1lbnRzKTsKCQkJdGhpcy5udW0gPSBudW0ubGVuZ3RoOwoKCQkJdGhpcy5lbGVtZW50cyA9IFtdOwoKCQkJZm9yKGxldCBpID0gMDsgaSA8IHRoaXMubnVtOyBpKyspIHsKCQkJCWxldCBjaXJjbGUgPSBuZXcgT3dsRHJhdy5jaXJjbGUoe3g6IG9wdGlvbnMueCArIGkqKDIuNSpvcHRpb25zLnJhZGl1cyksIHk6IG9wdGlvbnMueSwgcmFkaXVzOiBvcHRpb25zLnJhZGl1cywgdHh0OiBudW1baV0udG9TdHJpbmcoKSwgc3Ryb2tlOiBvcHRpb25zLnN0cm9rZSwgc3Ryb2tlV2lkdGg6IG9wdGlvbnMuc3Ryb2tlV2lkdGgsIGZpbGw6IG9wdGlvbnMuZmlsbCwgY2xhc3M6IChvcHRpb25zLmNsYXNzIHx8ICcnKSArICcgYXJyYXknfSk7CgkJCQljaXJjbGUudmFsID0gbnVtW2ldOwoKCQkJCXRoaXMuZWxlbWVudHMucHVzaChjaXJjbGUpOwoJCQkJdGhpcy5hZGQoY2lyY2xlKTsKCQkJfQoJCX0KCgkJLyoqCgkJICogSGlnaGxpZ2h0ZXMgYW4gZWxlbWVudCwgb3IgYWxsIGVsZW1lbnRzLCBieSBhZGRpbiBhIGNsYXNzIHdpdGggdGhlIG5hbWUgJ2hpZ2hsaWdodC17b3B0fScgdG8gdGhlIGNsYXNzIGxpc3QuIFJlbW92ZXMgYWxsIG90aGVyIGhpZ2hsaWdodGVzIG9uIHRoZSBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfHVuZGVmaW5lZH0gaWQgLSBJZiB1bmRlZmluZWQsIGFsbCBlbGVtZW50cyB3aWxsIGJlIGhpZ2hsaWdodGVkLCBpZCBhIG51bWJlciwgdGhlbiB0aGUgZWxlbWVudCB3aXRoIHRoZSBnaXZlbiBpbmRleCB3aWxsIGJlIGhpZ2hsaWdodGVkCgkJICogQHBhcmFtIHtzdHJpbmd9IG9wdCAtIFRoZSBuYW1lIG9mIGhpZ2hsaWdodCAocGFydCBvZiBjbGFzcyBuYW1lKQoJCSAqLwoJCWhpZ2hsaWdodChpZCwgb3B0KSB7CgkJCWlmKGlkID09IHVuZGVmaW5lZCkgewoJCQkJZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuZWxlbWVudHMubGVuZ3RoOyBpKyspIHsKCQkJCQl0aGlzLmVsZW1lbnRzW2ldLmhpZ2hsaWdodChvcHQpOwoJCQkJfQoJCQl9CgkJCWVsc2UgewoJCQkJdGhpcy5lbGVtZW50c1tpZF0uaGlnaGxpZ2h0KG9wdCk7CgkJCX0KCQl9CgoJCS8qKgoJCSAqIFJlbW92ZXMgYWxsIGhpZ2hsaWdodGVzIGZyb20gYW4gZWxlbWVudCBvciBhbGwgZWxlbWVudHMKCQkgKiBAcGFyYW0ge251bWJlcnx1bmRlZmluZWR9IGlkIC0gSWYgdW5kZWZpbmVkLCBhbGwgZWxlbWVudHMgd2lsbCBiZSB1bmhpZ2hsaWdodGVkLCBpZCBhIG51bWJlciwgdGhlbiB0aGUgZWxlbWVudCB3aXRoIHRoZSBnaXZlbiBpbmRleCB3aWxsIGJlIHVuaGlnaGxpZ2h0ZWQKCQkgKi8KCQl1bmhpZ2hsaWdodChpZCkgewoJCQlpZihpZCA9PSB1bmRlZmluZWQpIHsKCQkJCWZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCQkJdGhpcy5lbGVtZW50c1tpXS51bmhpZ2hsaWdodCgpOwoJCQkJfQoJCQl9CgkJCWVsc2UgewoJCQkJdGhpcy5lbGVtZW50c1tpZF0udW5oaWdobGlnaHQoKTsKCQkJfQoJCX0KCgkJLyoqCgkJICogU3dhcHMgdHdvIGVsZW1lbnRzIHdpdGggdGhlIGdpdmVuIGluZGV4IGluIHRoZSBhcnJheQoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGkgLSBUaGUgaW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQKCQkgKiBAcGFyYW0ge251bWJlcn0gaiAtIFRoZSBpbmRleCBvZiB0aGUgc2Vjb25kIGVsZW1lbnQKCQkgKi8KCQlzd2FwKGksIGopIHsKCQkJbGV0IG94ID0gdGhpcy5lbGVtZW50c1tpXS54OwoJCQlsZXQgb3kgPSB0aGlzLmVsZW1lbnRzW2ldLnk7CgoJCQlzZXRUaW1lb3V0KCgpID0+IHsKCQkJCXRoaXMuZWxlbWVudHNbaV0uY29udGFpbmVyWzBdLmNoaWxkcmVuWzBdLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGUoMCwwKSc7CgkJCQl0aGlzLmVsZW1lbnRzW2ldLmNvbnRhaW5lclswXS5jaGlsZHJlblsxXS5zdHlsZS50cmFuc2Zvcm0gPSAndHJhbnNsYXRlKDAsMCknOwoJCQkJdGhpcy5lbGVtZW50c1tqXS5jb250YWluZXJbMF0uY2hpbGRyZW5bMF0uc3R5bGUudHJhbnNmb3JtID0gJ3RyYW5zbGF0ZSgwLDApJzsKCQkJCXRoaXMuZWxlbWVudHNbal0uY29udGFpbmVyWzBdLmNoaWxkcmVuWzFdLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGUoMCwwKSc7CgkJCX0sIDUwMCpEVVJBVElPTik7CgoJCQlzZXRUaW1lb3V0KCgpID0+IHsKCQkJCXRoaXMuZWxlbWVudHNbaV0uY29udGFpbmVyWzBdLnN0eWxlLnpJbmRleCA9ICcnOwoJCQkJdGhpcy5lbGVtZW50c1tqXS5jb250YWluZXJbMF0uc3R5bGUuekluZGV4ID0gJyc7CgkJCX0sIDEwMDAqRFVSQVRJT04pOwoKCQkJdGhpcy5lbGVtZW50c1tpXS5jb250YWluZXJbMF0uY2hpbGRyZW5bMF0uc3R5bGUudHJhbnNmb3JtID0gJ3RyYW5zbGF0ZSgwLCAnICsgMyp0aGlzLmVsZW1lbnRzW2ldLnJhZGl1cyArICdweCknOwoJCQl0aGlzLmVsZW1lbnRzW2ldLmNvbnRhaW5lclswXS5jaGlsZHJlblsxXS5zdHlsZS50cmFuc2Zvcm0gPSAndHJhbnNsYXRlKDAsICcgKyAzKnRoaXMuZWxlbWVudHNbaV0ucmFkaXVzICsgJ3B4KSc7CgkJCXRoaXMuZWxlbWVudHNbal0uY29udGFpbmVyWzBdLmNoaWxkcmVuWzBdLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGUoMCwgLScgKyAzKnRoaXMuZWxlbWVudHNbaV0ucmFkaXVzICsgJ3B4KSc7CgkJCXRoaXMuZWxlbWVudHNbal0uY29udGFpbmVyWzBdLmNoaWxkcmVuWzFdLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGUoMCwgLScgKyAzKnRoaXMuZWxlbWVudHNbaV0ucmFkaXVzICsgJ3B4KSc7CgkJCXRoaXMuZWxlbWVudHNbaV0uY29udGFpbmVyWzBdLnN0eWxlLnpJbmRleCA9IDEwMDsKCQkJdGhpcy5lbGVtZW50c1tqXS5jb250YWluZXJbMF0uc3R5bGUuekluZGV4ID0gMTAwOwoKCQkJdGhpcy5lbGVtZW50c1tpXS5tb3ZlKHt4OiB0aGlzLmVsZW1lbnRzW2pdLngsIHk6IHRoaXMuZWxlbWVudHNbal0ueX0pOwoJCQl0aGlzLmVsZW1lbnRzW2pdLm1vdmUoe3g6IG94LCB5OiBveSB9KTsKCgkJCWxldCB0bXAgPSB0aGlzLmVsZW1lbnRzW2ldOwoJCQl0aGlzLmVsZW1lbnRzW2ldID0gdGhpcy5lbGVtZW50c1tqXTsKCQkJdGhpcy5lbGVtZW50c1tqXSA9IHRtcDsKCQl9Cgl9CgoJLyoqCgkgKiBDbGFzcyB0aGF0IHJlcHJlc2VudHMgYSBsaXN0IGVsZW1lbnQKCSAqIEBtZW1iZXJvZiBPd2xEcmF3CgkgKiBAZXh0ZW5kcyBPd2xEcmF3Lmdyb3VwCgkgKgoJICogQHByb3BlcnR5IHtFbGVtZW50W119IGNvbnRhaW5lciAtIEFycmF5IG9mIERPTSBlbGVtZW50cyAoU1ZHRWxlbWVudCkgdGhhdCBhcmUgYWRkZWQgdG8gdGhlIHN2ZyBET00KCSAqIEBwcm9wZXJ0eSB7T3dsRHJhdy5lbGVtZW50W119IGVsZW1zIC0gTGlzdCBvZiBlbGVtZW50cyBpbiB0aGUgZ3JvdXAKCSAqIEBwcm9wZXJ0eSB7T3dsRHJhdy5yZWN0fSBkYXRhIC0gVGhlIHJlY3RhbmdsZSByZXByZXNlbnRpbmcgdGhlIGRhdGEgcGFydCBvZiB0aGUgbGlzdCBlbGVtZW50CgkgKiBAcHJvcGVydHkge093bERyYXcucG9pbnRlcn0gcG9pbnRlciAtIFRoZSBwb2ludGVyIHJlcHJlc2VudGluZyB0aGUgcG9pbnRlciBwYXJ0IG9mIHRoZSBsaXN0IGVsZW1lbnQKCSAqLwoJT3dsRHJhdy5saXN0RWxlbSA9IGNsYXNzIGV4dGVuZHMgT3dsRHJhdy5ncm91cCB7CgkJLyoqCgkJICogQ3JlYXRlcyBhIGxpc3QgZWxlbWVudAoJCSAqCgkJICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBPcHRpb25zCgkJICogQHBhcmFtIHtudW1iZXJ9IG9wdGlvbnMueCAtIFRoZSB0b3AtbGVmdCB4LWNvb3JkaW5hdGUgb2YgdGhlIGxpc3QgZWxlbWVudAoJCSAqIEBwYXJhbSB7bnVtYmVyfSBvcHRpb25zLnkgLSBUaGUgdG9wLWxlZnQgeS1jb29yZGluYXRlIG9mIHRoZSBsaXN0IGVsZW1lbnQKCQkgKiBAcGFyYW0ge251bWJlcn0gb3B0aW9ucy5zaXplIC0gVGhlIHdpZHRoIG9mIHRoZSBlbGVtZW50LiBUaGUgaGVpZ2h0IG9mIHRoZSBkYXRhIGFyZWEgbWF0Y2hlcyB0aGlzIHZhbHVlLCB3aGlsZSB0aGUgaGVpZ2h0IG9mIHRoZSBwb2ludGVyIGlzIHRoZSB0aGlyZCBvZiB0aGlzIHZhbHVlLgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5jbGFzc10gLSBsaXN0IG9mIGNsYXNzIHRoYXQgd2lsbCBiZSBhZGRlZCB0byB0aGUgRE9NIGVsZW1lbnQKCQkgKiBAcGFyYW0ge093bERyYXcuY29ubmVjdGFibGV8bnVsbH0gW29wdGlvbnMubmV4dF0gLSBUaGUgZWxlbWVudCwgdGhlIGFycm93IHdpbGwgYmUgZHJhd24gdG8uCgkJICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLnRvcF0gLSBUaGUgcG9zaXRpb24sIHRoZSBhcnJvdyB3aWxsIGJlIGRyYXduIHRvICgnbCcgLSBsZWZ0IHNpZGUsICdyJyAtIHJpZ2h0IHNpZGUsICd1JyAtIHVwIHNpZGUsICdkJyAtIGRvd24gc2lkZSkKCQkgKi8KCQljb25zdHJ1Y3RvcihvcHRpb25zKSB7CgkJCXN1cGVyKCk7CgoJCQl0aGlzLmNvbnRhaW5lciA9IFtdOwoKCQkJdGhpcy5kYXRhID0gbmV3IE93bERyYXcucmVjdCh7eDogb3B0aW9ucy54LCB5OiBvcHRpb25zLnksIHdpZHRoOiBvcHRpb25zLnNpemUsIGhlaWdodDogb3B0aW9ucy5zaXplLCB0eHQ6IG9wdGlvbnMudHh0LCBjbGFzczogKG9wdGlvbnMuY2xhc3MgfHwgJycpICsgJyBsaXN0RWxlbSd9KTsKCQkJdGhpcy5wb2ludGVyID0gbmV3IE93bERyYXcucG9pbnRlcih7eDogb3B0aW9ucy54LCB5OiBvcHRpb25zLnkgKyBvcHRpb25zLnNpemUsIHdpZHRoOiBvcHRpb25zLnNpemUsIGhlaWdodDogb3B0aW9ucy5zaXplLzMsIGZyb21wOiAncicsIHRvOiBvcHRpb25zLm5leHQgfHwgbnVsbCwgdG9wOiBvcHRpb25zLnRvcCwgYXJyb3c6ICduaWNlJywgY2xhc3M6IChvcHRpb25zLmNsYXNzIHx8ICcnKSArICcgbGlzdEVsZW0nfSk7CgoJCQl0aGlzLmFkZCh0aGlzLmRhdGEpOwoJCQl0aGlzLmFkZCh0aGlzLnBvaW50ZXIpOwoJCX0KCX0KCgkvKioKCSAqIENsYXNzIHRoYXQgcmVwcmVzZW50cyBhIGxpbmtlZCBsaXN0CgkgKiBAbWVtYmVyb2YgT3dsRHJhdwoJICogQGV4dGVuZHMgT3dsRHJhdy5ncm91cAoJICoKCSAqIEBwcm9wZXJ0eSB7RWxlbWVudFtdfSBjb250YWluZXIgLSBBcnJheSBvZiBET00gZWxlbWVudHMgKFNWR0VsZW1lbnQpIHRoYXQgYXJlIGFkZGVkIHRvIHRoZSBzdmcgRE9NCgkgKiBAcHJvcGVydHkge093bERyYXcuZWxlbWVudFtdfSBlbGVtcyAtIExpc3Qgb2YgZWxlbWVudHMgaW4gdGhlIGdyb3VwCgkgKiBAcHJvcGVydHkge251bWJlcn0gbnVtIC0gVGhlIG51bWJlciBvZiBlbGVtZW50cwoJICogQHByb3BlcnR5IHtPd2xEcmF3Lmxpc3RFbGVtW119IGVsZW1lbnRzIC0gVGhlIGVsZW1lbnRzIG9mIHRoZSBsaW5rZWQgbGlzdAoJICogQHByb3BlcnR5IHtudW1iZXJ9IGVsZW1lbnRzLnZhbCAtIFRoZSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZWxlbWVudAoJICogQHByb3BlcnR5IHtPd2xEcmF3Lmxpc3RFbGVtfG51bGx9IGVsZW1lbnRzLm5leHQgLSBSZWZlcmVuY2UgdG8gdGhlIG5leHQgZWxlbWVudCBpbiB0aGUgbGlzdAoJICovCglPd2xEcmF3Lmxpc3QgPSBjbGFzcyBleHRlbmRzIE93bERyYXcuZ3JvdXAgewoJCS8qKgoJCSAqIENyZWF0ZXMgYSBsaW5rZWQgbGlzdCwgd2l0aCB2YWx1ZXMKCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gT3B0aW9ucwoJCSAqIEBwYXJhbSB7bnVtYmVyfSBvcHRpb25zLnggLSBUaGUgdG9wLWxlZnQgeC1jb29yZGluYXRlIG9mIHRoZSBsaXN0CgkJICogQHBhcmFtIHtudW1iZXJ9IG9wdGlvbnMueSAtIFRoZSB0b3AtbGVmdCB5LWNvb3JkaW5hdGUgb2YgdGhlIGxpc3QKCQkgKiBAcGFyYW0ge251bWJlcn0gb3B0aW9ucy5zaXplIC0gVGhlIHdpZHRoIG9mIHRoZSBlbGVtZW50LiBUaGUgaGVpZ2h0IG9mIHRoZSBkYXRhIGFyZWEgbWF0Y2hlcyB0aGlzIHZhbHVlLCB3aGlsZSB0aGUgaGVpZ2h0IG9mIHRoZSBwb2ludGVyIGlzIHRoZSB0aGlyZCBvZiB0aGlzIHZhbHVlLgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5jbGFzc10gLSBsaXN0IG9mIGNsYXNzIHRoYXQgd2lsbCBiZSBhZGRlZCB0byB0aGUgRE9NIGVsZW1lbnQKCSAJICogQHBhcmFtIHtzdHJpbmd9IG9wdGlvbnMudHlwZSAtIElmICdwYXJhbScsIHRoZSBlbGVtZW50cyB3aWxsIGJlIHRha2VuIGZyb20gdGhlIHNlY29uZCBwYXJhbWV0ZXIuIElmICdzdWNjZWVkaW5nJywgdGhlIGVsZW1lbnRzIHdpbGwgYmUgc3VjY2VlZGluZyBlbGVtZW50cyAoZS5nLiAxLCAyLCAzLCA0LCAuLi4pLiBJZiAncmFuZG9tJywgdGhlIGVsZW1lbnRzIHdpbGwgYmUgcmFuZG9tbHkgZ2VuZXJhdGVkLiBJZiAnZW1wdHknLCB0aGUgZWxlbWVudHMgd2lsbCBiZSBhbGwgZW1wdHkuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLm51bV0gLSBOdW1iZXIgb2YgZWxlbWVudHMgdG8gY3JlYXRlCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLm1pbl0gLSBNaW5pbXVtIG9mIG51bWJlcnMKCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMubWF4XSAtIE1heGltdW0gb2YgbnVtYmVycwoJCSAqIEBwYXJhbSB7c3RyaW5nfEZ1bmN0aW9ufSBbb3B0aW9ucy5zb3J0XSAtIElmICdzaHVmZmxlJywgdGhlIGVsZW1lbnRzIHdpbGwgYmUgcmFuZG9tbHkgc2h1ZmZsZWQgKHNlZSB7QGxpbmsgc2h1ZmZsZX0pLiBJZiAnc29ydGVkJywgdGhlIGVsZW1lbnRzIHdpbGwgYmUgc29ydGVkIGFzY2VuZGluZ2x5LiBJZiBhIGZ1bmN0aW9uICgoYSxiKT0+dHJ1ZXxmYWxzZSksIHRoZSBlbGVtZW50cyB3aWxsIGJlIHNvcnRlZCBhY2NvcmRpbmcgdG8gdGhlIGZ1bmN0aW9uLgoJCSAqIEBwYXJhbSB7bnVtYmVyW119IFtlbGVtZW50c10gLSBFbGVtZW50cyB0byBiZSBhIGJhc2UKCQkgKgoJCSAqLwoJCWNvbnN0cnVjdG9yKG9wdGlvbnMsIGVsZW1lbnRzKSB7CgkJCXN1cGVyKCk7CgkJCWxldCBudW0gPSBnZW5lcmF0ZU51bXMob3B0aW9ucywgZWxlbWVudHMpOwoJCQl0aGlzLm51bSA9IG51bS5sZW5ndGg7CgoJCQl0aGlzLmNvbnRhaW5lciA9IFtdOwoJCQl0aGlzLmVsZW1lbnRzID0gW107CgoJCQlmb3IobGV0IGkgPSB0aGlzLm51bSAtIDE7IGkgPj0gMDsgaS0tKSB7CgkJCQlsZXQgZWxlbSA9IG5ldyBPd2xEcmF3Lmxpc3RFbGVtKHt4OiBvcHRpb25zLnggKyBpKigyKm9wdGlvbnMuc2l6ZSksIHk6IG9wdGlvbnMueSwgc2l6ZTogb3B0aW9ucy5zaXplLCB0eHQ6IG51bVtpXS50b1N0cmluZygpLCBjbGFzczogKG9wdGlvbnMuY2xhc3MgfHwgJycpICsgJyBsaXN0JywgdG9wOiAnbCcsIG5leHQ6IChpID09IHRoaXMubnVtIC0gMSA/IG51bGwgOiB0aGlzLmVsZW1lbnRzWzBdLmRhdGEpfSk7CgkJCQllbGVtLnZhbCA9IG51bVtpXTsKCQkJCWVsZW0ubmV4dCA9IGkgPT0gdGhpcy5udW0gLSAxID8gbnVsbCA6IHRoaXMuZWxlbWVudHNbMF07CgoJCQkJdGhpcy5lbGVtZW50cy51bnNoaWZ0KGVsZW0pOwoJCQkJdGhpcy5hZGQoZWxlbSk7CgkJCX0KCQl9CgoJCS8qKgoJCSAqIEhpZ2hsaWdodGVzIGFuIGVsZW1lbnQsIG9yIGFsbCBlbGVtZW50cywgYnkgYWRkaW4gYSBjbGFzcyB3aXRoIHRoZSBuYW1lICdoaWdobGlnaHQte29wdH0nIHRvIHRoZSBjbGFzcyBsaXN0LiBSZW1vdmVzIGFsbCBvdGhlciBoaWdobGlnaHRlcyBvbiB0aGUgZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcnx1bmRlZmluZWR9IGlkIC0gSWYgdW5kZWZpbmVkLCBhbGwgZWxlbWVudHMgd2lsbCBiZSBoaWdobGlnaHRlZCwgaWQgYSBudW1iZXIsIHRoZW4gdGhlIGVsZW1lbnQgd2l0aCB0aGUgZ2l2ZW4gaW5kZXggd2lsbCBiZSBoaWdobGlnaHRlZAoJCSAqIEBwYXJhbSB7c3RyaW5nfSBvcHQgLSBUaGUgbmFtZSBvZiBoaWdobGlnaHQgKHBhcnQgb2YgY2xhc3MgbmFtZSkKCQkgKi8KCQloaWdobGlnaHQoaWQsIG9wdCkgewoJCQlpZihpZCA9PSB1bmRlZmluZWQpIHsKCQkJCWZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCQkJdGhpcy5lbGVtZW50c1tpXS5oaWdobGlnaHQob3B0KTsKCQkJCX0KCQkJfQoJCQllbHNlIHsKCQkJCXRoaXMuZWxlbWVudHNbaWRdLmhpZ2hsaWdodChvcHQpOwoJCQl9CgkJfQoKCQkvKioKCQkgKiBSZW1vdmVzIGFsbCBoaWdobGlnaHRlcyBmcm9tIGFuIGVsZW1lbnQgb3IgYWxsIGVsZW1lbnRzCgkJICogQHBhcmFtIHtudW1iZXJ8dW5kZWZpbmVkfSBpZCAtIElmIHVuZGVmaW5lZCwgYWxsIGVsZW1lbnRzIHdpbGwgYmUgdW5oaWdobGlnaHRlZCwgaWQgYSBudW1iZXIsIHRoZW4gdGhlIGVsZW1lbnQgd2l0aCB0aGUgZ2l2ZW4gaW5kZXggd2lsbCBiZSB1bmhpZ2hsaWdodGVkCgkJICovCgkJdW5oaWdobGlnaHQoaWQpIHsKCQkJaWYoaWQgPT0gdW5kZWZpbmVkKSB7CgkJCQlmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5lbGVtZW50cy5sZW5ndGg7IGkrKykgewoJCQkJCXRoaXMuZWxlbWVudHNbaV0udW5oaWdobGlnaHQoKTsKCQkJCX0KCQkJfQoJCQllbHNlIHsKCQkJCXRoaXMuZWxlbWVudHNbaWRdLnVuaGlnaGxpZ2h0KCk7CgkJCX0KCQl9Cgl9CgoJLyoqCgkgKiBDbGFzcyB0aGF0IHJlcHJlc2VudHMgYW4gZWxlbWVudCBvZiBhIGRvdWJsZSBsaW5rZWQgbGlzdAoJICogQG1lbWJlcm9mIE93bERyYXcKCSAqIEBleHRlbmRzIE93bERyYXcuZ3JvdXAKCSAqCgkgKiBAcHJvcGVydHkge0VsZW1lbnRbXX0gY29udGFpbmVyIC0gQXJyYXkgb2YgRE9NIGVsZW1lbnRzIChTVkdFbGVtZW50KSB0aGF0IGFyZSBhZGRlZCB0byB0aGUgc3ZnIERPTQoJICogQHByb3BlcnR5IHtPd2xEcmF3LmVsZW1lbnRbXX0gZWxlbXMgLSBMaXN0IG9mIGVsZW1lbnRzIGluIHRoZSBncm91cAoJICogQHByb3BlcnR5IHtPd2xEcmF3LnJlY3R9IGRhdGEgLSBUaGUgcmVjdGFuZ2xlIHJlcHJlc2VudGluZyB0aGUgZGF0YSBwYXJ0IG9mIHRoZSBsaXN0IGVsZW1lbnQKCSAqIEBwcm9wZXJ0eSB7T3dsRHJhdy5wb2ludGVyfSBwb2ludGVyUHJldiAtIFRoZSBwb2ludGVyIHJlcHJlc2VudGluZyB0aGUgcG9pbnRlciB0byB0aGUgcHJldmlvdXMgZWxlbWVudAoJICogQHByb3BlcnR5IHtPd2xEcmF3LnBvaW50ZXJ9IHBvaW50ZXJOZXh0IC0gVGhlIHBvaW50ZXIgcmVwcmVzZW50aW5nIHRoZSBwb2ludGVyIHRvIHRoZSBuZXh0IGVsZW1lbnQKCSAqLwoJT3dsRHJhdy5kbGxFbGVtID0gY2xhc3MgZXh0ZW5kcyBPd2xEcmF3Lmdyb3VwIHsKCQkvKioKCQkgKiBDcmVhdGVzIGFuIGVsZW1lbnQgb2YgYSBkb3VibGUgbGlua2VkIGxpc3QKCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gT3B0aW9ucwoJCSAqIEBwYXJhbSB7bnVtYmVyfSBvcHRpb25zLnggLSBUaGUgdG9wLWxlZnQgeC1jb29yZGluYXRlIG9mIHRoZSBsaXN0IGVsZW1lbnQKCQkgKiBAcGFyYW0ge251bWJlcn0gb3B0aW9ucy55IC0gVGhlIHRvcC1sZWZ0IHktY29vcmRpbmF0ZSBvZiB0aGUgbGlzdCBlbGVtZW50CgkJICogQHBhcmFtIHtudW1iZXJ9IG9wdGlvbnMuc2l6ZSAtIFRoZSB3aWR0aCBvZiB0aGUgZWxlbWVudC4gVGhlIGhlaWdodCBvZiB0aGUgZGF0YSBhcmVhIG1hdGNoZXMgdGhpcyB2YWx1ZSwgd2hpbGUgdGhlIGhlaWdodCBvZiB0aGUgcG9pbnRlcnMgaXMgdGhlIHRoaXJkIG9mIHRoaXMgdmFsdWUuCgkJICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLmNsYXNzXSAtIGxpc3Qgb2YgY2xhc3MgdGhhdCB3aWxsIGJlIGFkZGVkIHRvIHRoZSBET00gZWxlbWVudAoJCSAqIEBwYXJhbSB7T3dsRHJhdy5jb25uZWN0YWJsZXxudWxsfSBbb3B0aW9ucy5uZXh0XSAtIFRoZSBlbGVtZW50LCB0aGUgbmV4dCBhcnJvdyB3aWxsIGJlIGRyYXduIHRvLgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy50b3BdIC0gVGhlIHBvc2l0aW9uLCB0aGUgbmV4dCBhcnJvdyB3aWxsIGJlIGRyYXduIHRvICgnbCcgLSBsZWZ0IHNpZGUsICdyJyAtIHJpZ2h0IHNpZGUsICd1JyAtIHVwIHNpZGUsICdkJyAtIGRvd24gc2lkZSkKCQkgKiBAcGFyYW0ge093bERyYXcuY29ubmVjdGFibGV8bnVsbH0gW29wdGlvbnMucHJldl0gLSBUaGUgZWxlbWVudCwgdGhlIHByZXZpb3VzIGFycm93IHdpbGwgYmUgZHJhd24gdG8uCgkJICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLnRvcFBdIC0gVGhlIHBvc2l0aW9uLCB0aGUgcHJldmlvdXMgYXJyb3cgd2lsbCBiZSBkcmF3biB0byAoJ2wnIC0gbGVmdCBzaWRlLCAncicgLSByaWdodCBzaWRlLCAndScgLSB1cCBzaWRlLCAnZCcgLSBkb3duIHNpZGUpCgkJICovCgkJY29uc3RydWN0b3Iob3B0aW9ucykgewoJCQlzdXBlcigpOwoKCQkJdGhpcy5jb250YWluZXIgPSBbXTsKCgkJCXRoaXMucG9pbnRlclByZXYgPSBuZXcgT3dsRHJhdy5wb2ludGVyKHt4OiBvcHRpb25zLngsIHk6IG9wdGlvbnMueSwgd2lkdGg6IG9wdGlvbnMuc2l6ZSwgaGVpZ2h0OiBvcHRpb25zLnNpemUvMywgZnJvbXA6ICdsJywgdG86IG9wdGlvbnMucHJldiB8fCBudWxsLCB0b3A6IG9wdGlvbnMudG9wUCwgYXJyb3c6ICduaWNlJywgY2xhc3M6IChvcHRpb25zLmNsYXNzIHx8ICcnKSArICcgZGxsRWxlbSd9KTsKCQkJdGhpcy5kYXRhID0gbmV3IE93bERyYXcucmVjdCh7eDogb3B0aW9ucy54LCB5OiBvcHRpb25zLnkgKyBvcHRpb25zLnNpemUvMywgd2lkdGg6IG9wdGlvbnMuc2l6ZSwgaGVpZ2h0OiBvcHRpb25zLnNpemUsIHR4dDogb3B0aW9ucy50eHQsIGNsYXNzOiAob3B0aW9ucy5jbGFzcyB8fCAnJykgKyAnIGRsbEVsZW0nfSk7CgkJCXRoaXMucG9pbnRlck5leHQgPSBuZXcgT3dsRHJhdy5wb2ludGVyKHt4OiBvcHRpb25zLngsIHk6IG9wdGlvbnMueSArIG9wdGlvbnMuc2l6ZSo0LzMsIHdpZHRoOiBvcHRpb25zLnNpemUsIGhlaWdodDogb3B0aW9ucy5zaXplLzMsIGZyb21wOiAncicsIHRvOiBvcHRpb25zLm5leHQgfHwgbnVsbCwgdG9wOiBvcHRpb25zLnRvcCwgYXJyb3c6ICduaWNlJywgY2xhc3M6IChvcHRpb25zLmNsYXNzIHx8ICcnKSArICcgZGxsRWxlbSd9KTsKCgkJCXRoaXMuYWRkKHRoaXMuZGF0YSk7CgkJCXRoaXMuYWRkKHRoaXMucG9pbnRlclByZXYpOwoJCQl0aGlzLmFkZCh0aGlzLnBvaW50ZXJOZXh0KTsKCQl9Cgl9CgoJLyoqCgkgKiBDbGFzcyB0aGF0IHJlcHJlc2VudHMgYSBkb3VibGUgbGlua2VkIGxpc3QKCSAqIEBtZW1iZXJvZiBPd2xEcmF3CgkgKiBAZXh0ZW5kcyBPd2xEcmF3Lmdyb3VwCgkgKgoJICogQHByb3BlcnR5IHtFbGVtZW50W119IGNvbnRhaW5lciAtIEFycmF5IG9mIERPTSBlbGVtZW50cyAoU1ZHRWxlbWVudCkgdGhhdCBhcmUgYWRkZWQgdG8gdGhlIHN2ZyBET00KCSAqIEBwcm9wZXJ0eSB7T3dsRHJhdy5lbGVtZW50W119IGVsZW1zIC0gTGlzdCBvZiBlbGVtZW50cyBpbiB0aGUgZ3JvdXAKCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBudW0gLSBUaGUgbnVtYmVyIG9mIGVsZW1lbnRzCgkgKiBAcHJvcGVydHkge093bERyYXcubGlzdEVsZW1bXX0gZWxlbWVudHMgLSBUaGUgZWxlbWVudHMgb2YgdGhlIGxpbmtlZCBsaXN0CgkgKiBAcHJvcGVydHkge251bWJlcn0gZWxlbWVudHMudmFsIC0gVGhlIHZhbHVlIG9mIHRoZSBnaXZlbiBlbGVtZW50CgkgKiBAcHJvcGVydHkge093bERyYXcubGlzdEVsZW18bnVsbH0gZWxlbWVudHMubmV4dCAtIFJlZmVyZW5jZSB0byB0aGUgbmV4dCBlbGVtZW50IGluIHRoZSBsaXN0CgkgKiBAcHJvcGVydHkge093bERyYXcubGlzdEVsZW18bnVsbH0gZWxlbWVudHMubmV4dCAtIFJlZmVyZW5jZSB0byB0aGUgcHJldmlvdXMgZWxlbWVudCBpbiB0aGUgbGlzdAoJICovCglPd2xEcmF3LmRsTGlzdCA9IGNsYXNzIGV4dGVuZHMgT3dsRHJhdy5ncm91cCB7CgkJLyoqCgkJICogQ3JlYXRlcyBhIGRvdWJsZSBsaW5rZWQgbGlzdCwgd2l0aCB2YWx1ZXMKCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gT3B0aW9ucwoJCSAqIEBwYXJhbSB7bnVtYmVyfSBvcHRpb25zLnggLSBUaGUgdG9wLWxlZnQgeC1jb29yZGluYXRlIG9mIHRoZSBsaXN0CgkJICogQHBhcmFtIHtudW1iZXJ9IG9wdGlvbnMueSAtIFRoZSB0b3AtbGVmdCB5LWNvb3JkaW5hdGUgb2YgdGhlIGxpc3QKCQkgKiBAcGFyYW0ge251bWJlcn0gb3B0aW9ucy5zaXplIC0gVGhlIHdpZHRoIG9mIHRoZSBlbGVtZW50LiBUaGUgaGVpZ2h0IG9mIHRoZSBkYXRhIGFyZWEgbWF0Y2hlcyB0aGlzIHZhbHVlLCB3aGlsZSB0aGUgaGVpZ2h0IG9mIHRoZSBwb2ludGVyIGlzIHRoZSB0aGlyZCBvZiB0aGlzIHZhbHVlLgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5jbGFzc10gLSBsaXN0IG9mIGNsYXNzIHRoYXQgd2lsbCBiZSBhZGRlZCB0byB0aGUgRE9NIGVsZW1lbnQKCQkgKiBAcGFyYW0ge3N0cmluZ30gb3B0aW9ucy50eXBlIC0gSWYgJ3BhcmFtJywgdGhlIGVsZW1lbnRzIHdpbGwgYmUgdGFrZW4gZnJvbSB0aGUgc2Vjb25kIHBhcmFtZXRlci4gSWYgJ3N1Y2NlZWRpbmcnLCB0aGUgZWxlbWVudHMgd2lsbCBiZSBzdWNjZWVkaW5nIGVsZW1lbnRzIChlLmcuIDEsIDIsIDMsIDQsIC4uLikuIElmICdyYW5kb20nLCB0aGUgZWxlbWVudHMgd2lsbCBiZSByYW5kb21seSBnZW5lcmF0ZWQuIElmICdlbXB0eScsIHRoZSBlbGVtZW50cyB3aWxsIGJlIGFsbCBlbXB0eS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMubnVtXSAtIE51bWJlciBvZiBlbGVtZW50cyB0byBjcmVhdGUKCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMubWluXSAtIE1pbmltdW0gb2YgbnVtYmVycwoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5tYXhdIC0gTWF4aW11bSBvZiBudW1iZXJzCgkJICogQHBhcmFtIHtzdHJpbmd8RnVuY3Rpb259IFtvcHRpb25zLnNvcnRdIC0gSWYgJ3NodWZmbGUnLCB0aGUgZWxlbWVudHMgd2lsbCBiZSByYW5kb21seSBzaHVmZmxlZCAoc2VlIHtAbGluayBzaHVmZmxlfSkuIElmICdzb3J0ZWQnLCB0aGUgZWxlbWVudHMgd2lsbCBiZSBzb3J0ZWQgYXNjZW5kaW5nbHkuIElmIGEgZnVuY3Rpb24gKChhLGIpPT50cnVlfGZhbHNlKSwgdGhlIGVsZW1lbnRzIHdpbGwgYmUgc29ydGVkIGFjY29yZGluZyB0byB0aGUgZnVuY3Rpb24uCgkJICogQHBhcmFtIHtudW1iZXJbXX0gW2VsZW1lbnRzXSAtIEVsZW1lbnRzIHRvIGJlIGEgYmFzZQoJCSAqCgkJICovCgkJY29uc3RydWN0b3Iob3B0aW9ucywgZWxlbWVudHMpIHsKCQkJc3VwZXIoKTsKCQkJbGV0IG51bSA9IGdlbmVyYXRlTnVtcyhvcHRpb25zLCBlbGVtZW50cyk7CgkJCXRoaXMubnVtID0gbnVtLmxlbmd0aDsKCgkJCXRoaXMuY29udGFpbmVyID0gW107CgkJCXRoaXMuZWxlbWVudHMgPSBbXTsKCgkJCWZvcihsZXQgaSA9IHRoaXMubnVtIC0gMTsgaSA+PSAwOyBpLS0pIHsKCQkJCWxldCBlbGVtID0gbmV3IE93bERyYXcuZGxsRWxlbSh7eDogb3B0aW9ucy54ICsgaSooMipvcHRpb25zLnNpemUpLCB5OiBvcHRpb25zLnksIHNpemU6IG9wdGlvbnMuc2l6ZSwgdHh0OiBudW1baV0udG9TdHJpbmcoKSwgY2xhc3M6IChvcHRpb25zLmNsYXNzIHx8ICcnKSArICcgZGxMaXN0JywgdG9wOiAnbCcsIG5leHQ6IChpID09IHRoaXMubnVtIC0gMSA/IG51bGwgOiB0aGlzLmVsZW1lbnRzWzBdLmRhdGEpLCBwcmV2OiBudWxsfSk7CgkJCQlpZihpICE9IHRoaXMubnVtIC0gMSkgdGhpcy5lbGVtZW50c1swXS5wb2ludGVyUHJldi5iaW5kKHt0bzogZWxlbS5kYXRhLCB0b3A6ICdyJ30pOwoKCQkJCWVsZW0udmFsID0gbnVtW2ldOwoJCQkJZWxlbS5uZXh0ID0gaSA9PSB0aGlzLm51bSAtIDEgPyBudWxsIDogdGhpcy5lbGVtZW50c1swXTsKCQkJCWlmKGkgIT0gdGhpcy5udW0gLSAxKSB0aGlzLmVsZW1lbnRzWzBdLnByZXYgPSBlbGVtOwoJCQkJZWxlbS5wcmV2ID0gbnVsbDsKCgkJCQl0aGlzLmVsZW1lbnRzLnVuc2hpZnQoZWxlbSk7CgkJCQl0aGlzLmFkZChlbGVtKTsKCQkJfQoJCX0KCgkJLyoqCgkJICogSGlnaGxpZ2h0ZXMgYW4gZWxlbWVudCwgb3IgYWxsIGVsZW1lbnRzLCBieSBhZGRpbiBhIGNsYXNzIHdpdGggdGhlIG5hbWUgJ2hpZ2hsaWdodC17b3B0fScgdG8gdGhlIGNsYXNzIGxpc3QuIFJlbW92ZXMgYWxsIG90aGVyIGhpZ2hsaWdodGVzIG9uIHRoZSBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfHVuZGVmaW5lZH0gaWQgLSBJZiB1bmRlZmluZWQsIGFsbCBlbGVtZW50cyB3aWxsIGJlIGhpZ2hsaWdodGVkLCBpZCBhIG51bWJlciwgdGhlbiB0aGUgZWxlbWVudCB3aXRoIHRoZSBnaXZlbiBpbmRleCB3aWxsIGJlIGhpZ2hsaWdodGVkCgkJICogQHBhcmFtIHtzdHJpbmd9IG9wdCAtIFRoZSBuYW1lIG9mIGhpZ2hsaWdodCAocGFydCBvZiBjbGFzcyBuYW1lKQoJCSAqLwoJCWhpZ2hsaWdodChpZCwgb3B0KSB7CgkJCWlmKGlkID09IHVuZGVmaW5lZCkgewoJCQkJZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuZWxlbWVudHMubGVuZ3RoOyBpKyspIHsKCQkJCQl0aGlzLmVsZW1lbnRzW2ldLmhpZ2hsaWdodChvcHQpOwoJCQkJfQoJCQl9CgkJCWVsc2UgewoJCQkJdGhpcy5lbGVtZW50c1tpZF0uaGlnaGxpZ2h0KG9wdCk7CgkJCX0KCQl9CgoJCS8qKgoJCSAqIFJlbW92ZXMgYWxsIGhpZ2hsaWdodGVzIGZyb20gYW4gZWxlbWVudCBvciBhbGwgZWxlbWVudHMKCQkgKiBAcGFyYW0ge251bWJlcnx1bmRlZmluZWR9IGlkIC0gSWYgdW5kZWZpbmVkLCBhbGwgZWxlbWVudHMgd2lsbCBiZSB1bmhpZ2hsaWdodGVkLCBpZCBhIG51bWJlciwgdGhlbiB0aGUgZWxlbWVudCB3aXRoIHRoZSBnaXZlbiBpbmRleCB3aWxsIGJlIHVuaGlnaGxpZ2h0ZWQKCQkgKi8KCQl1bmhpZ2hsaWdodChpZCkgewoJCQlpZihpZCA9PSB1bmRlZmluZWQpIHsKCQkJCWZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCQkJdGhpcy5lbGVtZW50c1tpXS51bmhpZ2hsaWdodCgpOwoJCQkJfQoJCQl9CgkJCWVsc2UgewoJCQkJdGhpcy5lbGVtZW50c1tpZF0udW5oaWdobGlnaHQoKTsKCQkJfQoJCX0KCX0KCgkvKioKCSAqIENsYXNzIHRoYXQgcmVwcmVzZW50cyBhbiBlbGVtZW50IG9mIGEgZG91YmxlIGxpbmtlZCBsaXN0CgkgKiBAbWVtYmVyb2YgT3dsRHJhdwoJICogQGV4dGVuZHMgT3dsRHJhdy5ncm91cAoJICoKCSAqIEBwcm9wZXJ0eSB7RWxlbWVudFtdfSBjb250YWluZXIgLSBBcnJheSBvZiBET00gZWxlbWVudHMgKFNWR0VsZW1lbnQpIHRoYXQgYXJlIGFkZGVkIHRvIHRoZSBzdmcgRE9NCgkgKiBAcHJvcGVydHkge093bERyYXcuZWxlbWVudFtdfSBlbGVtcyAtIExpc3Qgb2YgZWxlbWVudHMgaW4gdGhlIGdyb3VwCgkgKiBAcHJvcGVydHkge093bERyYXcucmVjdH0gZGF0YSAtIFRoZSByZWN0YW5nbGUgcmVwcmVzZW50aW5nIHRoZSBkYXRhIHBhcnQgb2YgdGhlIGVsZW1lbnQgZWxlbWVudAoJICogQHByb3BlcnR5IHtPd2xEcmF3LnBvaW50ZXJ9IHBvaW50ZXJMZWZ0IC0gVGhlIHBvaW50ZXIgcmVwcmVzZW50aW5nIHRoZSBwb2ludGVyIHRvIHRoZSBsZWZ0IGVsZW1lbnQKCSAqIEBwcm9wZXJ0eSB7T3dsRHJhdy5wb2ludGVyfSBwb2ludGVyUmlnaHQgLSBUaGUgcG9pbnRlciByZXByZXNlbnRpbmcgdGhlIHBvaW50ZXIgdG8gdGhlIHJpZ2h0IGVsZW1lbnQKCSAqLwoJT3dsRHJhdy5idEVsZW0gPSBjbGFzcyBleHRlbmRzIE93bERyYXcuZ3JvdXAgewoJCS8qKgoJCSAqIENyZWF0ZXMgYW4gZWxlbWVudCBvZiBhIGRvdWJsZSBsaW5rZWQgbGlzdAoJCSAqCgkJICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBPcHRpb25zCgkJICogQHBhcmFtIHtudW1iZXJ9IG9wdGlvbnMueCAtIFRoZSB0b3AtbGVmdCB4LWNvb3JkaW5hdGUgb2YgdGhlIGxpc3QgZWxlbWVudAoJCSAqIEBwYXJhbSB7bnVtYmVyfSBvcHRpb25zLnkgLSBUaGUgdG9wLWxlZnQgeS1jb29yZGluYXRlIG9mIHRoZSBsaXN0IGVsZW1lbnQKCQkgKiBAcGFyYW0ge251bWJlcn0gb3B0aW9ucy5zaXplIC0gVGhlIHdpZHRoIG9mIHRoZSBlbGVtZW50LiBUaGUgaGVpZ2h0IG9mIHRoZSBkYXRhIGFyZWEgbWF0Y2hlcyB0aGlzIHZhbHVlLCB3aGlsZSB0aGUgaGVpZ2h0IG9mIHRoZSBwb2ludGVycyBpcyB0aGUgdGhpcmQgb2YgdGhpcyB2YWx1ZS4KCQkgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMuY2xhc3NdIC0gbGlzdCBvZiBjbGFzcyB0aGF0IHdpbGwgYmUgYWRkZWQgdG8gdGhlIERPTSBlbGVtZW50CgkJICogQHBhcmFtIHtPd2xEcmF3LmNvbm5lY3RhYmxlfG51bGx9IFtvcHRpb25zLmxlZnRdIC0gVGhlIGVsZW1lbnQsIHRoZSBsZWZ0IGFycm93IHdpbGwgYmUgZHJhd24gdG8uCgkJICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLnRvcExdIC0gVGhlIHBvc2l0aW9uLCB0aGUgbGVmdCBhcnJvdyB3aWxsIGJlIGRyYXduIHRvICgnbCcgLSBsZWZ0IHNpZGUsICdyJyAtIHJpZ2h0IHNpZGUsICd1JyAtIHVwIHNpZGUsICdkJyAtIGRvd24gc2lkZSkKCQkgKiBAcGFyYW0ge093bERyYXcuY29ubmVjdGFibGV8bnVsbH0gW29wdGlvbnMucmlnaHRdIC0gVGhlIGVsZW1lbnQsIHRoZSByaWdodCBhcnJvdyB3aWxsIGJlIGRyYXduIHRvLgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy50b3BSXSAtIFRoZSBwb3NpdGlvbiwgdGhlIHJpZ2h0IGFycm93IHdpbGwgYmUgZHJhd24gdG8gKCdsJyAtIGxlZnQgc2lkZSwgJ3InIC0gcmlnaHQgc2lkZSwgJ3UnIC0gdXAgc2lkZSwgJ2QnIC0gZG93biBzaWRlKQoJCSAqLwoJCWNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKCQkJc3VwZXIoKTsKCgkJCXRoaXMuY29udGFpbmVyID0gW107CgoJCQl0aGlzLmRhdGEgPSBuZXcgT3dsRHJhdy5yZWN0KHt4OiBvcHRpb25zLngsIHk6IG9wdGlvbnMueSwgd2lkdGg6IG9wdGlvbnMuc2l6ZSwgaGVpZ2h0OiBvcHRpb25zLnNpemUsIHR4dDogb3B0aW9ucy50eHQsIGNsYXNzOiAob3B0aW9ucy5jbGFzcyB8fCAnJykgKyAnIGJ0RWxlbSd9KTsKCQkJdGhpcy5wb2ludGVyTGVmdCA9IG5ldyBPd2xEcmF3LnBvaW50ZXIoe3g6IG9wdGlvbnMueCwgeTogb3B0aW9ucy55ICsgb3B0aW9ucy5zaXplLCB3aWR0aDogb3B0aW9ucy5zaXplLzIsIGhlaWdodDogb3B0aW9ucy5zaXplLzMsIGZyb21wOiAnbCcsIHRvOiBvcHRpb25zLmxlZnQgfHwgbnVsbCwgdG9wOiBvcHRpb25zLnRvcEwsIGFycm93OiAnbmljZScsIGNsYXNzOiAob3B0aW9ucy5jbGFzcyB8fCAnJykgKyAnIGJ0RWxlbSd9KTsKCQkJdGhpcy5wb2ludGVyUmlnaHQgPSBuZXcgT3dsRHJhdy5wb2ludGVyKHt4OiBvcHRpb25zLnggKyBvcHRpb25zLnNpemUvMiwgeTogb3B0aW9ucy55ICsgb3B0aW9ucy5zaXplLCB3aWR0aDogb3B0aW9ucy5zaXplLzIsIGhlaWdodDogb3B0aW9ucy5zaXplLzMsIGZyb21wOiAncicsIHRvOiBvcHRpb25zLnJpZ2h0IHx8IG51bGwsIHRvcDogb3B0aW9ucy50b3BSLCBhcnJvdzogJ25pY2UnLCBjbGFzczogKG9wdGlvbnMuY2xhc3MgfHwgJycpICsgJyBidEVsZW0nfSk7CgoJCQl0aGlzLmFkZCh0aGlzLmRhdGEpOwoJCQl0aGlzLmFkZCh0aGlzLnBvaW50ZXJMZWZ0KTsKCQkJdGhpcy5hZGQodGhpcy5wb2ludGVyUmlnaHQpOwoJCX0KCX0KCgkvKioKCSAqIENsYXNzIHRoYXQgcmVwcmVzZW50cyBhIGJpbmFyeSB0cmVlCgkgKiBAbWVtYmVyb2YgT3dsRHJhdwoJICogQGV4dGVuZHMgT3dsRHJhdy5ncm91cAoJICoKCSAqIEBwcm9wZXJ0eSB7RWxlbWVudFtdfSBjb250YWluZXIgLSBBcnJheSBvZiBET00gZWxlbWVudHMgKFNWR0VsZW1lbnQpIHRoYXQgYXJlIGFkZGVkIHRvIHRoZSBzdmcgRE9NCgkgKiBAcHJvcGVydHkge093bERyYXcuZWxlbWVudFtdfSBlbGVtcyAtIExpc3Qgb2YgZWxlbWVudHMgaW4gdGhlIGdyb3VwCgkgKiBAcHJvcGVydHkge093bERyYXcuYnRFbGVtfSBlbGVtZW50cyAtIFRoZSBiaW5hcnkgdHJlZSBvZiBlbGVtZW50cy4gUmVmZXJlbmNlIHRvIHRoZSByb290LgoJICogQHByb3BlcnR5IHtudW1iZXJ9IGVsZW1lbnRzLnZhbCAtIFRoZSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZWxlbWVudAoJICogQHByb3BlcnR5IHtPd2xEcmF3LmJ0RWxlbXxudWxsfSBlbGVtZW50cy5sZWZ0IC0gUmVmZXJlbmNlIHRvIHRoZSBsZWZ0IGVsZW1lbnQgaW4gdGhlIHRyZWUKCSAqIEBwcm9wZXJ0eSB7T3dsRHJhdy5saW5lfG51bGx9IFtlbGVtZW50cy5sZWZ0UG9pbnRlcl0gLSBUaGUgbGluZSBvciBhcnJvdywgdGhlIGxlZnQtY2hpbGQgb2YgZWxlbWVudCBpcyBjb25uZWN0ZWQgd2l0aCAodmFsaWQgaWYgZWxlbWVudHMgYXJlIGJhc2VkIG9uIHtAbGluayBPd2xEcmF3LmNpcmNsZX0pCgkgKiBAcHJvcGVydHkge093bERyYXcuYnRFbGVtfG51bGx9IGVsZW1lbnRzLnJpZ2h0IC0gUmVmZXJlbmNlIHRvIHRoZSByaWdodCBlbGVtZW50IGluIHRoZSBsaXN0CgkgKiBAcHJvcGVydHkge093bERyYXcubGluZXxudWxsfSBbZWxlbWVudHMucmlnaHRQb2ludGVyXSAtIFRoZSBsaW5lIG9yIGFycm93LCB0aGUgcmlnaHQtY2hpbGQgb2YgZWxlbWVudCBpcyBjb25uZWN0ZWQgd2l0aCAodmFsaWQgaWYgZWxlbWVudHMgYXJlIGJhc2VkIG9uIHtAbGluayBPd2xEcmF3LmNpcmNsZX0pCgkgKi8KCU93bERyYXcuYlRyZWUgPSBjbGFzcyBleHRlbmRzIE93bERyYXcuZ3JvdXAgewoJCS8qKgoJCSAqIENyZWF0ZXMgYSBiaW5hcnkgdHJlZSB3aXRoIHZhbHVlcwoJCSAqCgkJICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBPcHRpb25zCgkJICogQHBhcmFtIHtzdHJpbmd9IG9wdGlvbnMudHJlZSAtIElmICduaWNlJyB0aGVuIHRoZSB0cmVlIHdpbGwgYmUgY29uc2lzdGVkIG9mIHtAbGluayBPd2xEcmF3LmJ0RWxlbX0sIG90aGVyd2lzZSBvZiB7QGxpbmsgT3dsRHJhdy5jaXJjbGV9CgkJICogQHBhcmFtIHtudW1iZXJ9IG9wdGlvbnMud2lkdGggLSBUaGUgd2lkdGggb2YgdGhlIHJlY3RhbmdsZSwgdGhlIGJpbmFyeSB0cmVlIHdpbGwgYmUgZml0IGludG8KCQkgKiBAcGFyYW0ge251bWJlcn0gb3B0aW9ucy55IC0gdGhlIHktY29vcmRpbmF0ZSBvZiB0aGUgcm9vdCBlbGVtZW50CgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLnJhZGl1c10gLSBUaGUgcmFkaXVzIG9mIGVsZW1lbnRzIGlmIHRoZSB0cmVlIGlzIGNvbnNpc3RlZCBvZiB7QGxpbmsgT3dsRHJhdy5jaXJjbGV9LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5zaXplXSAtIFRoZSB3aWR0aCBvZiB0aGUgZWxlbWVudCBpZiB0aGUgdHJlZSBpcyBjb25zaXN0ZWQgb2Yge0BsaW5rIE93bERyYXcuYnRFbGVtfS4gVGhlIGhlaWdodCBvZiB0aGUgZGF0YSBhcmVhIG1hdGNoZXMgdGhpcyB2YWx1ZSwgd2hpbGUgdGhlIGhlaWdodCBvZiB0aGUgcG9pbnRlciBpcyB0aGUgdGhpcmQgb2YgdGhpcyB2YWx1ZS4KCQkgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMuY2xhc3NdIC0gbGlzdCBvZiBjbGFzcyB0aGF0IHdpbGwgYmUgYWRkZWQgdG8gdGhlIERPTSBlbGVtZW50CgkJICogQHBhcmFtIHtzdHJpbmd9IG9wdGlvbnMudHlwZSAtIElmICdwYXJhbScsIHRoZSBlbGVtZW50cyB3aWxsIGJlIHRha2VuIGZyb20gdGhlIHNlY29uZCBwYXJhbWV0ZXIuIElmICdzdWNjZWVkaW5nJywgdGhlIGVsZW1lbnRzIHdpbGwgYmUgc3VjY2VlZGluZyBlbGVtZW50cyAoZS5nLiAxLCAyLCAzLCA0LCAuLi4pLiBJZiAncmFuZG9tJywgdGhlIGVsZW1lbnRzIHdpbGwgYmUgcmFuZG9tbHkgZ2VuZXJhdGVkLiBJZiAnZW1wdHknLCB0aGUgZWxlbWVudHMgd2lsbCBiZSBhbGwgZW1wdHkuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLm51bV0gLSBOdW1iZXIgb2YgZWxlbWVudHMgdG8gY3JlYXRlCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLm1pbl0gLSBNaW5pbXVtIG9mIG51bWJlcnMKCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMubWF4XSAtIE1heGltdW0gb2YgbnVtYmVycwoJCSAqIEBwYXJhbSB7c3RyaW5nfEZ1bmN0aW9ufSBbb3B0aW9ucy5zb3J0XSAtIElmICdzaHVmZmxlJywgdGhlIGVsZW1lbnRzIHdpbGwgYmUgcmFuZG9tbHkgc2h1ZmZsZWQgKHNlZSB7QGxpbmsgc2h1ZmZsZX0pLiBJZiAnc29ydGVkJywgdGhlIGVsZW1lbnRzIHdpbGwgYmUgc29ydGVkIGFzY2VuZGluZ2x5LiBJZiBhIGZ1bmN0aW9uICgoYSxiKT0+dHJ1ZXxmYWxzZSksIHRoZSBlbGVtZW50cyB3aWxsIGJlIHNvcnRlZCBhY2NvcmRpbmcgdG8gdGhlIGZ1bmN0aW9uLgoJCSAqIEBwYXJhbSB7bnVtYmVyW118T2JqZWN0fSBbZWxlbWVudHNdIC0gRWxlbWVudHMgdG8gYmUgYSBiYXNlCgkJICogQHBhcmFtIHtudW1iZXJ9IGVsZW1lbnRzLnZhbCAtIFRoZSB2YWx1ZSBvZiBsZWFmCgkJICogQHBhcmFtIHtPYmplY3R8bnVsbH0gZWxlbWVudHMubGVmdCAtIFRoZSBsZWZ0LXNpZGUgdHJlZSwgd2l0aCBzYW1lIHN0cnVjdHVyZSBhcyBlbGVtZW50cy4gSWYgbnVsbCwgdGhlbiBubyBjaGlsZC4KCQkgKiBAcGFyYW0ge09iamVjdHxudWxsfSBlbGVtZW50cy5yaWdodCAtIFRoZSByaWdodC1zaWRlIHRyZWUsIHdpdGggc2FtZSBzdHJ1Y3R1cmUgYXMgZWxlbWVudHMuIElmIG51bGwsIHRoZW4gbm8gY2hpbGQuCgkJICoKCQkgKi8KCQljb25zdHJ1Y3RvcihvcHRpb25zLCBlbGVtZW50cykgewoJCQlzdXBlcigpOwoKCQkJdGhpcy5jb250YWluZXIgPSBbXTsKCQkJdGhpcy5lbGVtZW50cyA9IFtdOwoKCQkJaWYoZWxlbWVudHMgPT0gdW5kZWZpbmVkIHx8IGVsZW1lbnRzIGluc3RhbmNlb2YgQXJyYXkpIHsKCQkJCWxldCBudW0gPSBnZW5lcmF0ZU51bXMob3B0aW9ucywgZWxlbWVudHMpOwoJCQkJZWxlbWVudHMgPSBhcnJheVRvVHJlZShudW0sIDAsIG51bS5sZW5ndGgpOwoJCQl9CgoJCQl0aGlzLmVsZW1lbnRzID0gdGhpcy5idWlsZFRyZWUoZWxlbWVudHMsIDAsIDAsIG9wdGlvbnMpOwoJCX0KCgkJLyoqCgkJICogQnVpbGRzIGEgbGVhZgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJbXXxPYmplY3R9IGVsZW1lbnRzIC0gQmluYXJ5IHRyZWUKCQkgKiBAcGFyYW0ge251bWJlcn0gZWxlbWVudHMudmFsIC0gVGhlIHZhbHVlIG9mIGxlYWYKCQkgKiBAcGFyYW0ge09iamVjdHxudWxsfSBlbGVtZW50cy5sZWZ0IC0gVGhlIGxlZnQtc2lkZSB0cmVlLCB3aXRoIHNhbWUgc3RydWN0dXJlIGFzIGVsZW1lbnRzLiBJZiBudWxsLCB0aGVuIG5vIGNoaWxkLgoJCSAqIEBwYXJhbSB7T2JqZWN0fG51bGx9IGVsZW1lbnRzLnJpZ2h0IC0gVGhlIHJpZ2h0LXNpZGUgdHJlZSwgd2l0aCBzYW1lIHN0cnVjdHVyZSBhcyBlbGVtZW50cy4gSWYgbnVsbCwgdGhlbiBubyBjaGlsZC4KCQkgKiBAcGFyYW0ge251bWJlcn0gbGV2ZWwgLSBUaGUgbGV2ZWwgb2YgdGhlIGxlYWYKCQkgKiBAcGFyYW0ge251bWJlcn0gcG9zaXRpb24gLSBUaGUgcG9zaXRpb24gb2YgdGhlIGxlYWYgaW5zaWRlIG9mIHRoZSBsZXZlbAoJCSAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gT3B0aW9ucwoJCSAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnRyZWUgLSBJZiAnbmljZScgdGhlbiB0aGUgdHJlZSB3aWxsIGJlIGNvbnNpc3RlZCBvZiB7QGxpbmsgT3dsRHJhdy5idEVsZW19LCBvdGhlcndpc2Ugb2Yge0BsaW5rIE93bERyYXcuY2lyY2xlfQoJCSAqIEBwYXJhbSB7bnVtYmVyfSBvcHRpb25zLndpZHRoIC0gVGhlIHdpZHRoIG9mIHRoZSByZWN0YW5nbGUsIHRoZSBiaW5hcnkgdHJlZSB3aWxsIGJlIGZpdCBpbnRvCgkJICogQHBhcmFtIHtudW1iZXJ9IG9wdGlvbnMueSAtIHRoZSB5LWNvb3JkaW5hdGUgb2YgdGhlIHJvb3QgZWxlbWVudAoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5yYWRpdXNdIC0gVGhlIHJhZGl1cyBvZiBlbGVtZW50cyBpZiB0aGUgdHJlZSBpcyBjb25zaXN0ZWQgb2Yge0BsaW5rIE93bERyYXcuY2lyY2xlfS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMuc2l6ZV0gLSBUaGUgd2lkdGggb2YgdGhlIGVsZW1lbnQgaWYgdGhlIHRyZWUgaXMgY29uc2lzdGVkIG9mIHtAbGluayBPd2xEcmF3LmJ0RWxlbX0uIFRoZSBoZWlnaHQgb2YgdGhlIGRhdGEgYXJlYSBtYXRjaGVzIHRoaXMgdmFsdWUsIHdoaWxlIHRoZSBoZWlnaHQgb2YgdGhlIHBvaW50ZXIgaXMgdGhlIHRoaXJkIG9mIHRoaXMgdmFsdWUuCgkJICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLmNsYXNzXSAtIGxpc3Qgb2YgY2xhc3MgdGhhdCB3aWxsIGJlIGFkZGVkIHRvIHRoZSBET00gZWxlbWVudAoJCSAqCgkJICovCgkJYnVpbGRUcmVlKGVsZW1lbnQsIGxldmVsLCBwb3NpdGlvbiwgb3B0aW9ucykgewoJCQlpZihlbGVtZW50ID09IG51bGwpIHJldHVybiBudWxsOwoKCQkJbGV0IGxlZnQgPSB0aGlzLmJ1aWxkVHJlZShlbGVtZW50LmxlZnQsIGxldmVsKzEsIDIqcG9zaXRpb24sIG9wdGlvbnMpOwoJCQlsZXQgcmlnaHQgPSB0aGlzLmJ1aWxkVHJlZShlbGVtZW50LnJpZ2h0LCBsZXZlbCsxLCAyKnBvc2l0aW9uKzEsIG9wdGlvbnMpOwoKCQkJaWYob3B0aW9ucy50cmVlID09ICduaWNlJykgewoJCQkJbGV0IGUgPSBuZXcgT3dsRHJhdy5idEVsZW0oe3g6IChvcHRpb25zLndpZHRoIC8gKE1hdGgucG93KDIsIGxldmVsKSsxKSkgKiAocG9zaXRpb24rMSkgLSBvcHRpb25zLnNpemUvMiwgeTogb3B0aW9ucy55ICsgbGV2ZWwqMipvcHRpb25zLnNpemUsIHNpemU6IG9wdGlvbnMuc2l6ZSwgbGVmdDogKGxlZnQ/bGVmdC5kYXRhOm51bGwpLCB0b3BMOiAndScsIHJpZ2h0OiAocmlnaHQ/cmlnaHQuZGF0YTpudWxsKSwgdG9wUjogJ3UnLCB0eHQ6IGVsZW1lbnQudmFsLCBjbGFzczogKG9wdGlvbnMuY2xhc3MgfHwgJycpICsgJyBiVHJlZSd9KTsKCQkJCWUudmFsID0gZWxlbWVudC52YWw7CgkJCQllLmxlZnQgPSBsZWZ0OwoJCQkJZS5yaWdodCA9IHJpZ2h0OwoKCQkJCXRoaXMuYWRkKGUpOwoKCQkJCXJldHVybiBlOwoJCQl9CgkJCWVsc2UgewoJCQkJbGV0IGUgPSBuZXcgT3dsRHJhdy5jaXJjbGUoe3g6IChvcHRpb25zLndpZHRoIC8gKE1hdGgucG93KDIsIGxldmVsKSsxKSkgKiAocG9zaXRpb24rMSksIHk6IG9wdGlvbnMueSArIGxldmVsKjQqb3B0aW9ucy5yYWRpdXMsIHJhZGl1czogb3B0aW9ucy5yYWRpdXMsIHR4dDogZWxlbWVudC52YWwsIGNsYXNzOiAob3B0aW9ucy5jbGFzcyB8fCAnJykgKyAnIGJUcmVlJ30pOwoJCQkJZS52YWwgPSBlbGVtZW50LnZhbDsKCQkJCWUubGVmdCA9IGxlZnQ7CgkJCQllLnJpZ2h0ID0gcmlnaHQ7CgoJCQkJdGhpcy5hZGQoZSk7CgoJCQkJaWYobGVmdCAhPSBudWxsKSB7CgkJCQkJbGV0IHAgPSBuZXcgT3dsRHJhdy5hcnJvdyh7ZnJvbTogZSwgZnJvbXA6ICdkJywgdG86IGxlZnQsIHRvcDogJ3UnfSk7CgkJCQkJZS5sZWZ0UG9pbnRlciA9IHA7CgoJCQkJCXRoaXMuYWRkKHApOwoJCQkJfQoKCQkJCWlmKHJpZ2h0ICE9IG51bGwpIHsKCQkJCQlsZXQgcCA9IG5ldyBPd2xEcmF3LmFycm93KHtmcm9tOiBlLCBmcm9tcDogJ2QnLCB0bzogcmlnaHQsIHRvcDogJ3UnfSk7CgkJCQkJZS5yaWdodFBvaW50ZXIgPSBwOwoKCQkJCQl0aGlzLmFkZChwKTsKCQkJCX0KCgkJCQlyZXR1cm4gZTsKCQkJfQoJCX0KCX0KCglyZXR1cm4gT3dsRHJhdzsKfSkoKTsKCgoKLyouL3N5bnRheC5qcyovCgp2YXIgT3dsU3ludGF4ID0gKGZ1bmN0aW9uKCkgewoJJ3VzZSBzdHJpY3QnOwoKCS8qKgoJICogQ2xhc3MgcmVzcG9zaWJsZSBmb3Igc3ludGF4IGhpZ2hsaWdodGluZwoJICoKCSAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBvcHRpb25zIC0gU2V0dGluZ3MKCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBvcHRpb25zLmlkIC0gVGhlIGlkIG9mIERPTSBlbGVtZW50LCB0aGUgY29kZSBpcyBpbgoJICogQHByb3BlcnR5IHtPd2xTeW50YXgubGFuZ3VhZ2V9IFtvcHRpb25zLmxhbmd1YWdlXSAtIEdyYW1tYXIgaW4gdXNlCgkgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtvcHRpb25zLmh0bWxdIC0gSWYgZmFsc2UsIHRoZSBjb2RlIHdpbGwgbm90IGJlIHBhcnNlZCwgb3IgaGlnaGxpZ2h0ZWQsIGl0IHdpbGwgYmUgdGhlIHJlc3Bvc2liaWxpdHkgb2YgdXNlcgoJICogQHByb3BlcnR5IHtFbGVtZW50fSBzb3VyY2UgLSBUaGUgRE9NIGVsZW1lbnQsIHRoZSBzb3VyY2UgY29kZSBpcyBpbi4KCSAqIEBwcm9wZXJ0eSB7RWxlbWVudH0gY29udGFpbmVyIC0gVGhlIERPTSBlbGVtZW50LCB0aGUgaGlnaGxpZ2h0ZWQgY29kZSBpcyBpbi4gVmFsaWQgYWZ0ZXIge0BsaW5rIE93bFN5bnRheCNyZW5kZXJ9IGhhcyBydW4KCSAqLwoJY2xhc3MgT3dsU3ludGF4IHsKCQkvKioKCQkgKiBDcmVhdGVzIHRoZSBoaWdobGlnaHQKCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBpZCAtIFRoZSBpZCBvZiBET00gZWxlbWVudCwgdGhlIGNvZGUgaXMgaW4KCQkgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIFNldHRpbmdzCgkJICogQHBhcmFtIHtzdHJpbmd8T3dsU3ludGF4Lmxhbmd1YWdlfSBbb3B0aW9ucy5sYW5ndWFnZV0gLSBJZiBzdHJpbmcsIHRoZW4gbmFtZSBvZiBncmFtbWFyIChPd2xTeW50YXhbe25hbWV9XSkuIElmIG9iamVjdCwgdGhlbiBpdCBtdXN0IGJlIGNvbXBhdGlibGUgd2l0aCB7QGxpbmsgT3dsU3ludGF4Lmxhbmd1YWdlfS4gSWYgdW5kZWZpbmVkIGJ1dCB0aGUgZGF0YS1sYW5ndWFnZSBwcm9wZXJ0eSBpcyBzZXQgb24gdGhlIHNvdXJjZSBlbGVtZW50LCB0aGVuIHRoZSBsYW5ndWFnZSB3aWxsIGJlIHRha2VuIGZyb20gdGhhdCBwcm9wZXJ0eS4KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLmh0bWxdIC0gSWYgZmFsc2UsIHRoZSBjb2RlIHdpbGwgbm90IGJlIHBhcnNlZCwgb3IgaGlnaGxpZ2h0ZWQsIGl0IHdpbGwgYmUgdGhlIHJlc3Bvc2liaWxpdHkgb2YgdXNlcgoJCSAqLwoJCWNvbnN0cnVjdG9yKGlkLCBvcHRpb25zKSB7CgkJCWlmKG9wdGlvbnMgPT0gdW5kZWZpbmVkKSBvcHRpb25zID0ge307CgkJCXRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CgoJCQl0aGlzLnNvdXJjZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKCQkJdGhpcy5zb3VyY2UuaWQgPSAnJzsKCQkJdGhpcy5vcHRpb25zLmlkID0gaWQ7CgoJCQlpZih0eXBlb2Ygb3B0aW9ucy5sYW5ndWFnZSA9PSAnc3RyaW5nJykgdGhpcy5sYW5ndWFnZSA9IG5ldyBPd2xTeW50YXhbb3B0aW9ucy5sYW5ndWFnZV0oKTsKCQkJZWxzZSBpZih0eXBlb2Ygb3B0aW9ucy5sYW5ndWFnZSA9PSAnb2JqZWN0JykgdGhpcy5sYW5ndWFnZSA9IG9wdGlvbnMubGFuZ3VhZ2U7CgkJCWVsc2UgaWYob3B0aW9ucy5sYW5ndWFnZSA9PSB1bmRlZmluZWQgJiYgdGhpcy5zb3VyY2UuZGF0YXNldFsnbGFuZ3VhZ2UnXSAhPSB1bmRlZmluZWQpIHRoaXMubGFuZ3VhZ2UgPSBuZXcgT3dsU3ludGF4W3RoaXMuc291cmNlLmRhdGFzZXRbJ2xhbmd1YWdlJ11dKCk7CgkJCWVsc2UgdGhyb3cgbmV3IEVycm9yKCdPd2xTeW50YXg6IExhbmd1YWdlIG5vdCBwcm92aWRlZCcpOwoKCQkJaWYob3B0aW9ucy5odG1sICE9IHRydWUpIHsKCQkJCXRoaXMucmVuZGVyKHRoaXMuaGlnaGxpZ2h0KCkpOwoJCQl9CgkJfQoKCQkvKioKCQkgKiBSZW5kZXJzIHRoZSBnaXZlbiBodG1sIHRvIGRvbSwgaW4gcGxhY2Ugb2Ygc291cmNlIGVsZW1lbnQuCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ30gaHRtbCAtIFRoZSBodG1sIHRvIGJlIHJlbmRlcmVkLgoJCSAqLwoJCXJlbmRlcihodG1sKSB7CgkJCXRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJCXRoaXMuY29udGFpbmVyLmlubmVySFRNTCA9IGh0bWw7CgkJCXRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZ2hsaWdodGVyJyk7CgkJCXRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2NvbnRhaW5lcicpOwoJCQl0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdkZWZhdWx0Jyk7CgkJCXRoaXMuY29udGFpbmVyLmlkID0gdGhpcy5vcHRpb25zLmlkOwoJCQl0aGlzLmxhbmd1YWdlLmNvbnRhaW5lcih0aGlzLmNvbnRhaW5lcik7CgkJCXRoaXMuc291cmNlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMuY29udGFpbmVyLCB0aGlzLnNvdXJjZSk7CgkJfQoKCQkvKioKCQkgKiBIaWdobGlnaHRlcyB0aGUgdGV4dCBpbiBzb3VyY2UgZWxlbWVudCBhY2NvcmRpbmcgdG8gdGhlIHNlbGVjdGVkIGdyYW1tYXIKCQkgKgoJCSAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBodG1sLCBjb250YWluaW5nIHRoZSB0YWdzIGZvciBoaWdobGlnaHRpbmcuCgkJICovCgkJaGlnaGxpZ2h0KCkgewoJCQlsZXQgdHh0ID0gdGhpcy5zb3VyY2UuaW5uZXJUZXh0LnNwbGl0KCdcbicpOwoJCQl0eHQgPSB0aGlzLnByZXByb2Nlc3ModHh0KTsKCgkJCWZvcihsZXQgaSA9IDA7IGkgPCB0eHQubGVuZ3RoOyBpKyspIHsKCQkJCWZvcihsZXQgaGFuZGxlciBpbiB0aGlzLmxhbmd1YWdlLmhhbmRsZXJzKSB7CgkJCQkJdHh0W2ldID0gdGhpcy5sYW5ndWFnZS5oYW5kbGUoaGFuZGxlciwgdHh0W2ldKTsKCQkJCX0KCQkJfQoKCQkJdHh0ID0gdGhpcy5wb3N0cHJvY2Vzcyh0eHQpOwoJCQlyZXR1cm4gdHh0LmpvaW4oJ1xuJyk7CgkJfQoKCQkvKioKCQkgKiBQcmVwcm9jZXNzZXMgdGhlIHRleHQuIFNwbGl0cyBpdCB0byBsaW5lcywgcmVtb3ZlcyBlbXB0eSBsaW5lcyBmcm9tIHRoZSBiZWdpbm5pbmcsIGFsaWduZXMgaW5kZW50cywgZXNjYXBlcyA8IGFuZCA+LiBDYWxscyB0aGUgcHJlcHJvY2VzcyBmdW5jdGlvbiBvZiBncmFtbWFyIChzZWUge0BsaW5rIE93bFN5bnRheC5sYW5ndWFnZSNwcmVwcm9jZXNzfSkKCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSB0eHQgLSBUaGUgc291cmNlIGNvZGUgYXMgcGxhaW4gdGV4dAoJCSAqCgkJICogQHJldHVybiB7c3RyaW5nW119IFRoZSBzb3VyY2UgY29kZSBzcGxpdCB0byBsaW5lcywgdm9pZCBvZiBlbXB0eSBsaW5lcywgYW5kIGluZGVudHMgYXJlIGNvcnJlY3RlZCwgPCBhbmQgPiBhcmUgZXNjYXBlZAoJCSAqLwoJCXByZXByb2Nlc3ModHh0KSB7CgkJCXdoaWxlKHR4dFswXSA9PSAnJykgdHh0LnNoaWZ0KCk7CgoJCQlsZXQgY2hhck51bSA9IDA7CgkJCWZvcihsZXQgaSA9IDA7IHR4dFswXVtpXSA9PSAnICcgfHwgdHh0WzBdW2ldID09ICdcdCc7IGkrKykgewoJCQkJY2hhck51bSsrOwoJCQl9CgoJCQlmb3IobGV0IGkgPSAwOyBpIDwgdHh0Lmxlbmd0aDsgaSsrKSB7CgkJCQl0eHRbaV0gPSB0eHRbaV0uc3Vic3RyaW5nKGNoYXJOdW0pOwoJCQl9CgoJCQlmb3IobGV0IGkgPSAwOyBpIDwgdHh0Lmxlbmd0aDsgaSsrKSB7CgkJCQl0eHRbaV0gPSB0aGlzLmxhbmd1YWdlLnByZXByb2Nlc3ModHh0W2ldKTsKCQkJCXR4dFtpXSA9IHR4dFtpXS5yZXBsYWNlKC9cPC9nLCAnJmx0OycpOwoJCQkJdHh0W2ldLnJlcGxhY2UoL1w+L2csICcmZ3Q7Jyk7CgkJCX0KCgkJCXJldHVybiB0eHQ7CgkJfQoKCQkvKioKCQkgKiBQb3N0IHByb2Nlc3NlcyB0aGUgbGluZXMgYnkgd3JhcHBpbmcgdGhlbSBpbiBhIDxzcGFuPiBlbGVtZW50IGFuZCBleGVjdXRpbmcgdGhlIGdyYW1tYXJzIHBvc3Rwcm9jZXNzIGZ1bmN0aW9uIChzZWUge0BsaW5rIE93bFN5bnRheC5sYW5ndWFnZSNwb3N0cHJvY2Vzc30pCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ1tdfSB0eHQgLSBUaGUgaGlnaGxpZ2h0ZWQgc291cmNlIGNvZGUgaW4gbGluZXMKCQkgKgoJCSAqIEByZXR1cm5zIHtzdHJpbmdbXX0gVGhlIHBvc3Rwcm9jZXNzZWQgc291cmNlIGNvZGUgaW4gbGluZXMKCQkgKi8KCQlwb3N0cHJvY2Vzcyh0eHQpIHsKCQkJZm9yKGxldCBpID0gMDsgaSA8IHR4dC5sZW5ndGg7IGkrKykgewoJCQkJdHh0W2ldID0gJzxzcGFuIGNsYXNzPSJsaW5lIj4nICsgdHh0W2ldICsgJzwvc3Bhbj4nOwoJCQkJdHh0W2ldID0gdGhpcy5sYW5ndWFnZS5wb3N0cHJvY2Vzcyh0eHRbaV0pOwoJCQl9CgkJCXJldHVybiB0eHQ7CgkJfQoKCQkvKioKCQkgKiBNYXJrcyBhIGxpbmUgKGFuZCBzZWdtZW50KSB0byBiZSBhY3RpdmUuIFRoZSBjc3MgY2xhc3MgYWN0aXZlIGlzIGFwcGVuZGVkIHRvIHRoZSBjbGFzcyBsaXN0LiBSZW1vdmVzIHByZXZpb3VzbHkgYWN0aXZhdGVkIGxpbmVzLCBzZWdtZW50cy4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfG51bWJlcltdfSBsaW5lIC0gVGhlIGluZGV4IG9mIGxpbmUgdG8gYmUgbWFrZSBpdCBhY3RpdmUgKDEsIDIsIDMsIC4uLikuIElmIGFuIGFycmF5LCB0aGVuIGFsbCBvZiB0aGUgbGluZXMgd2lsbCBiZSBtYWRlIGFjdGl2ZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW3NlZ21lbnRdIC0gVGhlIGluZGV4IG9mIHNlZ21lbnQgaW5zaWRlIG9mIGFjdGl2ZSBsaW5lIHRvIG1ha2UgaXQgYWN0aXZlICgxLCAyLCAzLCAuLi4pCgkJICovCgkJbWFyayhsaW5lLCBzZWdtZW50KSB7CgkJCXRoaXMudW5tYXJrKCk7CgkJCWlmKHR5cGVvZiBsaW5lID09ICdudW1iZXInKSB7CgkJCQl0aGlzLmxpbmUgPSB0aGlzLmNvbnRhaW5lci5jaGlsZHJlbltsaW5lIC0gMV07CgkJCQl0aGlzLmxpbmUuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CgkJCQlpZihzZWdtZW50ICE9IHVuZGVmaW5lZCkgewoJCQkJCXRoaXMuc2VnbWVudCA9IHRoaXMubGluZS5xdWVyeVNlbGVjdG9yQWxsKCcuc2VnbWVudCcpW3NlZ21lbnQgLSAxXTsKCQkJCQl0aGlzLnNlZ21lbnQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CgkJCQl9CgkJCX0KCQkJZWxzZSBpZihsaW5lIGluc3RhbmNlb2YgQXJyYXkpIHsKCQkJCXRoaXMubGluZSA9IFtdOwoJCQkJZm9yKGxldCBpID0gMDsgaSA8IGxpbmUubGVuZ3RoOyBpKyspIHsKCQkJCQl0aGlzLmNvbnRhaW5lci5jaGlsZHJlbltsaW5lW2ldIC0gMV0uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CgkJCQkJdGhpcy5saW5lLnB1c2godGhpcy5jb250YWluZXIuY2hpbGRyZW5bbGluZVtpXSAtIDFdKTsKCQkJCX0KCQkJfQoJCX0KCgkJLyoqCgkJICogUmVtb3ZlcyBwcmV2aW91c2x5IGFjdGl2YXRlZCBsaW5lcywgc2VnbWVudHMuCgkJICovCgkJdW5tYXJrKCkgewoJCQlpZih0aGlzLmxpbmUgIT0gdW5kZWZpbmVkICYmIHRoaXMubGluZSBpbnN0YW5jZW9mIEVsZW1lbnQpIHRoaXMubGluZS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKCQkJZWxzZSBpZih0aGlzLmxpbmUgIT0gdW5kZWZpbmVkICYmIHRoaXMubGluZSBpbnN0YW5jZW9mIEFycmF5KSB7CgkJCQlmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5saW5lLmxlbmd0aDsgaSsrKSB7CgkJCQkJdGhpcy5saW5lW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwoJCQkJfQoJCQl9CgkJCWlmKHRoaXMuc2VnbWVudCAhPSB1bmRlZmluZWQpIHRoaXMuc2VnbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKCQkJdGhpcy5saW5lID0gdW5kZWZpbmVkOwoJCQl0aGlzLnNlZ21lbnQgPSB1bmRlZmluZWQ7CgkJfQoKCX0KCgkvKioKCSAqIENsYXNzIHJlcHJlc2VudGluZyB0aGUgYmFzZSBncmFtbWFycwoJICogQG1lbWJlcm9mIE93bFN5bnRheAoJICoKCSAqIEBwcm9wZXJ0eSB7RnVuY3Rpb25bXX0gaGFuZGxlcnMgLSBBc3NvY2lhdGl2ZSBhcnJheSBvZiBoYW5kbGVyIGZ1bmN0aW9ucyAoKHR4dCk9PntyZXR1cm4gdHh0O30pLiBUaGlzIGFycmF5IG9mIGhhbmRsZXJzIHdpbGwgYmUgaXRlcmF0ZWQgdGhyb3VnaCwgYW5kIGVhY2ggZWxlbWVudCB3aWxsIGJlIGNhbGxlZCBmb3IgYWxsIG9mIHRoZSBsaW5lcyBvZiBzb3VyY2UgY29kZS4KCSAqLwoJT3dsU3ludGF4Lmxhbmd1YWdlID0gY2xhc3MgewoJCS8qKgoJCSAqIENyZWF0ZXMgdGhlIGdyYW1tYXJzCgkJICovCgkJY29uc3RydWN0b3IoKSB7CgkJCXRoaXMuaGFuZGxlcnMgPSBbXTsKCQl9CgoJCS8qKgoJCSAqIFJ1bnMgYSBoYW5kbGVyLiBBIGhhbmRsZXIgaGlnaGxpZ2h0ZXMgdGhlIHByb3BlciBwYXJ0cyBvZiBjb2RlLCBhbmQgcmV0dXJucyB0aGUgcmVzdWx0IGluIGh0bWwuCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ30gaGFuZGxlciAtIE5hbWUgb2YgaGFuZGxlcgoJCSAqIEBwYXJhbSB7c3RyaW5nfSB0eHQgLSBUaGUgbGluZSBvZiBjb2RlLCB0byBiZSBwcm9jZXNzZWQKCQkgKgoJCSAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBoaWdobGlnaHRlZCBjb2RlIGluIGh0bWwKCQkgKi8KCQloYW5kbGUoaGFuZGxlciwgdHh0KSB7CgkJCXJldHVybiB0aGlzW3RoaXMuaGFuZGxlcnNbaGFuZGxlcl1dKHR4dCk7CgkJfQoKCQkvKioKCQkgKiBUaGlzIG1ldGhvZCBtYWtlcyBpdCBwb3NzaWJsZSBmb3IgdGhlIGdyYW1tYXIgdG8gbWFuaXB1bGF0ZSB0aGUgY29udGFpbmVyIERPTSBlbGVtZW50LgoJCSAqCgkJICogQHBhcmFtIHtFbGVtZW50fSBjb250YWluZXIgLSBUaGUgRE9NRUxlbWVudCBvZiBjb250YWluZXIKCQkgKi8KCQljb250YWluZXIoY29udGFpbmVyKSB7CgkJCXJldHVybjsKCQl9CgoJCS8qKgoJCSAqIFByZXByb2Nlc3NlcyB0aGUgdGV4dC4gUnVucyBiZWZvcmUgaGlnaGxpZ2h0aW5nLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IHR4dCAtIFJhdyBsaW5lIG9mIHNvdXJjZSBjb2RlCgkJICogQHJldHVybnMge3N0cmluZ30gUHJlcHJvY2Vzc2VkIGxpbmUgb2Ygc291cmNlIGNvZGUKCQkgKi8KCQlwcmVwcm9jZXNzKHR4dCkgewoJCQlyZXR1cm4gdHh0OwoJCX0KCgkJLyoqCgkJICogUG9zdHByb2Nlc3NlcyB0aGUgdGV4dC4gUnVucyBhZnRlciBoaWdobGlnaHRpbmcuCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ30gdHh0IC0gUmF3IGxpbmUgb2Ygc291cmNlIGNvZGUKCQkgKiBAcmV0dXJucyB7c3RyaW5nfSBQb3N0cHJvY2Vzc2VkIGxpbmUgb2Ygc291cmNlIGNvZGUKCQkgKi8KCQlwb3N0cHJvY2Vzcyh0eHQpIHsKCQkJcmV0dXJuIHR4dDsKCQl9Cgl9CgoJLyoqCgkgKiBHcmFtbWFyIGZvciBjCgkgKiBAbWVtYmVyb2YgT3dsU3ludGF4CgkgKiBAZXh0ZW5kcyBPd2xTeW50YXgubGFuZ3VhZ2UKCSAqCgkgKiBAcHJvcGVydHkge3JlZ2V4fSBwcmVwcm9jZXNzb3IgLSBSZWdleCBmb3IgaWRlbnRpZnlpbmcgYW5kIHNlbGVjdGluZyBwcmVwcm9jZXNzb3IgZGlyZWN0aXZlcwoJICogQHByb3BlcnR5IHtyZWdleH0gYmxvY2stY29tbWVudCAtIFJlZ2V4IGZvciBpZGVudGlmeWluZyBhbmQgc2VsZWN0aW5nIGJsb2NrIGNvbW1lbnRzCgkgKiBAcHJvcGVydHkge3JlZ2V4fSBsaW5lLWNvbW1lbnQgLSBSZWdleCBmb3IgaWRlbnRpZnlpbmcgYW5kIHNlbGVjdGluZyBsaW5lIGNvbW1lbnRzCgkgKiBAcHJvcGVydHkge3JlZ2V4fSBzdHJpbmcgLSBSZWdleCBmb3IgaWRlbnRpZnlpbmcgYW5kIHNlbGVjdGluZyBzdHJpbmdzCgkgKiBAcHJvcGVydHkge3JlZ2V4fSBjaGFyYWN0ZXIgLSBSZWdleCBmb3IgaWRlbnRpZnlpbmcgYW5kIHNlbGVjdGluZyBjaGFyYWN0ZXJzCgkgKiBAcHJvcGVydHkge3JlZ2V4fSBrZXl3b3JkIC0gUmVnZXggZm9yIGlkZW50aWZ5aW5nIGFuZCBzZWxlY3Rpbmcga2V5d29yZHMKCSAqIEBwcm9wZXJ0eSB7cmVnZXh9IGJvb2xlYW4gLSBSZWdleCBmb3IgaWRlbnRpZnlpbmcgYW5kIHNlbGVjdGluZyBib29sZWFucwoJICogQHByb3BlcnR5IHtyZWdleH0gZnVuY3Rpb24gLSBSZWdleCBmb3IgaWRlbnRpZnlpbmcgYW5kIHNlbGVjdGluZyBmdW5jdGlvbiBuYW1lcwoJICogQHByb3BlcnR5IHtyZWdleH0gbnVtYmVyIC0gUmVnZXggZm9yIGlkZW50aWZ5aW5nIGFuZCBzZWxlY3RpbmcgbnVtYmVycwoJICogQHByb3BlcnR5IHtyZWdleH0gZm9yIC0gUmVnZXggZm9yIGlkZW50aWZ5aW5nIGFuZCBzZWxlY3RpbmcgZm9yIGN5Y2xlcwoJICogQHByb3BlcnR5IHtyZWdleH0gc2VnbWVudC1iZWdpbiAtIFJlZ2V4IGZvciBpZGVudGlmeWluZyBhbmQgc2VsZWN0aW5nIHNlZ21lbnQgYmVnaW5zICgvKiMqXC8pCgkgKiBAcHJvcGVydHkge3JlZ2V4fSBzZWdtZW50LWJlZ2luIC0gUmVnZXggZm9yIGlkZW50aWZ5aW5nIGFuZCBzZWxlY3Rpbmcgc2VnbWVudCBlbmRzICgvKiQqXC8pCgkgKi8KCU93bFN5bnRheC5jID0gY2xhc3MgZXh0ZW5kcyBPd2xTeW50YXgubGFuZ3VhZ2UgewoJCWNvbnN0cnVjdG9yKCkgewoJCQlzdXBlcigpOwoJCQl0aGlzWydwcmVwcm9jZXNzb3InXSA9IC8oXiMuKiQpL2c7CgkJCXRoaXNbJ2Jsb2NrLWNvbW1lbnQnXSA9IC8oXC9cKi4qXCpcLykvZzsKCQkJdGhpc1snbGluZS1jb21tZW50J10gPSAvKFwvXC8uKikvZzsKCQkJdGhpc1snc3RyaW5nJ10gPSAvIiguKj8pIi9nOwoJCQl0aGlzWydjaGFyYWN0ZXInXSA9IC8nKC4qPyknL2c7CgkJCXRoaXNbJ2tleXdvcmQnXSA9ICAvXGIoYXNtfHR5cGVvZnxpbmxpbmV8YXV0b3xicmVha3xjYXNlfGNoYXJ8Y29uc3R8Y29udGludWV8ZGVmYXVsdHxkb3xkb3VibGV8ZWxzZXxlbnVtfGV4dGVybnxmbG9hdHxmb3J8Z290b3xpZnxpbnR8bG9uZ3xyZWdpc3RlcnxyZXR1cm58c2hvcnR8c2lnbmVkfHNpemVvZnxzdGF0aWN8c3RydWN0fHN3aXRjaHx0eXBlZGVmfHVuaW9ufHVuc2lnbmVkfHZvaWR8dm9sYXRpbGV8d2hpbGUpKD89W15cd10pL2c7CgkJCXRoaXNbJ2Jvb2xlYW4nXSA9IC9cYih0cnVlfGZhbHNlKS9nOwoJCQl0aGlzWydmdW5jdGlvbiddID0gLyhbYS16MC05X10rKD89XCgpKS9nOwoJCQl0aGlzWydudW1iZXInXSA9IC9cYigtPyg/OjB4W1xkYS1mXSt8XGQqXC4/XGQrKD86ZVsrLV0/XGQrKT8pW2Z1bF0qKVxiL2c7CgkJCXRoaXNbJ2ZvciddID0gL2Zvcltcc10qXCgoLiopOyguKik7KC4qKVwpL2c7CgkJCXRoaXNbJ3NlZ21lbnQtYmVnaW4nXSA9IC8oXC9cKiNcKlwvKS9nOwoJCQl0aGlzWydzZWdtZW50LWVuZCddID0gLyhcL1wqXCRcKlwvKS9nOwoKCQkJdGhpcy5oYW5kbGVyc1snc3RyaW5nJ10gPSAnc3RyaW5nSGFuZGxlcic7CgkJCXRoaXMuaGFuZGxlcnNbJ2NoYXJhY3RlciddID0gJ2NoYXJhY3RlckhhbmRsZXInOwoJCQl0aGlzLmhhbmRsZXJzWydwcmVwcm9jZXNzb3InXSA9ICdwcmVwcm9jZXNzb3JIYW5kbGVyJzsKCQkJdGhpcy5oYW5kbGVyc1snc2VnbWVudC1iZWdpbiddID0gJ3NlZ21lbnRCZWdpbkhhbmRsZXInOwoJCQl0aGlzLmhhbmRsZXJzWydzZWdtZW50LWVuZCddID0gJ3NlZ21lbnRFbmRIYW5kbGVyJzsKCQkJdGhpcy5oYW5kbGVyc1snYmxvY2stY29tbWVudCddID0gJ2Jsb2NrQ29tbWVudEhhbmRsZXInOwoJCQl0aGlzLmhhbmRsZXJzWydsaW5lLWNvbW1lbnQnXSA9ICdsaW5lQ29tbWVudEhhbmRsZXInOwoJCQl0aGlzLmhhbmRsZXJzWydmb3InXSA9ICdmb3JIYW5kbGVyJzsKCQkJdGhpcy5oYW5kbGVyc1sna2V5d29yZCddID0gJ2tleXdvcmRIYW5kbGVyJzsKCQkJdGhpcy5oYW5kbGVyc1snYm9vbGVhbiddID0gJ2Jvb2xlYW5IYW5kbGVyJzsKCQkJdGhpcy5oYW5kbGVyc1snZnVuY3Rpb24nXSA9ICdmdW5jdGlvbkhhbmRsZXInOwoJCQl0aGlzLmhhbmRsZXJzWydudW1iZXInXSA9ICdudW1iZXJIYW5kbGVyJzsKCQl9CgoJCS8qKgoJCSAqIEhhbmRsZXIgZm9yIHN0cmluZ3MKCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSB0eHQgLSBUaGUgdW5mb3JtYXR0ZWQgbGluZQoJCSAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBsaW5lIGluY2x1ZGluZyBhIDxzcGFuPiB0byBmb3JtYXQgdGhlIHN0cmluZwoJCSAqLwoJCXN0cmluZ0hhbmRsZXIodHh0KSB7CgkJCXJldHVybiB0eHQucmVwbGFjZSh0aGlzWydzdHJpbmcnXSwgJzxzcGFuIGNsYXNzPSJzdHJpbmciPiIkMSI8L3NwYW4+Jyk7CgkJfQoKCQkvKioKCQkgKiBIYW5kbGVyIGZvciBjaGFyYWN0ZXJzCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ30gdHh0IC0gVGhlIHVuZm9ybWF0dGVkIGxpbmUKCQkgKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgbGluZSBpbmNsdWRpbmcgYSA8c3Bhbj4gdG8gZm9ybWF0IHRoZSBjaGFyYWN0ZXIKCQkgKi8KCQljaGFyYWN0ZXJIYW5kbGVyKHR4dCkgewoJCQlyZXR1cm4gdHh0LnJlcGxhY2UodGhpc1snY2hhcmFjdGVyJ10sICc8c3BhbiBjbGFzcz0iY2hhcmFjdGVyIj5cJyQxXCc8L3NwYW4+Jyk7CgkJfQoKCQkvKioKCQkgKiBIYW5kbGVyIGZvciBwcmVwcm9jZXNzb3IgZGlyZWN0aXZlcwoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IHR4dCAtIFRoZSB1bmZvcm1hdHRlZCBsaW5lCgkJICogQHJldHVybnMge3N0cmluZ30gVGhlIGxpbmUgaW5jbHVkaW5nIGEgPHNwYW4+IHRvIGZvcm1hdCB0aGUgZGlyZWN0aXZlCgkJICovCgkJcHJlcHJvY2Vzc29ySGFuZGxlcih0eHQpIHsKCQkJcmV0dXJuIHR4dC5yZXBsYWNlKHRoaXNbJ3ByZXByb2Nlc3NvciddLCAnPHNwYW4gY2xhc3M9InByZXByb2Nlc3NvciI+JDE8L3NwYW4+Jyk7CgkJfQoKCQkvKioKCQkgKiBIYW5kbGVyIGZvciBibG9jayBjb21tZW50cwoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IHR4dCAtIFRoZSB1bmZvcm1hdHRlZCBsaW5lCgkJICogQHJldHVybnMge3N0cmluZ30gVGhlIGxpbmUgaW5jbHVkaW5nIGEgPHNwYW4+IHRvIGZvcm1hdCB0aGUgYmxvY2sgY29tbWVudAoJCSAqLwoJCWJsb2NrQ29tbWVudEhhbmRsZXIodHh0KSB7CgkJCWlmKHR4dCA9PSAnLyojKi8nKSByZXR1cm4gJzxzcGFuIGNsYXNzPSJzZWdtZW50Ij4nOwoJCQllbHNlIGlmKHR4dCA9PSAnLyokKi8nKSByZXR1cm4gJzwvc3Bhbj4nOwoJCQllbHNlIHJldHVybiB0eHQucmVwbGFjZSh0aGlzWydibG9jay1jb21tZW50J10sICc8c3BhbiBjbGFzcz0iYmxvY2stY29tbWVudCI+JDE8L3NwYW4+Jyk7CgkJfQoKCQkvKioKCQkgKiBIYW5kbGVyIGZvciBsaW5lIGNvbW1lbnRzCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ30gdHh0IC0gVGhlIHVuZm9ybWF0dGVkIGxpbmUKCQkgKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgbGluZSBpbmNsdWRpbmcgYSA8c3Bhbj4gdG8gZm9ybWF0IHRoZSBsaW5lIGNvbW1lbnQKCQkgKi8KCQlsaW5lQ29tbWVudEhhbmRsZXIodHh0KSB7CgkJCXJldHVybiB0eHQucmVwbGFjZSh0aGlzWydsaW5lLWNvbW1lbnQnXSwgJzxzcGFuIGNsYXNzPSJsaW5lLWNvbW1lbnQiPiQxPC9zcGFuPicpOwoJCX0KCgkJLyoqCgkJICogSGFuZGxlciBmb3Iga2V5d29yZHMKCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSB0eHQgLSBUaGUgdW5mb3JtYXR0ZWQgbGluZQoJCSAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBsaW5lIGluY2x1ZGluZyBhIDxzcGFuPiB0byBmb3JtYXQgdGhlIGtleXdvcmQKCQkgKi8KCQlrZXl3b3JkSGFuZGxlcih0eHQpIHsKCQkJcmV0dXJuIHR4dC5yZXBsYWNlKHRoaXNbJ2tleXdvcmQnXSwgJzxzcGFuIGNsYXNzPSJrZXl3b3JkIj4kMTwvc3Bhbj4nKTsKCQl9CgoJCS8qKgoJCSAqIEhhbmRsZXIgZm9yIGJvb2xlYW5zCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ30gdHh0IC0gVGhlIHVuZm9ybWF0dGVkIGxpbmUKCQkgKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgbGluZSBpbmNsdWRpbmcgYSA8c3Bhbj4gdG8gZm9ybWF0IHRoZSBib29sZWFuCgkJICovCgkJYm9vbGVhbkhhbmRsZXIodHh0KSB7CgkJCXJldHVybiB0eHQucmVwbGFjZSh0aGlzWydib29sZWFuJ10sICc8c3BhbiBjbGFzcz0iYm9vbGVhbiI+JDE8L3NwYW4+Jyk7CgkJfQoKCQkvKioKCQkgKiBIYW5kbGVyIGZvciBmdW5jdGlvbiBuYW1lcwoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IHR4dCAtIFRoZSB1bmZvcm1hdHRlZCBsaW5lCgkJICogQHJldHVybnMge3N0cmluZ30gVGhlIGxpbmUgaW5jbHVkaW5nIGEgPHNwYW4+IHRvIGZvcm1hdCB0aGUgZnVuY3Rpb24gbmFtZQoJCSAqLwoJCWZ1bmN0aW9uSGFuZGxlcih0eHQpIHsKCQkJcmV0dXJuIHR4dC5yZXBsYWNlKHRoaXNbJ2Z1bmN0aW9uJ10sICc8c3BhbiBjbGFzcz0iZnVuY3Rpb24iPiQxPC9zcGFuPicpOwoJCX0KCgkJLyoqCgkJICogSGFuZGxlciBmb3IgbnVtYmVycwoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IHR4dCAtIFRoZSB1bmZvcm1hdHRlZCBsaW5lCgkJICogQHJldHVybnMge3N0cmluZ30gVGhlIGxpbmUgaW5jbHVkaW5nIGEgPHNwYW4+IHRvIGZvcm1hdCB0aGUgbnVtYmVyCgkJICovCgkJbnVtYmVySGFuZGxlcih0eHQpIHsKCQkJcmV0dXJuIHR4dC5yZXBsYWNlKHRoaXNbJ251bWJlciddLCAnPHNwYW4gY2xhc3M9Im51bWJlciI+JDE8L3NwYW4+Jyk7CgkJfQoKCQkvKioKCQkgKiBIYW5kbGVyIGZvciBmb3IgY3ljbGVzCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ30gdHh0IC0gVGhlIHVuZm9ybWF0dGVkIGxpbmUKCQkgKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgbGluZSBpbmNsdWRpbmcgYSA8c3Bhbj4gdG8gZm9ybWF0IHRoZSBmb3IgY3ljbGUKCQkgKi8KCQlmb3JIYW5kbGVyKHR4dCkgewoJCQl0eHQgPSB0eHQucmVwbGFjZSgvJmx0Oy9nLCAnfC18Jyk7CgkJCXR4dCA9IHR4dC5yZXBsYWNlKC8mZ3Q7L2csICd8K3wnKTsKCQkJdHh0ID0gdHh0LnJlcGxhY2UodGhpc1snZm9yJ10sICc8c3BhbiBjbGFzcz0iZm9yY3ljbGUiPmZvcig8c3BhbiBjbGFzcz0ic2VnbWVudCI+JDE8L3NwYW4+OzxzcGFuIGNsYXNzPSJzZWdtZW50Ij4kMjwvc3Bhbj47PHNwYW4gY2xhc3M9InNlZ21lbnQiPiQzPC9zcGFuPik8L3NwYW4+Jyk7CgkJCXR4dCA9IHR4dC5yZXBsYWNlKC9cfFwtXHwvZywgJyZsdDsnKTsKCQkJdHh0ID0gdHh0LnJlcGxhY2UoL1x8XCtcfC9nLCAnJmd0OycpOwoJCQlyZXR1cm4gdHh0OwoJCX0KCgkJLyoqCgkJICogSGFuZGxlciBmb3Igc2VnbWVudCBiZWdpbnMKCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSB0eHQgLSBUaGUgdW5mb3JtYXR0ZWQgbGluZQoJCSAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBsaW5lIGluY2x1ZGluZyBhIDxzcGFuPiB0byBmb3JtYXQgdGhlIHNlZ21lbnQgYmVnaW4KCQkgKi8KCQlzZWdtZW50QmVnaW5IYW5kbGVyKHR4dCkgewoJCQlyZXR1cm4gdHh0LnJlcGxhY2UodGhpc1snc2VnbWVudC1iZWdpbiddLCAnPHNwYW4gY2xhc3M9InNlZ21lbnQiPicpOwoJCX0KCgkJLyoqCgkJICogSGFuZGxlciBmb3Igc2VnbWVudCBlbmRzCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ30gdHh0IC0gVGhlIHVuZm9ybWF0dGVkIGxpbmUKCQkgKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgbGluZSBpbmNsdWRpbmcgYSA8c3Bhbj4gdG8gZm9ybWF0IHRoZSBzZWdtZW50IGVuZAoJCSAqLwoJCXNlZ21lbnRFbmRIYW5kbGVyKHR4dCkgewoJCQlyZXR1cm4gdHh0LnJlcGxhY2UodGhpc1snc2VnbWVudC1lbmQnXSwgJzwvc3Bhbj4nKTsKCQl9Cgl9CgoJcmV0dXJuIE93bFN5bnRheDsKfSkoKTsKCgoKLyouL2luZm9jL2luZm9jLmpzKi8KCk93bFN5bnRheC5pbmZvYyA9IGNsYXNzIGV4dGVuZHMgT3dsU3ludGF4LmMgewoJY29uc3RydWN0b3IoKSB7CgkJc3VwZXIoKTsKCQl0aGlzWydsaW5lLWNvbW1lbnQnXSA9IC9cL1wvKC4qKS9nOwoJCXRoaXNbJ3NwZWNmdW5jdGlvbiddID0gL1xiKHByaW50ZnxzY2FuZnxmcHJpbnRmfGZzY2FuZnxzcHJpbnRmfHNzY2FuZnxtYWxsb2N8ZnJlZXxyYW5kfHRpbWV8c3JhbmR8cmVhbGxvY3xtZW1jcHl8c3RybGVufHN0cmNhdHxzdHJjcHl8c3RyY21wfHN0cnN0cnxzdHJ0b2spKD89W15cd10pL2c7CgoJCXRoaXMuaGFuZGxlcnNbJ3NwZWNmdW5jdGlvbiddID0gJ3NwZWNmdW5jdGlvbkhhbmRsZXInOwoJfQoKCWNvbnRhaW5lcihjb250YWluZXIpIHsKCQljb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnZGVmYXVsdCcpOwoJCWNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdpbmZvYycpOwoJfQoKCWxpbmVDb21tZW50SGFuZGxlcih0eHQpIHsKCQlyZXR1cm4gdHh0LnJlcGxhY2UodGhpc1snbGluZS1jb21tZW50J10sICc8c3BhbiBjbGFzcz0ibGluZS1jb21tZW50Ij48c3BhbiBjbGFzcz0iaGlkZGVuIj4vKiA8L3NwYW4+JDE8c3BhbiBjbGFzcz0iaGlkZGVuIj4gKi88L3NwYW4+PC9zcGFuPicpOwoJfQoKCXNwZWNmdW5jdGlvbkhhbmRsZXIodHh0KSB7CgkJcmV0dXJuIHR4dC5yZXBsYWNlKHRoaXNbJ3NwZWNmdW5jdGlvbiddLCAnPHNwYW4gY2xhc3M9InNwZWNmdW5jdGlvbiI+JDE8L3NwYW4+Jyk7Cgl9Cn0KCgoKLyouL2FuaW0uanMqLwoKdmFyIE93bEFuaW0gPSAoZnVuY3Rpb24oKSB7CgkndXNlIHN0cmljdCc7CgoJbGV0IFNURVAgPSAwLjU7CglsZXQgU01BTExTVEVQID0gMC4yOwoKCS8qKgoJICogQ2xhc3MgcmVzcG9uc2libGUgZm9yIGFuaW1hdGlvbiBoYW5kbGluZwoJICoKCSAqIEBwcm9wZXJ0eSB7RnVuY3Rpb259IGFuaW1hdGlvbiAtIFRoZSBnZW5lcmF0b3IgZnVuY3Rpb24gdGhhdCBpbXBsZW1lbnRzIHRoZSBhbmltYXRpb24sIEl0IGFjY2VwdHMgYW4gT2JqZWN0IHBhcmFtZXRlci4gVGhlIG9iamVjdCBoYXMgdHdvIHByb3BlcnRpZXMuIFRoZSAuZHJhdyB3aGljaCBob2xkcyB0aGUge0BsaW5rIE93bERyYXd9IGluc3RhbmNlIGlmIGl0IGlzIHBhcnQgb2YgdGhlIGFuaW1hdGlvbiwgYW5kIC5zeW50YXggd2hpY2ggaG9sZHMgdGhlIHtAbGluayBPd2xTeW50YXh9IGluc3RhbmNlIGlmIGl0IGlzIHBhcnQgb2YgdGhlIGFuaW1hdGlvbi4KCSAqIEBwcm9wZXJ0eSB7R2VuZXJhdG9yfSBnZW5lcmF0b3IgLSBUaGUgY3VycmVudGx5IGFjdGl2ZSBnZW5lcmF0b3IgaW5zdGFuY2UKCSAqIEBwcm9wZXJ0eSB7T2JqZWN0fSB0aW1lciAtIFRoZSBjdXJyZW50bHkgYWN0aXZlIHNldFRpbWVvdXQgaWRlbnRpZmllcgoJICogQHByb3BlcnR5IHtPd2xEcmF3fSBbZHJhd10gLSBUaGUgaW5zdGFuY2Ugb2YgZHJhd2luZyBvYmplY3QuIFBhcmFtZXRlciBvZiBhbmltYXRpb24gZ2VuZXJhdG9yLgoJICogQHByb3BlcnR5IHtPd2xEcmF3fSBbc3ludGF4XSAtIFRoZSBpbnN0YW5jZSBvZiBkcmF3aW5nIG9iamVjdC4gUGFyYW1ldGVyIG9mIGFuaW1hdGlvbiBnZW5lcmF0b3IuCgkgKi8KCWNsYXNzIE93bEFuaW0gewoJCS8qKgoJCSAqIENyZWF0ZXMgYW4gYW5pbWF0aW9uCgkJICoKCQkgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIG9wdGlvbnMKCQkgKiBAcGFyYW0ge3N0cmluZ3xFbGVtZW50fSB0eXBlIC0gSWYgJ2luU3ludGF4JyB0aGVuIHRoZSBidXR0b25zIHdpbGwgYmUgZGlzcGxheWVkIGluIHRoZSB0b3AtcmlnaHQgY29ybmVyIG9mIHRoZSBhdGF0Y2hlZCB7QGxpbmsgT3dsU3ludGF4fSBlbGVtZW50LiBJZiAnYWZ0ZXJTeW50YXgnIHRoZW4gdGhlIGJ1dHRvbnMgd2lsbCBiZSBkaXNwbGF5ZWQgYWZ0ZXIgdGhlIGF0YXRjaGVkIHtAbGluayBPd2xTeW50YXh9IGVsZW1lbnQuIElmICdhZnRlckRyYXcnIHRoZW4gdGhlIGJ1dHRvbnMgd2lsbCBiZSBkaXNwbGF5ZWQgYWZ0ZXIgdGhlIGF0YXRjaGVkIHtAbGluayBPd2xEcmF3fSBlbGVtZW50LiBPdGhlcndpc2UgaWYgc3RyaW5nLCB0aGUgYnV0dG9ucyB3aWxsIGJlIHRoZSBjaGlsZHJlbiBvZiB0aGUgRE9NIGVsZW1lbnQgd2l0aCBpZCBtYXRjaGluZyB0aGlzIHBhcmFtZXRlci4gSWYgaW5zdGFuY2Ugb2YgRWxlbWVudCB0aGVuIHRoZSBidXR0b25zIHdpbGwgYmUgY2hpbGRyZW4gb2YgdGhpcyBlbGVtZW50LgoJCSAqIEBwYXJhbSB7c3RyaW5nfE93bERyYXd9IFtvcHRpb25zLmRyYXddIC0gSWYgc3RyaW5nLCB0aGVuIGFuIGVtcHR5IHtAbGluayBPd2xEcmF3fSBpbnN0YW5jZSB3aWxsIGJlIGNyZWF0ZWQgaW4gdGhlIGVsZW1lbnQgd2l0aCBpZCBtYXRjaGluZyB0aGlzIHBhcmFtZXRlciwgaWYge0BsaW5rIE93bERyYXd9IGluc3RhbmNlIHRoZW4gdGhpcyBpbnN0YW5jZSB3aWxsIGJlIHVzZWQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLndpZHRoXSAtIFdpZHRoIG9mIHRoZSBzdmcgY2FudmFzLCBpZiBpdCBuZWVkcyB0byBiZSBjcmVhdGVkCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLmhlaWdodF0gLSBIZWlnaHQgb2YgdGhlIHN2ZyBjYW52YXMsIGlmIGl0IG5lZWRzIHRvIGJlIGNyZWF0ZWQKCQkgKiBAcGFyYW0ge3N0cmluZ3xPd2xTeW50YXh9IFtvcHRpb25zLnN5bnRheF0gLSBJZiBzdHJpbmcsIHRoZW4gYW4gZW1wdHkge0BsaW5rIE93bFN5bnRheH0gaW5zdGFuY2Ugd2lsbCBiZSBjcmVhdGVkIGluIHRoZSBlbGVtZW50IHdpdGggaWQgbWF0Y2hpbmcgdGhpcyBwYXJhbWV0ZXIsIGlmIHtAbGluayBPd2xTeW50YXh9IGluc3RhbmNlIHRoZW4gdGhpcyBpbnN0YW5jZSB3aWxsIGJlIHVzZWQuCgkJICogQHBhcmFtIHtzdHJpbmd8T3dsU3ludGF4Lmxhbmd1YWdlfSBbb3B0aW9ucy5sYW5ndWFnZV0gLSBJZiBzdHJpbmcsIHRoZW4gbmFtZSBvZiBncmFtbWFyIChPd2xTeW50YXhbe25hbWV9XSkuIElmIG9iamVjdCwgdGhlbiBpdCBtdXN0IGJlIGNvbXBhdGlibGUgd2l0aCB7QGxpbmsgT3dsU3ludGF4Lmxhbmd1YWdlfS4gSWYgdW5kZWZpbmVkIGJ1dCB0aGUgZGF0YS1sYW5ndWFnZSBwcm9wZXJ0eSBpcyBzZXQgb24gdGhlIHNvdXJjZSBlbGVtZW50LCB0aGVuIHRoZSBsYW5ndWFnZSB3aWxsIGJlIHRha2VuIGZyb20gdGhhdCBwcm9wZXJ0eS4KCQkgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnMuYnV0dG9uc10gLSBPYmplY3QgZGVzY3JpYmluZyB0aGUgYnV0dG9ucy4gQnkgZGVmYXVsdCwgc3RhcnQsIG5leHQsIGNvbnRpbnVvdXMgYnV0dG9ucyBhcmUgc2hvd24sIGNvbnRpbnVvdXNRdWljayBpcyBoaWRkZW4uCgkJICogQHBhcmFtIHtPYmplY3R8Ym9vbGVhbn0gW29wdGlvbnMuYnV0dG9ucy5zdGFydF0gLSBPYmplY3QgZGVzY3JpYmluZyB0aGUgc3RhcnQgYnV0dG9uLiBCeSBkZWZhdWx0LCBpdCBpcyBzaG93bi4gSWYgZmFsc2UgdGhlIGJ1dHRvbiB3aWxsYmUgaGlkZGVuLgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucy5idXR0b25zLnN0YXJ0LnRleHRdIC0gVGV4dCB0byBiZSBkaXNwbGF5ZWQgaW4gc3RhcnQgYnV0dG9uLiBEZWZhdWx0OiBTdGFydAoJCSAqIEBwYXJhbSB7T2JqZWN0fGJvb2xlYW59IFtvcHRpb25zLmJ1dHRvbnMubmV4dF0gLSBPYmplY3QgZGVzY3JpYmluZyB0aGUgbmV4dCBidXR0b24uIEJ5IGRlZmF1bHQsIGl0IGlzIHNob3duLiBJZiBmYWxzZSB0aGUgYnV0dG9uIHdpbGxiZSBoaWRkZW4uCgkJICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLmJ1dHRvbnMubmV4dC50ZXh0XSAtIFRleHQgdG8gYmUgZGlzcGxheWVkIGluIG5leHQgYnV0dG9uLiBEZWZhdWx0OiBLw7Z2ZXRrZXrFkQoJCSAqIEBwYXJhbSB7T2JqZWN0fGJvb2xlYW59IFtvcHRpb25zLmJ1dHRvbnMuY29udGludW91c10gLSBPYmplY3QgZGVzY3JpYmluZyB0aGUgY29udGludW91cyBidXR0b24uIEJ5IGRlZmF1bHQsIGl0IGlzIHNob3duLiBJZiBmYWxzZSB0aGUgYnV0dG9uIHdpbGxiZSBoaWRkZW4uCgkJICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLmJ1dHRvbnMuY29udGludW91cy50ZXh0XSAtIFRleHQgdG8gYmUgZGlzcGxheWVkIGluIGNvbnRpbnVvdXMgYnV0dG9uLiBEZWZhdWx0OiBGb2x5YW1hdG9zCgkJICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLmJ1dHRvbnMuY29udGludW91c1F1aWNrXSAtIE9iamVjdCBkZXNjcmliaW5nIHRoZSBjb250aW51b3VzIHF1aWNrIGJ1dHRvbi4gQnkgZGVmYXVsdCwgaXQgaXMgaGlkZGVuLiBJZiBkZWZpbmVkLCB0aGUgYnV0dG9uIHdpbGwgYmUgc2hvd24uCgkJICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLmJ1dHRvbnMuY29udGludW91c1F1aWNrLnRleHRdIC0gVGV4dCB0byBiZSBkaXNwbGF5ZWQgaW4gY29udGludW91cyBxdWljayBidXR0b24uIERlZmF1bHQ6IEZvbHlhbWF0b3MgZ3lvcnMKCQkgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnMuYnV0dG9ucy5idXR0b25OYW1lXSAtIEN1c3RvbSBidXR0b24gY2FuIGJlIGRlZmluZWQgYnkgZGVmaW5pbmcgY3VzdG9tIG5hbWVkIChidXR0b25OYW1lKSBwcm9wZXJ0aWVzIG9uIHRoaXMgb2JqZWN0LgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucy5idXR0b25zLmJ1dHRvbk5hbWUudGV4dF0gLSBUZXh0IHRvIGJlIGRpc3BsYXllZCBpbiBjdXN0b21CdXR0b24gYnV0dG9uLgoJCSAqIEBwYXJhbSB7RnVuY3Rpb259IFtvcHRpb25zLmJ1dHRvbnMuYnV0dG9uTmFtZS5jbGlja10gLSBUaGUgZXZlbnQgaGFuZGxlciB0aGF0IHdpbGwgYmUgZXhlY3V0ZWQgb24gYnV0dG9uIGNsaWNrLiBOb3RlLCB0aGF0IHRoaXMgZnVuY3Rpb24gd2lsbCBiZSBib3VuZGVkIHRvIHRoaXMge0BsaW5rIE93bEFuaW19IGluc3RhbmNlIChhcnJvdyBmdW5jdGlvbnMgY2FuIG5vdCBiZSBib3VuZGVkLCBzbyB1c2Ugb2xkIHN0eWxlIGZ1bmN0aW9ucykuCgkJICogQHBhcmFtIHtGdW5jdGlvbn0gYW5pbWF0aW9uIC0gVGhlIGdlbmVyYXRvciBmdW5jdGlvbiB0aGF0IGltcGxlbWVudHMgdGhlIGFuaW1hdGlvbiwgSXQgYWNjZXB0cyBhbiBPYmplY3QgcGFyYW1ldGVyLiBUaGUgb2JqZWN0IGhhcyB0d28gcHJvcGVydGllcy4gVGhlIC5kcmF3IHdoaWNoIGhvbGRzIHRoZSB7QGxpbmsgT3dsRHJhd30gaW5zdGFuY2UgaWYgaXQgaXMgcGFydCBvZiB0aGUgYW5pbWF0aW9uLCBhbmQgLnN5bnRheCB3aGljaCBob2xkcyB0aGUge0BsaW5rIE93bFN5bnRheH0gaW5zdGFuY2UgaWYgaXQgaXMgcGFydCBvZiB0aGUgYW5pbWF0aW9uLgoJCSAqLwoJCWNvbnN0cnVjdG9yKG9wdGlvbnMsIGFuaW1hdGlvbikgewoJCQl0aGlzLmFuaW1hdGlvbiA9IGFuaW1hdGlvbjsKCQkJdGhpcy5nZW5lcmF0b3IgPSBudWxsOwoJCQl0aGlzLnRpbWVyID0gbnVsbDsKCgkJCWlmKG9wdGlvbnMuZHJhdyAmJiBvcHRpb25zLmRyYXcgaW5zdGFuY2VvZiBPd2xEcmF3KSB0aGlzLmRyYXcgPSBvcHRpb25zLmRyYXc7CgkJCWVsc2UgaWYob3B0aW9ucy5kcmF3ICYmIHR5cGVvZiBvcHRpb25zLmRyYXcgPT0gJ3N0cmluZycpIHsKCQkJCXRoaXMuZHJhdyA9IG5ldyBPd2xEcmF3KG9wdGlvbnMuZHJhdywge3dpZHRoOiBvcHRpb25zLndpZHRoLCBoZWlnaHQ6IG9wdGlvbnMuaGVpZ2h0fSk7CgkJCX0KCgkJCWlmKG9wdGlvbnMuc3ludGF4ICYmIG9wdGlvbnMuc3ludGF4IGluc3RhbmNlb2YgT3dsU3ludGF4KSB0aGlzLnN5bnRheCA9IG9wdGlvbnMuc3ludGF4OwoJCQllbHNlIGlmKG9wdGlvbnMuc3ludGF4ICYmIHR5cGVvZiBvcHRpb25zLnN5bnRheCA9PSAnc3RyaW5nJykgewoJCQkJdGhpcy5zeW50YXggPSBuZXcgT3dsU3ludGF4KG9wdGlvbnMuc3ludGF4LCB7bGFuZ3VhZ2U6IG9wdGlvbnMubGFuZ3VhZ2V9KTsKCQkJfQoKCQkJbGV0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQlkaXYuY2xhc3NMaXN0LmFkZCgnYW5pbWF0ZScpOwoKCQkJaWYob3B0aW9ucy5idXR0b25zID09IHVuZGVmaW5lZCB8fCBvcHRpb25zLmJ1dHRvbnMuc3RhcnQgIT0gZmFsc2UpIHsKCQkJCWxldCBzdGFydCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwoJCQkJaWYob3B0aW9ucy5idXR0b25zICYmIG9wdGlvbnMuYnV0dG9ucy5zdGFydCAmJiBvcHRpb25zLmJ1dHRvbnMuc3RhcnQudGV4dCkgc3RhcnQuaW5uZXJUZXh0ID0gb3B0aW9ucy5idXR0b25zLnN0YXJ0LnRleHQ7CgkJCQllbHNlIHN0YXJ0LmlubmVyVGV4dCA9ICdTdGFydCc7CgkJCQlzdGFydC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuc3RhcnQuYmluZCh0aGlzKSk7CgkJCQlkaXYuYXBwZW5kQ2hpbGQoc3RhcnQpOwoJCQl9CgoJCQlpZihvcHRpb25zLmJ1dHRvbnMgPT0gdW5kZWZpbmVkIHx8IG9wdGlvbnMuYnV0dG9ucy5uZXh0ICE9IGZhbHNlKSB7CgkJCQlsZXQgbmV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwoJCQkJaWYob3B0aW9ucy5idXR0b25zICYmIG9wdGlvbnMuYnV0dG9ucy5uZXh0ICYmIG9wdGlvbnMuYnV0dG9ucy5uZXh0LnRleHQpIG5leHQuaW5uZXJUZXh0ID0gb3B0aW9ucy5idXR0b25zLm5leHQudGV4dDsKCQkJCWVsc2UgbmV4dC5pbm5lclRleHQgPSAnS8O2dmV0a2V6xZEnOwoJCQkJbmV4dC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMubmV4dC5iaW5kKHRoaXMpKTsKCQkJCWRpdi5hcHBlbmRDaGlsZChuZXh0KTsKCQkJfQoKCQkJaWYob3B0aW9ucy5idXR0b25zID09IHVuZGVmaW5lZCB8fCBvcHRpb25zLmJ1dHRvbnMuY29udGludW91cyAhPSBmYWxzZSkgewoJCQkJbGV0IGNvbnRpbnVvdXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKCQkJCWlmKG9wdGlvbnMuYnV0dG9ucyAmJiBvcHRpb25zLmJ1dHRvbnMuY29udGludW91cyAmJiBvcHRpb25zLmJ1dHRvbnMuY29udGludW91cy50ZXh0KSBjb250aW51b3VzLmlubmVyVGV4dCA9IG9wdGlvbnMuYnV0dG9ucy5jb250aW51b3VzLnRleHQ7CgkJCQllbHNlIGNvbnRpbnVvdXMuaW5uZXJUZXh0ID0gJ0ZvbHlhbWF0b3MnOwoJCQkJY29udGludW91cy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuY29udGludW91cy5iaW5kKHRoaXMpKTsKCQkJCWRpdi5hcHBlbmRDaGlsZChjb250aW51b3VzKTsKCQkJfQoKCQkJaWYob3B0aW9ucy5idXR0b25zICYmIG9wdGlvbnMuYnV0dG9ucy5jb250aW51b3VzUXVpY2spIHsKCQkJCWxldCBjb250aW51b3VzUXVpY2sgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKCQkJCWlmKG9wdGlvbnMuYnV0dG9ucy5jb250aW51b3VzUXVpY2sudGV4dCkgY29udGludW91c1F1aWNrLmlubmVyVGV4dCA9IG9wdGlvbnMuYnV0dG9ucy5jb250aW51b3VzUXVpY2sudGV4dDsKCQkJCWVsc2UgY29udGludW91c1F1aWNrLmlubmVyVGV4dCA9ICdGb2x5YW1hdG9zIGd5b3JzJzsKCQkJCWNvbnRpbnVvdXNRdWljay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuY29udGludW91c1F1aWNrLmJpbmQodGhpcykpOwoJCQkJZGl2LmFwcGVuZENoaWxkKGNvbnRpbnVvdXNRdWljayk7CgkJCX0KCgkJCWlmKG9wdGlvbnMuYnV0dG9ucykgewoJCQkJZm9yKGxldCBidXR0b24gaW4gb3B0aW9ucy5idXR0b25zKSB7CgkJCQkJaWYoYnV0dG9uID09ICdzdGFydCcgfHwgYnV0dG9uID09ICduZXh0JyB8fCBidXR0b24gPT0gJ2NvbnRpbnVvdXMnIHx8IGJ1dHRvbiA9PSAnY29udGludW91c1F1aWNrJykgY29udGludWU7CgoJCQkJCWxldCBiID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CgkJCQkJYi5pbm5lclRleHQgPSBvcHRpb25zLmJ1dHRvbnNbYnV0dG9uXS50ZXh0OwoJCQkJCWIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvcHRpb25zLmJ1dHRvbnNbYnV0dG9uXS5jbGljay5iaW5kKHRoaXMpKTsKCQkJCQlkaXYuYXBwZW5kQ2hpbGQoYik7CgkJCQl9CgkJCX0KCgkJCWlmKG9wdGlvbnMudHlwZSA9PSAnaW5TeW50YXgnKSB7CgkJCQl0aGlzLnN5bnRheC5jb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTsKCQkJfQoJCQllbHNlIGlmKG9wdGlvbnMudHlwZSA9PSAnYWZ0ZXJTeW50YXgnKSB7CgkJCQl0aGlzLnN5bnRheC5jb250YWluZXIucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZGl2LCB0aGlzLnN5bnRheC5jb250YWluZXIubmV4dFNpYmxpbmcpOwoJCQl9CgkJCWVsc2UgaWYob3B0aW9ucy50eXBlID09ICdhZnRlckRyYXcnKSB7CgkJCQl0aGlzLmRyYXcuY29udGFpbmVyLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGRpdiwgdGhpcy5kcmF3LmNvbnRhaW5lci5uZXh0U2libGluZyk7CgkJCX0KCQkJZWxzZSBpZih0eXBlb2Ygb3B0aW9ucy50eXBlID09ICdzdHJpbmcnKSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChvcHRpb25zLnR5cGUpLmFwcGVuZENoaWxkKGRpdik7CgkJCX0KCQkJZWxzZSBpZihvcHRpb25zLnR5cGUgaW5zdGFuY2VvZiBFbGVtZW50KSB7CgkJCQlvcHRpb25zLnR5cGUuYXBwZW5kQ2hpbGQoZGl2KTsKCQkJfQoKCQkJdGhpcy5zdGFydCgpOwoJCX0KCgkJLyoqCgkJICogUHJlcGFyZXMgdGhlIGFuaW1hdGlvbi4gQ3JlYXRlcyB0aGUgZ2VuZXJhdG9yIGluc3RhbmNlLCBhbmQgZXhlY3V0ZXMgaXQgdW50aWwgdGhlIGZpcnN0IHlpZWxkLCByZXNldHMgdGhlIHRpbWVyLCB7QGxpbmsgT3dsRHJhd30gYW5kIHtAbGluayBPd2xTeW50YXh9IGluc3RhbmNlLgoJCSAqLwoJCXN0YXJ0KCkgewoJCQlpZih0aGlzLmRyYXcpIHRoaXMuZHJhdy5jbGVhcigpOwoJCQlpZih0aGlzLnN5bnRheCkgdGhpcy5zeW50YXgudW5tYXJrKCk7CgkJCWNsZWFyVGltZW91dCh0aGlzLnRpbWVyKTsgdGhpcy50aW1lciA9IG51bGw7CgkJCXRoaXMuZ2VuZXJhdG9yID0gdGhpcy5hbmltYXRpb24oe2RyYXc6IHRoaXMuZHJhdywgc3ludGF4OiB0aGlzLnN5bnRheH0pOwoJCQl0aGlzLmdlbmVyYXRvci5uZXh0KCk7CgkJfQoKCQkvKioKCQkgKiBFeGVjdXRlcyB0aGUgYW5pbWF0aW9uIHVudGlsIHRoZSBuZXh0IHlpZWxkCgkJICovCgkJbmV4dCgpIHsKCQkJdGhpcy5nZW5lcmF0b3IubmV4dCgpOwoJCX0KCgkJLyoqCgkJICogRXhlY3V0ZXMgdGhlIGFuaW1hdGlvbiB1bnRpbCB0aGUgZW5kIChpZiBubyByZXR1cm4sIHRoZW4gZW5kbGVzc2x5KQoJCSAqLwoJCWNvbnRpbnVvdXMoKSB7CgkJCWxldCB2YWwgPSB0aGlzLmdlbmVyYXRvci5uZXh0KCk7CgkJCWlmKHZhbC5kb25lID09IGZhbHNlKSB0aGlzLnRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7IHRoaXMuY29udGludW91cygpOyB9LCBTVEVQKjEwMDApOwoJCX0KCgkJLyoqCgkJICogRXhlY3V0ZXMgdGhlIGFuaW1hdGlvbiB1bnRpbCB0aGUgZW5kIHdpdGggcXVpY2tlciBzcGVlZCAoaWYgbm8gcmV0dXJuLCB0aGVuIGVuZGxlc3NseSkKCQkgKi8KCQljb250aW51b3VzUXVpY2soKSB7CgkJCWxldCB2YWwgPSB0aGlzLmdlbmVyYXRvci5uZXh0KCk7CgkJCWlmKHZhbC5kb25lID09IGZhbHNlKSB0aGlzLnRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7IHRoaXMuY29udGludW91c1F1aWNrKCk7IH0sIFNNQUxMU1RFUCoxMDAwKTsKCQl9Cgl9CgoJcmV0dXJuIE93bEFuaW07Cn0pKCk7CgoKCg=='), function(c) {
        	return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    	}).join('')));
	}
	catch(e) {
		console.log(e);
		alert('A böngésző sajnos már nem támogatott. Frissítsen újabbra.');
	}
